(function(){var e=Array;typeof Float32Array!="undefined"&&Float32Array.prototype!==undefined&&Float32Array.prototype.slice===undefined&&(Float32Array.prototype.slice=function(t,n){var r=this.length;t===undefined?t=0:t<0&&(t+=r),n===undefined?n=r:n<0&&(n+=r),r=n-t;if(0<r){var i=new Float32Array(r),s=0;do i[s]=this[t],s+=1,t+=1;while(t<n);return i}return new Float32Array(0)});var t={version:1,precision:1e-6,FLOAT_MAX:3.402823466e38,select:function(t,n,r){return t?n:r},reciprocal:function(t){if(t!==0)return 1/t;throw"Division by zero"},truncate:function(t){return t|0},v2BuildZero:function(n){return n===undefined&&(n=new e(2)),n[0]=0,n[1]=0,n},v2BuildOne:function(n){return n===undefined&&(n=new e(2)),n[0]=1,n[1]=1,n},v2BuildXAxis:function(n){return n===undefined&&(n=new e(2)),n[0]=1,n[1]=0,n},v2BuildYAxis:function(n){return n===undefined&&(n=new e(2)),n[0]=0,n[1]=1,n},v2Build:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n,i[1]=r,i},v2Copy:function(n,r){return r===undefined&&(r=new e(2)),r[0]=n[0],r[1]=n[1],r},v2Set:function(t,n){t[0]=n[0],t[1]=n[1]},v2Neg:function(n,r){return r===undefined&&(r=new e(2)),r[0]=-n[0],r[1]=-n[1],r},v2Add:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]+r[0],i[1]=n[1]+r[1],i},v2Add3:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s},v2Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(2)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o},v2Sub:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]-r[0],i[1]=n[1]-r[1],i},v2Mul:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i},v2MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s},v2Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},v2PerpDot:function(t,n){return t[0]*n[1]-t[1]*n[0]},v2LengthSq:function(t){var n=t[0],r=t[1];return n*n+r*r},v2Length:function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},v2Reciprocal:function(r,i){i===undefined&&(i=new e(2));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i},v2Normalize:function(n,r){r===undefined&&(r=new e(2));var i=n[0],s=n[1],o=i*i+s*s;if(o>0){var u=1/Math.sqrt(o);r[0]=i*u,r[1]=s*u}else r[0]=0,r[1]=0;return r},v2Abs:function(n,r){r===undefined&&(r=new e(2));var i=Math.abs;return r[0]=i(n[0]),r[1]=i(n[1]),r},v2Max:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.max;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i},v2Min:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.min;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i},v2Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r},v2MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s]},v2MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1]]},v2MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1]]},v2MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1]]},v2MaskNot:function(t){return[!t[0],!t[1]]},v2MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1]]},v2MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1]]},v2Select:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s},v2ScalarBuild:function(n,r){return r===undefined&&(r=new e(2)),r[0]=n,r[1]=n,r},v2ScalarMax:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i},v2ScalarMin:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i},v2ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]+r,i[1]=n[1]+r,i},v2ScalarSub:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]-r,i[1]=n[1]-r,i},v2ScalarMul:function(n,r,i){return i===undefined&&(i=new e(2)),r===0?(i[0]=0,i[1]=0):(i[0]=n[0]*r,i[1]=n[1]*r),i},v2AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s},v2EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s]},v2LessScalarMask:function(t,n){return[t[0]<n,t[1]<n]},v2GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n]},v2GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n]},v2Lerp:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+(r[0]-n[0])*i,s[1]=n[1]+(r[1]-n[1])*i,s},v3BuildZero:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=0,r[2]=0,r},v3BuildOne:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=1,r[1]=1,r[2]=1,r},v3BuildXAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=1,r[1]=0,r[2]=0,r},v3BuildYAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=1,r[2]=0,r},v3BuildZAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=0,r[2]=1,r},v3Build:function(n,r,i,s){var o=s;return o===undefined&&(o=new e(3)),o[0]=n,o[1]=r,o[2]=i,o},v3Copy:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},v3Set:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},v3Neg:function(n,r){return r===undefined&&(r=new e(3)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},v3Add:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0],s[1]=n[1]+r[1],s[2]=n[2]+r[2],s},v3Add3:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s[2]=n[2]+r[2]+i[2],s},v3Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(3)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o[2]=n[2]+r[2]+i[2]+s[2],o},v3Sub:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),s[0]=n[0]-r[0],s[1]=n[1]-r[1],s[2]=n[2]-r[2],s},v3Mul:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i[2]=n[2]*r[2],i},v3MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s[2]=n[2]*r[2]+i[2],s},v3Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},v3Cross:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=n[0],u=n[1],a=n[2],f=r[0],l=r[1],c=r[2];return s[0]=u*c-a*l,s[1]=a*f-o*c,s[2]=o*l-u*f,s},v3LengthSq:function(t){var n=t[0],r=t[1],i=t[2];return n*n+r*r+i*i},v3Length:function(t){var n=t[0],r=t[1],i=t[2];return Math.sqrt(n*n+r*r+i*i)},v3Reciprocal:function(r,i){i===undefined&&(i=new e(3));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i[2]=s(r[2]),i},v3Normalize:function(n,r){var i=r;i===undefined&&(i=new e(3));var s=n[0],o=n[1],u=n[2],a=s*s+o*o+u*u;if(a>0){var f=1/Math.sqrt(a);i[0]=s*f,i[1]=o*f,i[2]=u*f}else i[0]=0,i[1]=0,i[2]=0;return i},v3Abs:function(n,r){var i=r;i===undefined&&(i=new e(3));var s=Math.abs;return i[0]=s(n[0]),i[1]=s(n[1]),i[2]=s(n[2]),i},v3Max:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=Math.max;return s[0]=o(n[0],r[0]),s[1]=o(n[1],r[1]),s[2]=o(n[2],r[2]),s},v3Min:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=Math.min;return s[0]=o(n[0],r[0]),s[1]=o(n[1],r[1]),s[2]=o(n[2],r[2]),s},v3Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r},v3MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s,i(n[2]-r[2])<=s]},v3MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1],t[2]<n[2]]},v3MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1],t[2]>n[2]]},v3MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1],t[2]>=n[2]]},v3MaskNot:function(t){return[!t[0],!t[1],!t[2]]},v3MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1],t[2]||n[2]]},v3MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1],t[2]&&n[2]]},v3Select:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s[2]=n[2]?r[2]:i[2],s},v3ScalarBuild:function(n,r){return r===undefined&&(r=new e(3)),r[0]=n,r[1]=n,r[2]=n,r},v3ScalarMax:function(n,r,i){i===undefined&&(i=new e(3));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i},v3ScalarMin:function(n,r,i){i===undefined&&(i=new e(3));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i},v3ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]+r,i[1]=n[1]+r,i[2]=n[2]+r,i},v3ScalarSub:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]-r,i[1]=n[1]-r,i[2]=n[2]-r,i},v3ScalarMul:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),r===0?(s[0]=0,s[1]=0,s[2]=0):(s[0]=n[0]*r,s[1]=n[1]*r,s[2]=n[2]*r),s},v3AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s[2]=n[2]+r[2]*i,s},v3EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s,i(n[2]-r)<=s]},v3LessScalarMask:function(t,n){return[t[0]<n,t[1]<n,t[2]<n]},v3GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n,t[2]>n]},v3GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n,t[2]>=n]},v3Lerp:function(n,r,i,s){var o=s;return o===undefined&&(o=new e(3)),o[0]=n[0]+(r[0]-n[0])*i,o[1]=n[1]+(r[1]-n[1])*i,o[2]=n[2]+(r[2]-n[2])*i,o},v4BuildZero:function(n){var r=n;return r===undefined&&(r=new e(4)),r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},v4BuildOne:function(n){var r=n;return r===undefined&&(r=new e(4)),r[0]=1,r[1]=1,r[2]=1,r[3]=1,r},v4Build:function(n,r,i,s,o){var u=o;return u===undefined&&(u=new e(4)),u[0]=n,u[1]=r,u[2]=i,u[3]=s,u},v4Copy:function(n,r){var i=r;return i===undefined&&(i=new e(4)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},v4Set:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]},v4Neg:function(n,r){return r===undefined&&(r=new e(4)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},v4Add:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]+r[0],i[1]=n[1]+r[1],i[2]=n[2]+r[2],i[3]=n[3]+r[3],i},v4Add3:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s[2]=n[2]+r[2]+i[2],s[3]=n[3]+r[3]+i[3],s},v4Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(4)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o[2]=n[2]+r[2]+i[2]+s[2],o[3]=n[3]+r[3]+i[3]+s[3],o},v4Sub:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]-r[0],i[1]=n[1]-r[1],i[2]=n[2]-r[2],i[3]=n[3]-r[3],i},v4Mul:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i[2]=n[2]*r[2],i[3]=n[3]*r[3],i},v4MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s[2]=n[2]*r[2]+i[2],s[3]=n[3]*r[3]+i[3],s},v4Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},v4LengthSq:function(t){var n=t[0],r=t[1],i=t[2],s=t[3];return n*n+r*r+i*i+s*s},v4Length:function(t){var n=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(n*n+r*r+i*i+s*s)},v4Reciprocal:function(r,i){i===undefined&&(i=new e(4));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i[2]=s(r[2]),i[3]=s(r[3]),i},v4Normalize:function(n,r){r===undefined&&(r=new e(4));var i=n[0],s=n[1],o=n[2],u=n[3],a=i*i+s*s+o*o+u*u;if(a>0){var f=1/Math.sqrt(a);r[0]=i*f,r[1]=s*f,r[2]=o*f,r[3]=u*f}else r[0]=0,r[1]=0,r[2]=0,r[3]=0;return r},v4Abs:function(n,r){r===undefined&&(r=new e(4));var i=Math.abs;return r[0]=i(n[0]),r[1]=i(n[1]),r[2]=i(n[2]),r[3]=i(n[3]),r},v4Max:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.max;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i[2]=s(n[2],r[2]),i[3]=s(n[3],r[3]),i},v4Min:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.min;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i[2]=s(n[2],r[2]),i[3]=s(n[3],r[3]),i},v4Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r},v4MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s,i(n[2]-r[2])<=s,i(n[3]-r[3])<=s]},v4MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1],t[2]<n[2],t[3]<n[3]]},v4MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1],t[2]>n[2],t[3]>n[3]]},v4MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1],t[2]>=n[2],t[3]>=n[3]]},v4MaskNot:function(t){return[!t[0],!t[1],!t[2],!t[3]]},v4MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1],t[2]||n[2],t[3]||n[3]]},v4MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1],t[2]&&n[2],t[3]&&n[3]]},v4Many:function(t){return t[0]||t[1]||t[2]||t[3]},v4MaskAll:function(t){return t[0]&&t[1]&&t[2]&&t[3]},v4Select:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s[2]=n[2]?r[2]:i[2],s[3]=n[3]?r[3]:i[3],s},v4ScalarBuild:function(n,r){return r===undefined&&(r=new e(4)),r[0]=n,r[1]=n,r[2]=n,r[3]=n,r},v4ScalarMax:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i[3]=s(n[3],r),i},v4ScalarMin:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i[3]=s(n[3],r),i},v4ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]+r,i[1]=n[1]+r,i[2]=n[2]+r,i[3]=n[3]+r,i},v4ScalarSub:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]-r,i[1]=n[1]-r,i[2]=n[2]-r,i[3]=n[3]-r,i},v4ScalarMul:function(r,i,s){return i===0?t.v4BuildZero(s):(s===undefined&&(s=new e(4)),s[0]=r[0]*i,s[1]=r[1]*i,s[2]=r[2]*i,s[3]=r[3]*i,s)},v4AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s[2]=n[2]+r[2]*i,s[3]=n[3]+r[3]*i,s},v4ScalarEqual:function(n,r){var i=Math.abs,s=t.precision;return i(n[0]-r)<=s&&i(n[1]-r)<=s&&i(n[2]-r)<=s&&i(n[3]-r)<=s},v4EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s,i(n[2]-r)<=s,i(n[3]-r)<=s]},v4LessScalarMask:function(t,n){return[t[0]<n,t[1]<n,t[2]<n,t[3]<n]},v4GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n,t[2]>n,t[3]>n]},v4GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n,t[2]>=n,t[3]>=n]},v4Lerp:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+(r[0]-n[0])*i,s[1]=n[1]+(r[1]-n[1])*i,s[2]=n[2]+(r[2]-n[2])*i,s[3]=n[3]+(r[3]-n[3])*i,s},aabbBuild:function(n,r,i,s,o,u,a){var f=a;return f===undefined&&(f=new e(6)),f[0]=n,f[1]=r,f[2]=i,f[3]=s,f[4]=o,f[5]=u,f},aabbBuildEmpty:function(n){var r=this.FLOAT_MAX,i=n;return i===undefined&&(i=new e(6)),i[0]=r,i[1]=r,i[2]=r,i[3]=-r,i[4]=-r,i[5]=-r,i},aabbCopy:function(n,r){var i=r;return i===undefined&&(i=new e(6)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},aabbSet:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5]},aabbIsEmpty:function(t){return t[0]>t[3]},aabbMin:function(t,n){return n===undefined?t.slice(0,3):(n[0]=t[0],n[1]=t[1],n[2]=t[2],n)},aabbMax:function(t,n){return n===undefined?t.slice(3,6):(n[0]=t[3],n[1]=t[4],n[2]=t[5],n)},aabbGetCenterAndHalf:function(t,n,r){var i=(t[0]+t[3])*.5,s=(t[1]+t[4])*.5,o=(t[2]+t[5])*.5;n[0]=i,n[1]=s,n[2]=o,r[0]=t[3]-i,r[1]=t[4]-s,r[2]=t[5]-o},aabbIsInsidePlanes:function(t,n){var r=n.length,i=0;do{var s=n[i],o=s[0],u=s[1],a=s[2],f=o*(o<0?t[0]:t[3])+u*(u<0?t[1]:t[4])+a*(a<0?t[2]:t[5]);if(f<s[3])return!1;i+=1}while(i<r);return!0},aabbIsFullyInsidePlanes:function(t,n){var r=n.length,i=0;do{var s=n[i],o=s[0],u=s[1],a=s[2],f=o*(o>0?t[0]:t[3])+u*(u>0?t[1]:t[4])+a*(a>0?t[2]:t[5]);if(f<s[3])return!1;i+=1}while(i<r);return!0},aabbUnion:function(n,r,i){return i===undefined&&(i=new e(6)),i[0]=n[0]<r[0]?n[0]:r[0],i[1]=n[1]<r[1]?n[1]:r[1],i[2]=n[2]<r[2]?n[2]:r[2],i[3]=n[3]>r[3]?n[3]:r[3],i[4]=n[4]>r[4]?n[4]:r[4],i[5]=n[5]>r[5]?n[5]:r[5],i},aabbUnionArray:function(r,i){i===undefined&&(i=new e(6)),t.aabbCopy(r[0],i);var s=r.length;for(var o=1;o<s;o+=1){var u=r[o];i[0]=i[0]<u[0]?i[0]:u[0],i[1]=i[1]<u[1]?i[1]:u[1],i[2]=i[2]<u[2]?i[2]:u[2],i[3]=i[3]>u[3]?i[3]:u[3],i[4]=i[4]>u[4]?i[4]:u[4],i[5]=i[5]>u[5]?i[5]:u[5]}return i},aabbAddPoints:function(t,n){var r,i=n.length,s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c,h,p,d;for(r=0;r<i;r+=1)c=n[r],h=c[0],p=c[1],d=c[2],s=s<h?s:h,o=o<p?o:p,u=u<d?u:d,a=a>h?a:h,f=f>p?f:p,l=l>d?l:d;t[0]=s,t[1]=o,t[2]=u,t[3]=a,t[4]=f,t[5]=l},aabbTransform:function(n,r,i){i===undefined&&(i=new e(6));var s=(n[0]+n[3])*.5,o=(n[1]+n[4])*.5,u=(n[2]+n[5])*.5,a=n[3]-s,f=n[4]-o,l=n[5]-u,c=r[0],h=r[1],p=r[2],d=r[3],v=r[4],m=r[5],g=r[6],y=r[7],b=r[8],w=r[9]+(c*s+d*o+g*u),E=r[10]+(h*s+v*o+y*u),S=r[11]+(p*s+m*o+b*u),x=Math.abs,T=x(c)*a+x(d)*f+x(g)*l,N=x(h)*a+x(v)*f+x(y)*l,C=x(p)*a+x(m)*f+x(b)*l;return i[0]=w-T,i[1]=E-N,i[2]=S-C,i[3]=w+T,i[4]=E+N,i[5]=S+C,i},aabbIntercept:function(n,r,i){return i===undefined&&(i=new e(6)),i[0]=n[0]>r[0]?n[0]:r[0],i[1]=n[1]>r[1]?n[1]:r[1],i[2]=n[2]>r[2]?n[2]:r[2],i[3]=n[3]<r[3]?n[3]:r[3],i[4]=n[4]<r[4]?n[4]:r[4],i[5]=n[5]<r[5]?n[5]:r[5],i},aabbOverlaps:function(t,n){return t[0]<=n[3]&&t[1]<=n[4]&&t[2]<=n[5]&&t[3]>=n[0]&&t[4]>=n[1]&&t[5]>=n[2]},aabbSphereOverlaps:function(t,n,r){var i=n[0],s=n[1],o=n[2],u=r*r,a=t[0],f=t[1],l=t[2],c=t[3],h=t[4],p=t[5],d=0,v;return i<a?(v=a-i,d+=v*v):i>c&&(v=i-c,d+=v*v),s<f?(v=f-s,d+=v*v):s>h&&(v=s-h,d+=v*v),o<l?(v=l-o,d+=v*v):o>p&&(v=o-p,d+=v*v),d<=u},aabbIsInside:function(t,n){return t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[3]<=n[3]&&t[4]<=n[4]&&t[5]<=n[5]},aabbTestInside:function(t,n){return t[0]<=n[3]&&t[1]<=n[4]&&t[2]<=n[5]&&t[3]>=n[0]&&t[4]>=n[1]&&t[5]>=n[2]?t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[3]<=n[3]&&t[4]<=n[4]&&t[5]<=n[5]?2:1:0},m33BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(9)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},m33Build:function(n,r,i,s){var o,u=arguments.length;return u>=9?(u>9?(o=arguments[9],o===undefined&&(o=new e(9))):o=new e(9),o[0]=arguments[0],o[1]=arguments[1],o[2]=arguments[2],o[3]=arguments[3],o[4]=arguments[4],o[5]=arguments[5],o[6]=arguments[6],o[7]=arguments[7],o[8]=arguments[8]):(o=s,o===undefined&&(o=new e(9)),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=r[0],o[4]=r[1],o[5]=r[2],o[6]=i[0],o[7]=i[1],o[8]=i[2]),o},m33Copy:function(n,r){var i=r;return i===undefined&&(i=new e(9)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},m33FromAxisRotation:function(n,r,i){var s=i;s===undefined&&(s=new e(9));var o=Math.sin(r),u=Math.cos(r),a=1-u,f=n[0],l=n[1],c=n[2],h=a*f,p=a*l,d=a*c,v=o*f,m=o*l,g=o*c;return s[0]=h*f+u,s[1]=h*l-g,s[2]=h*c+m,s[3]=p*f+g,s[4]=p*l+u,s[5]=p*c-v,s[6]=d*f-m,s[7]=d*l+v,s[8]=d*c+u,s},m33FromQuat:function(n,r){var i=r;i===undefined&&(i=new e(9));var s=n[0],o=n[1],u=n[2],a=n[3],f=2*s*s,l=2*o*o,c=2*u*u,h=2*s*o,p=2*u*a,d=2*s*u,v=2*o*a,m=2*o*u,g=2*s*a;return i[0]=1-l-c,i[1]=h-p,i[2]=d+v,i[3]=h+p,i[4]=1-f-c,i[5]=m-g,i[6]=d-v,i[7]=m+g,i[8]=1-f-l,i},m33Right:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},m33Up:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[3],i[1]=n[4],i[2]=n[5],i},m33At:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[6],i[1]=n[7],i[2]=n[8],i},m33SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},m33SetUp:function(t,n){t[3]=n[0],t[4]=n[1],t[5]=n[2]},m33SetAt:function(t,n){t[6]=n[0],t[7]=n[1],t[8]=n[2]},m33Transpose:function(n,r){r===undefined&&(r=new e(9));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8];return r[0]=i,r[1]=u,r[2]=l,r[3]=s,r[4]=a,r[5]=c,r[6]=o,r[7]=f,r[8]=h,r},m33Determinant:function(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return n*(o*l-u*f)+r*(u*a-s*l)+i*(s*f-o*a)},m33Inverse:function(n,r){r===undefined&&(r=new e(9));var i=h*m-p*v,s=p*d-c*m,o=c*v-h*d,u=a*i+f*s+l*o;if(u===0)return r[0]=r[1]=r[2]=0,r[3]=r[4]=r[5]=0,r[6]=r[7]=r[8]=0,r;var a=n[0],f=n[1],l=n[2],c=n[3],h=n[4],p=n[5],d=n[6],v=n[7],m=n[8],g=1/u;return r[0]=i*g,r[1]=(v*l-m*f)*g,r[2]=(f*p-l*h)*g,r[3]=s*g,r[4]=(m*a-d*l)*g,r[5]=(c*l-a*p)*g,r[6]=o*g,r[7]=(d*f-v*a)*g,r[8]=(a*h-c*f)*g,r},m33InverseTranspose:function(n,r){var i=r;i===undefined&&(i=new e(9));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=f*p-l*h,v=l*c-a*p,m=a*h-f*c,g=s*d+o*v+u*m;if(g===0)i[0]=i[1]=i[2]=0,i[3]=i[4]=i[5]=0,i[6]=i[7]=i[8]=0;else{var y=1/g;i[0]=d*y,i[3]=(h*u-p*o)*y,i[6]=(o*l-u*f)*y,i[1]=v*y,i[4]=(p*s-c*u)*y,i[7]=(a*u-s*l)*y,i[2]=m*y,i[5]=(c*o-h*s)*y,i[8]=(s*f-a*o)*y}return i},m33Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8];return i===undefined&&(i=new e(9)),i[0]=d*s+g*o+w*u,i[1]=v*s+y*o+E*u,i[2]=m*s+b*o+S*u,i[3]=d*a+g*f+w*l,i[4]=v*a+y*f+E*l,i[5]=m*a+b*f+S*l,i[6]=d*c+g*h+w*p,i[7]=v*c+y*h+E*p,i[8]=m*c+b*h+S*p,i},m33Transform:function(n,r,i){i===undefined&&(i=new e(3));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s+n[3]*o+n[6]*u,i[1]=n[1]*s+n[4]*o+n[7]*u,i[2]=n[2]*s+n[5]*o+n[8]*u,i},m33Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r&&i(t[4]-n[4])<=r&&i(t[5]-n[5])<=r&&i(t[6]-n[6])<=r&&i(t[7]-n[7])<=r&&i(t[8]-n[8])<=r},m33MulM43:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8];return i[0]=d*s+g*o+w*u,i[1]=v*s+y*o+E*u,i[2]=m*s+b*o+S*u,i[3]=d*a+g*f+w*l,i[4]=v*a+y*f+E*l,i[5]=m*a+b*f+S*l,i[6]=d*c+g*h+w*p,i[7]=v*c+y*h+E*p,i[8]=m*c+b*h+S*p,i[9]=r[9],i[10]=r[10],i[11]=r[11],i},m33MulM44:function(n,r,i){i===undefined&&(i=new e(16));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8],x=r[9],T=r[10],N=r[11];return i[0]=d*s+y*o+S*u,i[1]=v*s+b*o+x*u,i[2]=m*s+w*o+T*u,i[3]=g*s+E*o+N*u,i[4]=d*a+y*f+S*l,i[5]=v*a+b*f+x*l,i[6]=m*a+w*f+T*l,i[7]=g*a+E*f+N*l,i[8]=d*c+y*h+S*p,i[9]=v*c+b*h+x*p,i[10]=m*c+w*h+T*p,i[11]=g*c+E*h+N*p,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i},m33ScalarAdd:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]+r;return i},m33ScalarSub:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]-r;return i},m33ScalarMul:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]*r;return i},m34BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(12)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r},m34Pos:function(n,r){return r===undefined&&(r=new e(3)),r[0]=n[3],r[1]=n[7],r[2]=n[11],r},m34Scale:function(n,r,i){i===undefined&&(i=new e(12));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3],i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7],i[8]=n[8]*u,i[9]=n[9]*u,i[10]=n[10]*u,i[11]=n[11],i},m43BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(12)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r[9]=0,r[10]=0,r[11]=0,r},m43Build:function(n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m=arguments.length;return m>=12?(m>12?(v=arguments[12],v===undefined&&(v=new e(12))):v=new e(12),v[0]=arguments[0],v[1]=arguments[1],v[2]=arguments[2],v[3]=arguments[3],v[4]=arguments[4],v[5]=arguments[5],v[6]=arguments[6],v[7]=arguments[7],v[8]=arguments[8],v[9]=arguments[9],v[10]=arguments[10],v[11]=arguments[11]):(v=o,v===undefined&&(v=new e(12)),v[0]=n[0],v[1]=n[1],v[2]=n[2],v[3]=r[0],v[4]=r[1],v[5]=r[2],v[6]=i[0],v[7]=i[1],v[8]=i[2],v[9]=s[0],v[10]=s[1],v[11]=s[2]),v},m43BuildTranslation:function(n,r,i,s){var o;return 3<=arguments.length?(o=s,o===undefined&&(o=new e(12)),o[9]=n,o[10]=r,o[11]=i):(o=r,o===undefined&&(o=new e(12)),o[9]=n[0],o[10]=n[1],o[11]=n[2]),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},m43Copy:function(n,r){var i=r;return i===undefined&&(i=new e(12)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i},m43FromM33V3:function(n,r,i){var s=i;return s===undefined&&(s=new e(12)),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=r[0],s[10]=r[1],s[11]=r[2],s},m43FromAxisRotation:function(n,r,i){var s=Math.sin(r),o=Math.cos(r),u=1-o,a=n[0],f=n[1],l=n[2],c=u*a,h=u*f,p=u*l,d=s*a,v=s*f,m=s*l,g=i;return g===undefined&&(g=new e(12)),g[0]=c*a+o,g[1]=c*f-m,g[2]=c*l+v,g[3]=h*a+m,g[4]=h*f+o,g[5]=h*l-d,g[6]=p*a-v,g[7]=p*f+d,g[8]=p*l+o,g[9]=0,g[10]=0,g[11]=0,g},m43FromQuatPos:function(n,r){var i=r;i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=2*s*s,p=2*o*o,d=2*u*u,v=2*s*o,m=2*u*a,g=2*s*u,y=2*o*a,b=2*o*u,w=2*s*a;return i[0]=1-p-d,i[1]=v-m,i[2]=g+y,i[3]=v+m,i[4]=1-h-d,i[5]=b-w,i[6]=g-y,i[7]=b+w,i[8]=1-h-p,i[9]=f,i[10]=l,i[11]=c,i},m43FromRTS:function(n,r,i,s){var o=n[0],u=n[1],a=n[2],f=n[3],l=2*o*o,c=2*u*u,h=2*a*a,p=2*o*u,d=2*a*f,v=2*o*a,m=2*u*f,g=2*u*a,y=2*o*f,b=i[0],w=i[1],E=i[2],S=s;return S===undefined&&(S=new e(12)),S[0]=b*(1-c-h),S[1]=b*(p-d),S[2]=b*(v+m),S[3]=w*(p+d),S[4]=w*(1-l-h),S[5]=w*(g-y),S[6]=E*(v-m),S[7]=E*(g+y),S[8]=E*(1-l-c),S[9]=r[0],S[10]=r[1],S[11]=r[2],S},m43FromRT:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=2*s*s,l=2*o*o,c=2*u*u,h=2*s*o,p=2*u*a,d=2*s*u,v=2*o*a,m=2*o*u,g=2*s*a,y=i;return y===undefined&&(y=new e(12)),y[0]=1-l-c,y[1]=h-p,y[2]=d+v,y[3]=h+p,y[4]=1-f-c,y[5]=m-g,y[6]=d-v,y[7]=m+g,y[8]=1-f-l,y[9]=r[0],y[10]=r[1],y[11]=r[2],y},m43Right:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},m43Up:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[3],i[1]=n[4],i[2]=n[5],i},m43At:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[6],i[1]=n[7],i[2]=n[8],i},m43Pos:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[9],i[1]=n[10],i[2]=n[11],i},m43SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},m43SetUp:function(t,n){t[3]=n[0],t[4]=n[1],t[5]=n[2]},m43SetAt:function(t,n){t[6]=n[0],t[7]=n[1],t[8]=n[2]},m43SetPos:function(t,n){t[9]=n[0],t[10]=n[1],t[11]=n[2]},m43SetAxisRotation:function(t,n,r){var i=Math.sin(r),s=Math.cos(r),o=1-s,u=n[0],a=n[1],f=n[2],l=o*u,c=o*a,h=o*f,p=i*u,d=i*a,v=i*f;t[0]=l*u+s,t[1]=l*a-v,t[2]=l*f+d,t[3]=c*u+v,t[4]=c*a+s,t[5]=c*f-p,t[6]=h*u-d,t[7]=h*a+p,t[8]=h*f+s},m43InverseOrthonormal:function(n,r){r===undefined&&(r=new e(12));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11];return r[0]=i,r[1]=u,r[2]=l,r[3]=s,r[4]=a,r[5]=c,r[6]=o,r[7]=f,r[8]=h,r[9]=-(p*i+d*s+v*o),r[10]=-(p*u+d*a+v*f),r[11]=-(p*l+d*c+v*h),r},m43Orthonormalize:function(r,i){var s=t.v3Normalize,o=t.v3Length,u=t.v3Dot,a=t.v3Cross,f=Math.abs,l=t.m43Right(r),c=t.m43Up(r),h=t.m43At(r),p=t.m43Pos(r),d=o(l),v=o(c),m=o(h);s(l,l),s(c,c),s(h,h);var g,y,b;if(d>0)if(v>0)if(m>0){var w=f(u(c,h)),E=f(u(h,l)),S=f(u(l,c));w<E?w<S?(g=c,y=h,b=l):(g=l,y=c,b=h):E<S?(g=h,y=l,b=c):(g=l,y=c,b=h)}else g=l,y=c,b=h;else g=h,y=l,b=c;else g=c,y=h,b=l;return a(g,y,b),s(b,b),a(b,g,y),s(y,y),i===undefined&&(i=new e(12)),i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=c[0],i[4]=c[1],i[5]=c[2],i[6]=h[0],i[7]=h[1],i[8]=h[2],i[9]=p[0],i[10]=p[1],i[11]=p[2],i},m43Determinant:function(t){return t[0]*(t[4]*t[8]-t[5]*t[7])+t[1]*(t[5]*t[6]-t[3]*t[8])+t[2]*(t[3]*t[7]-t[4]*t[6])},m43Inverse:function(n,r){r===undefined&&(r=new e(12));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=a*h-f*c,g=f*l-u*h,y=u*c-a*l,b=i*m+s*g+o*y;if(b===0)return r;r===undefined&&(r=new e(12));var w=1/b;return r[0]=m*w,r[1]=(c*o-h*s)*w,r[2]=(s*f-o*a)*w,r[3]=g*w,r[4]=(h*i-l*o)*w,r[5]=(u*o-i*f)*w,r[6]=y*w,r[7]=(l*s-c*i)*w,r[8]=(i*a-u*s)*w,r[9]=(u*(d*h-c*v)+a*(l*v-p*h)+f*(p*c-l*d))*w,r[10]=(l*(o*d-s*v)+c*(i*v-p*o)+h*(p*s-i*d))*w,r[11]=(p*(o*a-s*f)+d*(i*f-u*o)+v*(u*s-i*a))*w,r},m43Translate:function(t,n){t[9]+=n[0],t[10]+=n[1],t[11]+=n[2]},m43Scale:function(n,r,i){i===undefined&&(i=new e(12));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*u,i[7]=n[7]*u,i[8]=n[8]*u,i[9]=n[9],i[10]=n[10],i[11]=n[11],i},m43TransformVector:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=r[0],u=r[1],a=r[2];return s[0]=n[0]*o+n[3]*u+n[6]*a,s[1]=n[1]*o+n[4]*u+n[7]*a,s[2]=n[2]*o+n[5]*u+n[8]*a,s},m43TransformPoint:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=r[0],u=r[1],a=r[2];return s[0]=n[0]*o+n[3]*u+n[6]*a+n[9],s[1]=n[1]*o+n[4]*u+n[7]*a+n[10],s[2]=n[2]*o+n[5]*u+n[8]*a+n[11],s},m43Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=i;return C===undefined&&(C=new e(12)),C[0]=g*s+w*o+x*u,C[1]=y*s+E*o+T*u,C[2]=b*s+S*o+N*u,C[3]=g*a+w*f+x*l,C[4]=y*a+E*f+T*l,C[5]=b*a+S*f+N*l,C[6]=g*c+w*h+x*p,C[7]=y*c+E*h+T*p,C[8]=b*c+S*h+N*p,C[9]=g*d+w*v+x*m+r[9],C[10]=y*d+E*v+T*m+r[10],C[11]=b*d+S*v+N*m+r[11],C},m43MulM44:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=r[9],k=r[10],L=r[11],A=i;return A===undefined&&(A=new e(16)),A[0]=g*s+E*o+N*u,A[1]=y*s+S*o+C*u,A[2]=b*s+x*o+k*u,A[3]=w*s+T*o+L*u,A[4]=g*a+E*f+N*l,A[5]=y*a+S*f+C*l,A[6]=b*a+x*f+k*l,A[7]=w*a+T*f+L*l,A[8]=g*c+E*h+N*p,A[9]=y*c+S*h+C*p,A[10]=b*c+x*h+k*p,A[11]=w*c+T*h+L*p,A[12]=g*d+E*v+N*m+r[12],A[13]=y*d+S*v+C*m+r[13],A[14]=b*d+x*v+k*m+r[14],A[15]=w*d+T*v+L*m+r[15],A},m43Transpose:function(n,r){var i=r;i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11];return i[0]=s,i[1]=a,i[2]=c,i[3]=d,i[4]=o,i[5]=f,i[6]=h,i[7]=v,i[8]=u,i[9]=l,i[10]=p,i[11]=m,i},m43MulTranspose:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=r[9],k=r[10],L=r[11],A=i;return A===undefined&&(A=new e(12)),A[0]=g*s+w*o+x*u,A[1]=g*a+w*f+x*l,A[2]=g*c+w*h+x*p,A[3]=g*d+w*v+x*m+C,A[4]=y*s+E*o+T*u,A[5]=y*a+E*f+T*l,A[6]=y*c+E*h+T*p,A[7]=y*d+E*v+T*m+k,A[8]=b*s+S*o+N*u,A[9]=b*a+S*f+N*l,A[10]=b*c+S*h+N*p,A[11]=b*d+S*v+N*m+L,A},m43Offset:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2];return i[0]=s,i[1]=o,i[2]=u,i[3]=a,i[4]=f,i[5]=l,i[6]=c,i[7]=h,i[8]=p,i[9]=s*g+a*y+c*b+d,i[10]=o*g+f*y+h*b+v,i[11]=u*g+l*y+p*b+m,i},m43NegOffset:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=-r[0],y=-r[1],b=-r[2];return i[0]=s,i[1]=o,i[2]=u,i[3]=a,i[4]=f,i[5]=l,i[6]=c,i[7]=h,i[8]=p,i[9]=s*g+a*y+c*b+d,i[10]=o*g+f*y+h*b+v,i[11]=u*g+l*y+p*b+m,i},m43InverseTransposeProjection:function(n,r,i){i===undefined&&(i=new e(12));var s=.5/r[0],o=.5/r[1],u=.5/r[2],a=n[0]*s,f=n[1]*s,l=n[2]*s,c=n[3]*o,h=n[4]*o,p=n[5]*o,d=n[6]*u,v=n[7]*u,m=n[8]*u,g=n[9],y=n[10],b=n[11];return i[0]=a,i[1]=f,i[2]=l,i[3]=.5-(g*a+y*f+b*l),i[4]=c,i[5]=h,i[6]=p,i[7]=.5-(g*c+y*h+b*p),i[8]=d,i[9]=v,i[10]=m,i[11]=.5-(g*d+y*v+b*m),i},m43ScalarAdd:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]+r;return i},m43ScalarSub:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]-r;return i},m43ScalarMul:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]*r;return i},m44BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(16)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},m44Build:function(n,r,i,s,o){var u,a=arguments.length;return a>=16?(a>16?(u=arguments[16],u===undefined&&(u=new e(16))):u=new e(16),u[0]=arguments[0],u[1]=arguments[1],u[2]=arguments[2],u[3]=arguments[3],u[4]=arguments[4],u[5]=arguments[5],u[6]=arguments[6],u[7]=arguments[7],u[8]=arguments[8],u[9]=arguments[9],u[10]=arguments[10],u[11]=arguments[11],u[12]=arguments[12],u[13]=arguments[13],u[14]=arguments[14],u[15]=arguments[15]):(u=o,u===undefined&&(u=new e(16)),u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3],u[4]=r[0],u[5]=r[1],u[6]=r[2],u[7]=r[3],u[8]=i[0],u[9]=i[1],u[10]=i[2],u[11]=i[3],u[12]=s[0],u[13]=s[1],u[14]=s[2],u[15]=s[3]),u},m44Copy:function(n,r){return r===undefined&&(r=new e(16)),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},m44Right:function(t,n){return n===undefined?t.slice(0,4):(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n)},m44Up:function(t,n){return n===undefined?t.slice(4,8):(n[0]=t[4],n[1]=t[5],n[2]=t[6],n[3]=t[7],n)},m44At:function(t,n){return n===undefined?t.slice(8,12):(n[0]=t[8],n[1]=t[9],n[2]=t[10],n[3]=t[11],n)},m44Pos:function(t,n){return n===undefined?t.slice(12):(n[0]=t[12],n[1]=t[13],n[2]=t[14],n[3]=t[15],n)},m44SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]},m44SetUp:function(t,n){t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3]},m44SetAt:function(t,n){t[8]=n[0],t[9]=n[1],t[10]=n[2],t[11]=n[3]},m44SetPos:function(t,n){t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=n[3]},m44Translate:function(t,n){t[12]+=n[0],t[13]+=n[1],t[14]+=n[2],t[15]+=n[3]},m44Scale:function(n,r,i){return i===undefined&&(i=new e(16)),i[0]=n[0]*r[0],i[1]=n[1]*r[0],i[2]=n[2]*r[0],i[3]=n[3],i[4]=n[4]*r[1],i[5]=n[5]*r[1],i[6]=n[6]*r[1],i[7]=n[7],i[8]=n[8]*r[2],i[9]=n[9]*r[2],i[10]=n[10]*r[2],i[11]=n[11],i
[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},m44Transform:function(n,r,i){var s=r[0],o=r[1],u=r[2],a=r[3];return i===undefined&&(i=new e(4)),a!==1?(i[0]=n[0]*s+n[4]*o+n[8]*u+n[12]*a,i[1]=n[1]*s+n[5]*o+n[9]*u+n[13]*a,i[2]=n[2]*s+n[6]*o+n[10]*u+n[14]*a,i[3]=n[3]*s+n[7]*o+n[11]*u+n[15]*a):(i[0]=n[0]*s+n[4]*o+n[8]*u+n[12],i[1]=n[1]*s+n[5]*o+n[9]*u+n[13],i[2]=n[2]*s+n[6]*o+n[10]*u+n[14],i[3]=n[3]*s+n[7]*o+n[11]*u+n[15]),i},m44Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=n[12],y=n[13],b=n[14],w=n[15],E=r[0],S=r[1],x=r[2],T=r[3],N=r[4],C=r[5],k=r[6],L=r[7],A=r[8],O=r[9],M=r[10],_=r[11],D=r[12],P=r[13],H=r[14],B=r[15];return i===undefined&&(i=new e(16)),i[0]=E*s+N*o+A*u+D*a,i[1]=S*s+C*o+O*u+P*a,i[2]=x*s+k*o+M*u+H*a,i[3]=T*s+L*o+_*u+B*a,i[4]=E*f+N*l+A*c+D*h,i[5]=S*f+C*l+O*c+P*h,i[6]=x*f+k*l+M*c+H*h,i[7]=T*f+L*l+_*c+B*h,i[8]=E*p+N*d+A*v+D*m,i[9]=S*p+C*d+O*v+P*m,i[10]=x*p+k*d+M*v+H*m,i[11]=T*p+L*d+_*v+B*m,i[12]=E*g+N*y+A*b+D*w,i[13]=S*g+C*y+O*b+P*w,i[14]=x*g+k*y+M*b+H*w,i[15]=T*g+L*y+_*b+B*w,i},m44Inverse:function(n,r){var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=n[12],g=n[13],y=n[14],b=n[15];r===undefined&&(r=new e(16));var w=i*f-s*a,E=i*l-o*a,S=i*c-u*a,x=s*l-o*f,T=s*c-u*f,N=o*c-u*l,C=h*g-p*m,k=h*y-d*m,L=h*b-v*m,A=p*y-d*g,O=p*b-v*g,M=d*b-v*y,_=w*M-E*O+S*A+x*L-T*k+N*C;if(_===0)r[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=0;else{var D=1/_;r[0]=(+(f*M)-l*O+c*A)*D,r[4]=(-(a*M)+l*L-c*k)*D,r[8]=(+(a*O)-f*L+c*C)*D,r[12]=(-(a*A)+f*k-l*C)*D,r[1]=(-(s*M)+o*O-u*A)*D,r[5]=(+(i*M)-o*L+u*k)*D,r[9]=(-(i*O)+s*L-u*C)*D,r[13]=(+(i*A)-s*k+o*C)*D,r[2]=(+(g*N)-y*T+b*x)*D,r[6]=(-(m*N)+y*S-b*E)*D,r[10]=(+(m*T)-g*S+b*w)*D,r[14]=(-(m*x)+g*E-y*w)*D,r[3]=(-(p*N)+d*T-v*x)*D,r[7]=(+(h*N)-d*S+v*E)*D,r[11]=(-(h*T)+p*S-v*w)*D,r[15]=(+(h*x)-p*E+d*w)*D}return r},m44Transpose:function(n,r){return r===undefined&&(r=new e(16)),r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15],r},m44ScalarAdd:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]+r;return i},m44ScalarSub:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]-r;return i},m44ScalarMul:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]*r;return i},quatBuild:function(n,r,i,s,o){var u=o;return u===undefined&&(u=new e(4)),u[0]=n,u[1]=r,u[2]=i,u[3]=s,u},quatCopy:function(n,r){var i=r;return i===undefined&&(i=new e(4)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},quatIsSimilar:function(n,r,i){i===undefined&&(i=this.precision);var s=n;n[3]*r[3]<0&&(s=t.v4Neg(n));var o=t.v4LengthSq(t.v4Sub(s,r)),u=i*i;return o<u},quatLength:function(n){return t.v4Length(n)},quatDot:function(n,r){return t.v4Dot(n,r)},quatMul:function(n,r,i){i===undefined&&(i=new e(4));var s=n[0],o=n[1],u=n[2],a=n[3],f=r[0],l=r[1],c=r[2],h=r[3],p=c*o-l*u,d=f*u-c*s,v=l*s-f*o;return i[0]=s*h+f*a+p,i[1]=o*h+l*a+d,i[2]=u*h+c*a+v,i[3]=h*a-(f*s+l*o+c*u),i},quatMulTranslate:function(t,n,r,i,s,o){var u=t[0],a=t[1],f=t[2],l=t[3],c=r[0],h=r[1],p=r[2],d=r[3],v=f*h-a*p,m=u*p-f*c,g=a*c-u*h;s[0]=c*l+u*d+v,s[1]=h*l+a*d+m,s[2]=p*l+f*d+g,s[3]=l*d-(u*c+a*h+f*p);var y=n[0],b=n[1],w=n[2],E=i[0],S=i[1],x=i[2],T=l*l-(u*u+a*a+f*f),N=E*T,C=S*T,k=x*T;T=u*E+a*S+f*x;var L=T+T;N+=u*L,C+=a*L,k+=f*L,v=f*S-a*x,m=u*x-f*E,g=a*E-u*S;var A=l+l;N+=v*A,C+=m*A,k+=g*A,o[0]=N+y,o[1]=C+b,o[2]=k+w},quatNormalize:function(n,r){var i=t.quatDot(n,n);if(i===0)return t.v4BuildZero(r);var s=1/Math.sqrt(i);return t.v4ScalarMul(n,s,r)},quatConjugate:function(n,r){return r===undefined&&(r=new e(4)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},quatLerp:function(n,r,i,s){s===undefined&&(s=new e(4));var o=n[0],u=n[1],a=n[2],f=n[3],l=r[0],c=r[1],h=r[2],p=r[3];return s[0]=(l-o)*i+o,s[1]=(c-u)*i+u,s[2]=(h-a)*i+a,s[3]=(p-f)*i+f,s},cosMinSlerpAngle:Math.cos(Math.PI/40),quatSlerp:function(r,i,s,o){var u=o;u===undefined&&(u=new e(4));var a=r[0],f=r[1],l=r[2],c=r[3],h=i[0],p=i[1],d=i[2],v=i[3],m=a*h+f*p+l*d+c*v,g=m;g<0&&(a=-a,f=-f,l=-l,c=-c,g=-g);if(g>t.cosMinSlerpAngle){if(g>1-1e-6)return u[0]=a,u[1]=f,u[2]=l,u[3]=c,u;var y=s;m<=0&&(y=-s);var b=(h-a)*y+a,w=(p-f)*y+f,E=(d-l)*y+l,S=(v-c)*y+c,x=Math.sqrt(b*b+w*w+E*E+S*S),T=1/x;return u[0]=b*T,u[1]=w*T,u[2]=E*T,u[3]=S*T,u}var N=Math.sin,C=Math.acos(g),k=1/N(C),L=N((1-s)*C)*k;return a*=L,f*=L,l*=L,c*=L,L=N(s*C)*k,h*=L,p*=L,d*=L,v*=L,u[0]=a+h,u[1]=f+p,u[2]=l+d,u[3]=c+v,u},quatFromM43:function(n,r){var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p,d,v,m,g,y=i+a+h+1;y>t.precision?(m=Math.sqrt(y)/2,p=(f-c)/(4*m),d=(l-o)/(4*m),v=(s-u)/(4*m)):i>a&&i>h?(g=Math.sqrt(1+i-a-h)*2,m=(f-c)/g,p=.25*g,d=(u+s)/g,v=(l+o)/g):a>h?(g=Math.sqrt(1+a-i-h)*2,m=(l-o)/g,p=(u+s)/g,d=.25*g,v=(c+f)/g):(g=Math.sqrt(1+h-i-a)*2,m=(s-u)/g,p=(l+o)/g,d=(c+f)/g,v=.25*g);var b=t.quatNormalize([p,d,v,m],r);return t.quatConjugate(b,r)},quatFromAxisRotation:function(r,i,s){var o=.5*i,u=Math.sin(o),a=Math.cos(o),f=s;return f===undefined&&(f=new e(4)),f[0]=r[0]*u,f[1]=r[1]*u,f[2]=r[2]*u,f[3]=a,t.quatNormalize(f,f)},quatToAxisRotation:function(r,i){i===undefined&&(i=new e(4));var s=r[3],o=Math.acos(s)*2,u=1-s*s;if(u<t.precision)i[0]=1,i[1]=0,i[2]=0,i[3]=o;else{var a=1/Math.sqrt(u);i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=o}return i},quatTransformVector:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=r[0],l=r[1],c=r[2],h=a*a-(s*s+o*o+u*u),p=f*h,d=l*h,v=c*h;h=s*f+o*l+u*c;var m=h+h;p+=s*m,d+=o*m,v+=u*m;var g=u*l-o*c,y=s*c-u*f,b=o*f-s*l,w=a+a;return p+=g*w,d+=y*w,v+=b*w,i===undefined&&(i=new e(3)),i[0]=p,i[1]=d,i[2]=v,i},quatEqual:function(t,n,r){r===undefined&&(r=this.precision);var i=Math.abs;return i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r},quatPosBuild:function(n,r,i,s,o,u,a,f){var l;return arguments.length<7?(l=i,l===undefined&&(l=new e(7)),l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=r[0],l[5]=r[1],l[6]=r[2]):(l=f,l===undefined&&(l=new e(7)),l[0]=n,l[1]=r,l[2]=i,l[3]=s,l[4]=o,l[5]=u,l[6]=a),l},quatPosTransformVector:function(n,r,i){return t.quatTransformVector(n,r,i)},quatPosTransformPoint:function(n,r){var i=n.slice(4,7),s=t.quatTransformVector(n,r);return t.v3Add(s,i)},quatPosMul:function(n,r){var i=r.slice(4,7),s=t.quatMul(n,r),o=t.quatPosTransformPoint(n,i);return s[4]=o[0],s[5]=o[1],s[6]=o[2],s},isVisibleBox:function(t,n,r){var i=Math.abs,s=t[0],o=t[1],u=t[2],a=n[0],f=n[1],l=n[2],c=r[0],h=r[1],p=r[2],d=r[3],v=r[4],m=r[5],g=r[6],y=r[7],b=r[8],w=r[9],E=r[10],S=r[11],x=c*a,T=h*a,N=p*a,C=d*a,k=v*f,L=m*f,A=g*f,O=y*f,M=b*l,_=w*l,D=E*l,P=S*l,H=c*s+v*o+b*u+r[12],B=h*s+m*o+w*u+r[13],j=p*s+g*o+E*u+r[14],F=d*s+y*o+S*u+r[15];return!(H-F>i(x-C)+i(k-O)+i(M-P)||H+F<-(i(x+C)+i(k+O)+i(M+P))||B-F>i(T-C)+i(L-O)+i(_-P)||B+F<-(i(T+C)+i(L+O)+i(_+P))||j-F>i(N-C)+i(A-O)+i(D-P)||j+F<-(i(N+C)+i(A+O)+i(D+P))||F+F<-(i(C+C)+i(O+O)+i(P+P)))},isVisibleBoxOrigin:function(t,n){var r=Math.abs,i=t[0],s=t[1],o=t[2],u=n[0]*i,a=n[1]*i,f=n[2]*i,l=n[3]*i,c=n[4]*s,h=n[5]*s,p=n[6]*s,d=n[7]*s,v=n[8]*o,m=n[9]*o,g=n[10]*o,y=n[11]*o,b=n[12],w=n[13],E=n[14],S=n[15];return!(b-S>r(u-l)+r(c-d)+r(v-y)||b+S<-(r(u+l)+r(c+d)+r(v+y))||w-S>r(a-l)+r(h-d)+r(m-y)||w+S<-(r(a+l)+r(h+d)+r(m+y))||E-S>r(f-l)+r(p-d)+r(g-y)||E+S<-(r(f+l)+r(p+d)+r(g+y))||S+S<-(r(l+l)+r(d+d)+r(y+y)))},isVisibleSphere:function(t,n,r){var i=Math.abs,s=t[0],o=t[1],u=t[2],a=r[0],f=r[1],l=r[2],c=r[3],h=r[4],p=r[5],d=r[6],v=r[7],m=r[8],g=r[9],y=r[10],b=r[11],w=a,E=f,S=l,x=c,T=h,N=p,C=d,k=v,L=m,A=g,O=y,M=b,_=a*s+h*o+m*u+r[12],D=f*s+p*o+g*u+r[13],P=l*s+d*o+y*u+r[14],H=c*s+v*o+b*u+r[15],B=-n;return!(_-H>n*(i(w-x)+i(T-k)+i(L-M))||_+H<B*(i(w+x)+i(T+k)+i(L+M))||D-H>n*(i(E-x)+i(N-k)+i(A-M))||D+H<B*(i(E+x)+i(N+k)+i(A+M))||P-H>n*(i(S-x)+i(C-k)+i(O-M))||P+H<B*(i(S+x)+i(C+k)+i(O+M))||H+H<B*(i(x+x)+i(k+k)+i(M+M)))},isVisibleSphereOrigin:function(t,n){var r=Math.abs,i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=n[12],g=n[13],y=n[14],b=n[15],w=-t;return!(m-b>t*(r(i-u)+r(a-c)+r(h-v))||m+b<w*(r(i+u)+r(a+c)+r(h+v))||g-b>t*(r(s-u)+r(f-c)+r(p-v))||g+b<w*(r(s+u)+r(f+c)+r(p+v))||y-b>t*(r(o-u)+r(l-c)+r(d-v))||y+b<w*(r(o+u)+r(l+c)+r(d+v))||b+b<w*(r(u+u)+r(c+c)+r(v+v)))},isVisibleSphereUnit:function(t){var n=Math.abs,r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15];return!(v-y>n(r-o)+n(u-l)+n(c-d)||v+y<-(n(r+o)+n(u+l)+n(c+d))||m-y>n(i-o)+n(a-l)+n(h-d)||m+y<-(n(i+o)+n(a+l)+n(h+d))||g-y>n(s-o)+n(f-l)+n(p-d)||g+y<-(n(s+o)+n(f+l)+n(p+d))||y+y<-(n(o+o)+n(l+l)+n(d+d)))},transformBox:function(n,r,i){var s=Math.abs,o=i[0],u=i[1],a=i[2],f=i[3],l=i[4],c=i[5],h=i[6],p=i[7],d=i[8],v=n[0],m=n[1],g=n[2],y=r[0],b=r[1],w=r[2],E=new e(3);E[0]=o*v+f*m+h*g+i[9],E[1]=u*v+l*m+p*g+i[10],E[2]=a*v+c*m+d*g+i[11];var S=new e(3);return S[0]=s(o)*y+s(f)*b+s(h)*w,S[1]=s(u)*y+s(l)*b+s(p)*w,S[2]=s(a)*y+s(c)*b+s(d)*w,{center:E,halfExtents:E}},planeNormalize:function(n,r){r===undefined&&(r=new e(4));var i=n[0],s=n[1],o=n[2],u=i*i+s*s+o*o;if(u>0){var a=1/Math.sqrt(u);r[0]=i*a,r[1]=s*a,r[2]=o*a,r[3]=n[3]*a}else r[0]=0,r[1]=0,r[2]=0,r[3]=0;return r},extractFrustumPlanes:function(n,r){var i=t.planeNormalize,s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=n[12],y=n[13],b=n[14],w=n[15],E=r||[];return E[0]=i([a+s,h+f,m+p,-(w+g)],E[0]),E[1]=i([a-s,h-f,m-p,-(w-g)],E[1]),E[2]=i([a-o,h-l,m-d,-(w-y)],E[2]),E[3]=i([a+o,h+l,m+d,-(w+y)],E[3]),E[4]=i([a+u,h+c,m+v,-(w+b)],E[4]),E[5]=i([a-u,h-c,m-v,-(w-b)],E[5]),E},isInsidePlanesPoint:function(t,n){var r=t[0],i=t[1],s=t[2],o=n.length,u=0;do{var a=n[u];if(a[0]*r+a[1]*i+a[2]*s<a[3])return!1;u+=1}while(u<o);return!0},isInsidePlanesSphere:function(t,n,r){var i=t[0],s=t[1],o=t[2],u=r.length,a=0;do{var f=r[a];if(f[0]*i+f[1]*s+f[2]*o<f[3]-n)return!1;a+=1}while(a<u);return!0},isInsidePlanesBox:function(t,n,r){var i=t[0],s=t[1],o=t[2],u=n[0],a=n[1],f=n[2],l=i+u,c=s+a,h=o+f,p=i-u,d=s-a,v=o-f,m=r.length,g=0;do{var y=r[g],b=y[0],w=y[1],E=y[2];if(b*(b<0?p:l)+w*(w<0?d:c)+E*(E<0?v:h)<y[3])return!1;g+=1}while(g<m);return!0},extractIntersectingPlanes:function(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n.length,l=[],c=0,h=0;do{var p=n[h],d=p[0],v=p[1],m=p[2];d*(d>0?r:o)+v*(v>0?i:u)+m*(m>0?s:a)<p[3]&&(l[c]=p,c+=1),h+=1}while(h<f);return l}};if(typeof Float32Array!="undefined"){var n=new Float32Array([1,2,3]);n[0]=t.FLOAT_MAX,t.FLOAT_MAX=n[0],e=Float32Array}t.arrayConstructor=e,TurbulenzEngine.hasOwnProperty("VMath")&&(TurbulenzEngine.VMath=t);var r=function(){function e(){this.version=1}return e.prototype.setSelectedRadio=function(e,t){var n=this.radioControls[e],r;n&&(r=n.controls[t],r&&(n.selected=t,this.updateRadio(r.id,!0)))},e.prototype.addRadioControl=function(e){var t=this.radioControls,n=e.groupName,r=e.radioIndex,i=e.id,s=e.fn,o=e.isDefault;if(n===undefined||n===null||r<0||i===undefined||i===null||s===undefined||s===null)return;var u=t[n];u||(t[n]={},u=t[n],u.controls=[],u.selected=0),u.controls[r]=e,o&&(u.selected=r),this.updateRadio(i,o)},e.prototype.addCheckboxControl=function(e){var t=this.checkboxControls,n=e.id,r=e.value;t[r]=e,this.updateCheckbox(n,e.isSelected)},e.prototype.addButtonControl=function(e){var t=this.buttonControls,n=e.id;t[n]=e},e.prototype.addSliderControl=function(e){var t=this.sliderControls;t[e.id]=e},e.prototype.getSliderValue=function(e){var t=window.$("#"+e).value;return t?parseInt(t,10):undefined},e.prototype.getHandler=function(){var e=this.radioControls,t=this.checkboxControls,n=this.buttonControls;return function(r){var i;r||(r=window.event),r.target?i=r.target:r.srcElement&&(i=r.srcElement),i.nodeType===3&&(i=i.parentNode);var s=i.id,o;switch(i.type){case"radio":for(var u in e)if(e.hasOwnProperty(u)){var a=0,f=e[u].controls,l=f.length;while(a<l){o=f[a];if(o.id===s){o.fn();return}a+=1}}break;case"checkbox":for(var c in t)if(t.hasOwnProperty(c)){o=t[c];if(o.id===s){var h=o.fn();h!==undefined&&(document.getElementById(o.id).checked=!!h);return}}break;case"button":for(var p in n)if(n.hasOwnProperty(p)){o=n[p];if(p===s){o.fn();return}}break;default:}}},e.prototype.register=function(){function d(e){return function(t,n){var r=window.$("#"+e+"input");r.val(n.value),r.change()}}function v(e,t){return function(){var n=parseFloat(this.value);if(!window.$)return;var r=window.$("#"+t),i=window.$("#"+t+"input");if(!r||!i)return;var s=r.slider("value");if(n===undefined||isNaN(n)||s===undefined||isNaN(s)||s===n)return;var o=r.slider("option","min"),u=r.slider("option","max");n<o?n=o:n>u&&(n=u),i.val(n),e.value=n,e.fn()}}var e=this.radioControls,t=this.checkboxControls,n=this.buttonControls,r=this.sliderControls,i,s,o;for(var u in e)if(e.hasOwnProperty(u)){var a=e[u].selected,f=e[u].controls,l=f.length;for(var c=0;c<l;c+=1)i=f[c],o=i.id,s=document.getElementById(o),s&&(s.value=i.value,s.name=i.groupName,s.onclick=this.getHandler(),s.checked=a===i.radioIndex?"checked":"")}for(var h in t)t.hasOwnProperty(h)&&(i=t[h],o=i.id,s=document.getElementById(o),s&&(s.value=i.value,s.onclick=this.getHandler(),s.checked=i.isSelected?"checked":""));for(var p in n)n.hasOwnProperty(p)&&(i=n[p],o=p,s=document.getElementById(o),s&&(s.value=i.value,s.onclick=this.getHandler()));for(var m in r)if(r.hasOwnProperty(m)){i=r[m],o=i.id;if(!window.$)return;var g=window.$("#"+o),y=window.$("#"+o+"input");if(!g||!y)return;g.slider({value:i.value,min:i.min,max:i.max,step:i.step,slide:d(o)}),y.val(g.slider("value")),y.change(v(i,o))}this.registered=!0},e.prototype.updateRadio=function(e,t){if(!this.registered)return;var n=document.getElementById(e);n&&(n.checked=!!t)},e.prototype.updateCheckbox=function(e,t){if(!this.registered)return;var n=document.getElementById(e);n&&(n.checked=!!t)},e.prototype.updateSlider=function(e,t){if(!this.registered)return;if(window.$){var n=window.$("#"+e);n&&n.slider("option","value",t)}},e.create=function(){var t=new e;return t.radioControls={},t.checkboxControls={},t.buttonControls={},t.sliderControls={},t.registered=!1,t},e}(),i=function(){function e(){}return e.prototype.subscribe=function(e){var t=this.subscribers,n=t.length;for(var r=0;r<n;r+=1)if(t[r]===e)return;t.push(e)},e.prototype.unsubscribe=function(e){var t=this.subscribers,n=t.length;for(var r=0;r<n;r+=1)if(t[r]===e){t.splice(r,1);break}},e.prototype.unsubscribeAll=function(){this.subscribers.length=0},e.prototype.notify=function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.subscribers,p=this.subscribers.length,d=0;while(d<p)h[d].apply(null,arguments),h.length===p?d+=1:p=h.length},e.create=function(){var t=new e;return t.subscribers=[],t},e}(),s=function(){function e(){this.reasonConnectionLost=0,this.reasonServiceBusy=1}return e.prototype.retryExponential=function(e,t,n){if(!this.notifiedConnectionLost&&TurbulenzEngine.time-this.connectionLostTime>this.notifyTime*.001){this.notifiedConnectionLost=!0;var r;n===0?r=this.reasonConnectionLost:r=this.reasonServiceBusy,e.reason=r,this.onRequestTimeout(r,e)}if(this.connected)this.connectionLostTime=TurbulenzEngine.time,this.notifiedConnectionLost=!1,this.connected=!1,this.reconnectTest=e,e.status=n;else if(this.reconnectTest!==e){var i=this.reconnectedObserver,s=function(){i.unsubscribe(s),t()};i.subscribe(s);return}e.expTime?(e.expTime=2*e.expTime,e.expTime>this.maxRetryTime&&(e.expTime=this.maxRetryTime)):e.expTime=this.initialRetryTime,e.retries?e.retries+=1:e.retries=1,TurbulenzEngine.setTimeout(t,e.expTime)},e.prototype.retryAfter=function(e,t,n,r){e.retries?e.retries+=1:(e.firstRetry=TurbulenzEngine.time,e.retries=1);if(!e.notifiedMaxRetries&&TurbulenzEngine.time-e.firstRetry+t>this.notifyTime){e.notifiedMaxRetries=!0;var i=this.reasonServiceBusy;e.reason=i,this.onRequestTimeout(i,e)}TurbulenzEngine.setTimeout(n,t*1e3)},e.prototype.request=function(e){var t,n=this,r=function(i,s){if(n.destroyed)return;var o=n.sendEventToHandlers,u=n.handlers;if(s===0||s===408||s===429||s===480||s===504){n.retryExponential(e,t,s);return}n.connected||(n.connected=!0,n.reconnectTest===e&&n.notifiedConnectionLost&&n.onReconnected(n.reconnectTest.reason,n.reconnectTest),n.reconnectTest=null,n.reconnectedObserver.notify());if(e.responseFilter&&!e.responseFilter.call(this,e,t,i,s))return;if(n.responseFilter&&!n.responseFilter(e,t,i,s))return;if(e.onload){var a;i&&i.name?a=i.name:a=e.src,o(u.eventOnload,{eventType:"eventOnload",name:a}),e.onload(i,s,e),e.onload=null}e=null};t=function(){if(n.destroyed)return;e.requestFn?e.requestOwner?e.requestFn.call(e.requestOwner,e.src,r,e):e.requestFn(e.src,r,e):e.requestOwner?e.requestOwner.request(e.src,r,e):TurbulenzEngine.request(e.src,r)},t()},e.prototype.addEventListener=function(e,t){var n,r,i;if(this.handlers.hasOwnProperty(e)){i=this.handlers[e];if(t){r=i.length;for(n=0;n<r;n+=1)if(i[n]===t)return;i.push(t)}}},e.prototype.removeEventListener=function(e,t){var n,r,i;if(this.handlers.hasOwnProperty(e)){i=this.handlers[e];if(t){r=i.length;for(n=0;n<r;n+=1)if(i[n]===t){i.splice(n,1);break}}}},e.prototype.sendEventToHandlers=function(e,t){var n,r=e.length;if(r)for(n=0;n<r;n+=1)e[n](t)},e.prototype.destroy=function(){this.destroyed=!0,this.handlers=null,this.onReconnected=null,this.onRequestTimeout=null},e.create=function(t){var n=new e;n.initialRetryTime=t.initialRetryTime||500,n.notifyTime=t.notifyTime||4e3,n.maxRetryTime=t.maxRetryTime||8e3,n.notifiedConnectionLost=!1,n.connected=!0,n.reconnectedObserver=i.create(),n.reconnectTest=null,n.onReconnected=t.onReconnected||function(){},n.onRequestTimeout=t.onRequestTimeout||function(){};var r={eventOnload:[]};return n.handlers=r,n},e}(),o={skipAsserts:!1,assert:function(t,n){t||this.skipAsserts||this.breakInDebugger.doesNotExist()},beget:function(t){var n=function(){};return n.prototype=t,new n},log:function(t,n){var r=window.console;if(r)switch(arguments.length){case 1:r.log(arguments[0]);break;case 2:r.log(arguments[0],arguments[1]);break;case 3:r.log(arguments[0],arguments[1],arguments[2]);break;case 4:r.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:var i=[].splice.call(arguments,0);r.log(i.join(" "))}},nearestLowerPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t-(t>>>1)},nearestUpperPow2:function(t){return t-=1,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1},ajax:function(t){var n="",r=t.method,i=t.data||{},s=t.encrypt,u=null,a=t.url,f=t.requestHandler,l=t.callback;if(s){i.requestUrl=a;var c=JSON.stringify(i);r==="POST"&&(c=TurbulenzEngine.encrypt(c)),n+="data="+encodeURIComponent(c)+"&",n+="gameSessionId="+encodeURIComponent(i.gameSessionId),u=TurbulenzEngine.generateSignature(c)}else if(i){var h;for(h in i)i.hasOwnProperty(h)&&(n.length!==0&&(n+="&"),r==="POST"?n+=h+"="+i[h]:n+=encodeURIComponent(h)+"="+encodeURIComponent(i[h]))}var p=function(t,n){var r=this.xhr;this.xhr.onreadystatechange=null,this.xhr=null;if(r.getResponseHeader("Content-Type")!=="application/json; charset=utf-8")TurbulenzEngine.setTimeout(function(){l({msg:"HttpStatus "+n+" "+o.ajaxStatusCodes[n]},n),l=null},0);else{var i=JSON.parse(t);if(s){var u=r.getResponseHeader("X-TZ-Signature"),f=TurbulenzEngine.verifySignature(t,u);t=null,TurbulenzEngine.setTimeout(function(){var e=i.requestUrl;if(f)if(!TurbulenzEngine.encryptionEnabled||e===a){l(i,n),l=null;return}n===400?l(i,n,"Verification Failed"):l({msg:"Verification failed",ok:!1},400,"Verification Failed"),l=null},0)}else t=null,TurbulenzEngine.setTimeout(function(){l(i,n),l=null},0)}},d=function(i,s,o){var a;if(window.XMLHttpRequest)a=new window.XMLHttpRequest;else{if(!window.ActiveXObject){t.error&&t.error("No XMLHTTPRequest object could be created");return}a=new window.ActiveXObject("Microsoft.XMLHTTP")}o.xhr=a;var f=function(){if(a.readyState===4&&TurbulenzEngine&&!TurbulenzEngine.isUnloading()){var t=a.responseText,n=a.status,r=n!==0&&a.statusText||"No connection or cross domain request";if(a.getAllResponseHeaders()===""&&t===""&&n===200&&r==="OK"){s("",0);return}s.call(o,t,n)}};a.open(r,n&&r!=="POST"?i+"?"+n:i,!0),l&&(a.onreadystatechange=f),u&&a.setRequestHeader("X-TZ-Signature",u),r==="POST"?(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(n)):a.send()};if(f)f.request({src:a,requestFn:d,responseFilter:t.responseFilter,onload:p});else{var v={src:a};d(a,p,v)}},ajaxStatusCodes:{0:"No Connection, Timeout Or Cross Domain Request",100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",429:"Too Many Requests",480:"Temporarily Unavailable",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported"}},u={v2ToArray:function(t){return[t[0],t[1]]},arrayToV2:function(t,n,r){return t.v2Build(n[0],n[1],r)},v3ToArray:function(t){return[t[0],t[1],t[2]]},arrayToV3:function(t,n,r){return t.v3Build(n[0],n[1],n[2],r)},v4ToArray:function(t){return[t[0],t[1],t[2],t[3]]},arrayToV4:function(t,n,r){return t.v4Build(n[0],n[1],n[2],n[3],r)},quatToArray:function(t){return[t[0],t[1],t[2],t[3]]},arrayToQuat:function(t,n,r){return t.quatBuild(n[0],n[1],n[2],n[3],r)},aabbToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]},arrayToAABB:function(t,n,r){return t.aabbBuild(n[0],n[1],n[2],n[3],n[4],n[5],r)},quatPosToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6]]},arrayToQuatPos:function(t,n,r){return t.quatPosBuild(n[0],n[1],n[2],n[3],n[4],n[5],n[6],r)},m33ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},arrayToM33:function(t,n,r){return t.m33Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],r)},m43ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11]]},arrayToM43:function(t,n,r){return t.m43Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],r)},m34ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11]]},m44ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},arrayToM44:function(t,n,r){return t.m44Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],r)}},a=function(){function e(){}return e.prototype.add=function(){this.referenceCount+=1},e.prototype.remove=function(){this.referenceCount-=1,this.referenceCount===0&&(this.destroyedObserver&&this.destroyedObserver.notify(this.object),this.object.destroy(),this.object=null)},e.prototype.subscribeDestroyed=function(e){this.destroyedObserver||(this.destroyedObserver=i.create()),this.destroyedObserver.subscribe(e)},e.prototype.unsubscribeDestroyed=function(e){this.destroyedObserver.unsubscribe(e)},e.create=function(t){var n=new e;return n.object=t,n.referenceCount=0,n},e.version=1,e}(),f={profiles:{},sortMode:{alphabetical:0,duration:1,max:2,min:3,calls:4},start:function(t){var n=this.profiles[t];n||(n={name:t,calls:0,duration:0,min:Number.MAX_VALUE,max:0,sumOfSquares:0},this.profiles[t]=n),n.start=TurbulenzEngine.time},stop:function(t){var n=TurbulenzEngine.time,r=this.profiles[t];if(r){var i=n-r.start;r.duration+=i,r.calls+=1,r.sumOfSquares+=i*i,i>r.max&&(r.max=i),i<r.min&&(r.min=i)}},reset:function(){this.profiles={}},getReport:function(t,n){var r=[],i,s=0,o;for(o in this.profiles)this.profiles.hasOwnProperty(o)&&(i=this.profiles[o],s<i.duration&&(s=i.duration),r.push(i));var u;t===f.sortMode.alphabetical?u=function(t,n){return t.name<n.name?-1:t.name>n.name?1:0}:t===f.sortMode.max?u=function(t,n){return n.max-t.max}:t===f.sortMode.min?u=function(t,n){return n.min-t.min}:t===f.sortMode.calls?u=function(t,n){return n.calls-t.calls}:u=function(t,n){return n.duration-t.duration},r.sort(u);var a,l="",c=n?n.precision:8,h=n?n.percentagePrecision:1,p=n?n.seperator:" ",d=r.length,v,m,g;for(g=0;g<d;g+=1)i=r[g],a=i.name,a+=p+i.calls,a+=p+i.duration.toFixed(c),a+=p+i.max.toFixed(c),a+=p+i.min.toFixed(c),m=i.duration/i.calls,a+=p+m.toFixed(c),v=Math.sqrt(i.sumOfSquares/i.calls-m*m),a+=p+v.toFixed(c),a+=p+(100*i.duration/s).toFixed(h)+"%\n",l+=a;return l}},l={};l.createArray=function(t){var n={},r=[];t.head&&(t=t.head);var i=function(t){var s=n[t.url];s||(s={},n[t.url]=s);var o=t.functionName===""?"(anonymous)":t.functionName,u=s[o];u||(u={},s[o]=u);var a=u[t.lineNumber];if(!a){var f={functionName:o,numberOfCalls:t.numberOfCalls,totalTime:t.totalTime,selfTime:t.selfTime,url:t.url,lineNumber:t.lineNumber};r[r.length]=f,u[t.lineNumber]=f}else a.totalTime+=t.totalTime,a.selfTime+=t.selfTime,a.numberOfCalls+=t.numberOfCalls;var l=typeof t.children=="function"?t.children():t.children;if(l){var c=l.length,h;for(h=0;h<c;h+=1)i(l[h])}};return i(t),r},l.sort=function(t,n,r){n||(n="totalTime");var i=function(e,t){return e[n]-t[n]},s=function(e,t){return t[n]-e[n]};r===!1?t.sort(i):t.sort(s)};var c=function(){function e(){}return e.create=function(){return new e},e}(),h=function(){function e(){}return e.prototype.push=function(e,t){var n=c.create();n.key=e,n.value=t,n.timeOffset=TurbulenzEngine.time,this.events.push(n)},e.prototype.length=function(){return this.events.length},e.prototype.clear=function(){this.events.length=0},e.create=function(){var t=new e;return t.events=[],t},e}(),p=function(){function e(){}return e.prototype.request=function(e){var t=function(){e.callback&&e.callback({ok:!1,msg:"Service Unavailable. Discarding request"},503)},n=this,r=this.serviceStatusObserver,i;i=function(o,u){u?e.neverDiscard||(r.unsubscribe(i),t()):o&&(r.unsubscribe(i),n.request(e))};if(!this.running)return this.discardRequests&&!e.neverDiscard?(TurbulenzEngine.setTimeout(t,0),!1):(e.waiting||(e.waiting=!0,r.subscribe(i)),!0);var s=e.responseFilter;return e.responseFilter=function(u,a,f,l){if(l===503){var c=JSON.parse(f),h=c.data,p=h?h.discardRequests:!0;return n.discardRequests=p,p&&!e.neverDiscard?t():r.subscribe(i),d.serviceUnavailable(n,u),!1}return s?s.call(e.requestHandler,u,a,f,l):!0},o.ajax(e),!0},e.create=function(t,n){var r=new e;return n||(n={}),r.running=!0,r.discardRequests=!1,r.serviceStatusObserver=i.create(),r.serviceName=t,r.onServiceUnavailable=n.onServiceUnavailable,r.onServiceAvailable=n.onServiceAvailable,r},e}(),d=function(){function e(){}return e.available=function(){return window.gameSlug!==undefined},e.addBridgeEvents=function(){var e=window.top.Turbulenz,t=e&&e.Data||{},n=t.joinMultiplayerSessionId,r=this,i=function(t){r.multiplayerJoinRequestQueue.push(t)},s=function(t){var n=JSON.parse(t);n.mode&&(r.mode=n.mode),n.joinMultiplayerSessionId&&r.multiplayerJoinRequestQueue.push(n.joinMultiplayerSessionId),r.bridgeServices=!!n.bridgeServices};n&&this.multiplayerJoinRequestQueue.push(n),v.setOnMultiplayerSessionToJoin(i),v.setOnReceiveConfig(s),v.triggerRequestConfig(),this.responseHandlers=[null],this.responseIndex=0,v.on("bridgeservices.response",function(e){r.routeResponse(e)})},e.callOnBridge=function(e,t,n){var r={data:t,key:undefined};n&&(this.responseIndex+=1,this.responseHandlers[this.responseIndex]=n,r.key=this.responseIndex),v.emit("bridgeservices."+e,JSON.stringify(r))},e.addSignature=function(e,t){var n;return e.requestUrl=t,n=TurbulenzEngine.encrypt(JSON.stringify(e)),e.str=n,e.signature=TurbulenzEngine.generateSignature(n),e},e.routeResponse=function(e){var t=JSON.parse(e),n=t.key||0,r=this.responseHandlers[n];r&&(this.responseHandlers[n]=null,r(t.data))},e.onServiceUnavailable=function(e,t){},e.onServiceAvailable=function(e,t){},e.createGameSession=function(e,t,n){return m.create(e,t,n)},e.createMappingTable=function(t,n,r,i,s){var o,u=n&&n.mappingTable,a,f,l;u?(a=u.mappingTableURL,f=u.mappingTablePrefix,l=u.assetPrefix):i?(a=i.mappingTableURL||(i.mappingTableURL===""?"":"mapping_table.json"),f=i.mappingTablePrefix||(i.mappingTablePrefix===""?"":"staticmax/"),l=i.assetPrefix||(i.assetPrefix===""?"":"missing/")):(a="mapping_table.json",f="staticmax/",l="missing/");var c=function(n){var r=i&&(i.urnMapping||{}),u=s||e.defaultErrorCallback;o.setMapping(r),u(n)},h={mappingTableURL:a,mappingTablePrefix:f,assetPrefix:l,requestHandler:t,onload:r,errorCallback:c};return o=g.create(h),o},e.createLeaderboardManager=function(e,t,n,r){return LeaderboardManager.create(e,t,n,r)},e.createBadgeManager=function(e,t){return BadgeManager.create(e,t)},e.createStoreManager=function(e,t,n,r){return StoreManager.create(e,t,n,r)},e.createNotificationsManager=function(e,t,n,r){return NotificationsManager.create(e,t,n,r)},e.createMultiplayerSessionManager=function(e,t){return MultiPlayerSessionManager.create(e,t)},e.createUserProfile=function(t,n,r){var i={};r||(r=e.defaultErrorCallback);var s=function(t){if(t&&t.ok){t=t.data;var n;for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}},o="/api/v1/profiles/user";return e.available()&&this.getService("profiles").request({url:o,method:"GET",callback:function(t,o){o===200?s(t):r&&r("TurbulenzServices.createUserProfile error with HTTP status "+o+": "+t.msg,o),n&&n(i)},requestHandler:t}),i},e.upgradeAnonymousUser=function(e){if(e){var t=function(n){e()};v.on("user.upgrade.occurred",t)}v.emit("user.upgrade.show")},e.sendCustomMetricEvent=function(t,n,r,i,s){s||(s=e.defaultErrorCallback);if(!e.available()){s("TurbulenzServices.sendCustomMetricEvent failed: Service not available",0);return}if("string"!=typeof t||0===t.length){s("TurbulenzServices.sendCustomMetricEvent failed: Event key must be a non-empty string",0);return}if("number"!=typeof n||isNaN(n)||!isFinite(n)){if("[object Array]"!==Object.prototype.toString.call(n)){s("TurbulenzServices.sendCustomMetricEvent failed: Event value must be a number or an array of numbers",0);return}var o,u=n.length;for(o=0;o<u;o+=1)if("number"!=typeof n[o]||isNaN(n[o])||!isFinite(n[o])){s("TurbulenzServices.sendCustomMetricEvent failed: Event value array elements must be numbers",0);return}}this.getService("customMetrics").request({url:"/api/v1/custommetrics/add-event/"+i.gameSlug,method:"POST",data:{key:t,value:n,gameSessionId:i.gameSessionId},callback:function(t,n){n!==200&&s("TurbulenzServices.sendCustomMetricEvent error with HTTP status "+n+": "+t.msg,n)},requestHandler:r,encrypt:!0})},e.sendCustomMetricEventBatch=function(t,n,r,i){i||(i=e.defaultErrorCallback);if(!e.available()){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Service not available",0);return}var s=TurbulenzEngine.time,o=t.events,u,a=o.length;for(u=0;u<a;u+=1){var f=o[u].key,l=o[u].value,c=o[u].timeOffset;if("string"!=typeof f||0===f.length){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event key must be a non-empty string",0);return}if("number"!=typeof l||isNaN(l)||!isFinite(l)){if("[object Array]"!==Object.prototype.toString.call(l)){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event value must be a number or an array of numbers",0);return}var h,p=l.length;for(h=0;h<p;h+=1)if("number"!=typeof l[h]||isNaN(l[h])||!isFinite(l[h])){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event value array elements must be numbers",0);return}}if("number"!=typeof c||isNaN(c)||!isFinite(c)){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event time offset is corrupted",0);return}o[u].timeOffset=c-s}this.getService("customMetrics").request({url:"/api/v1/custommetrics/add-event-batch/"+r.gameSlug,method:"POST",data:{batch:o,gameSessionId:r.gameSessionId},callback:function(t,n){n!==200&&i&&i("TurbulenzServices.sendCustomMetricEventBatch error with HTTP status "+n+": "+t.msg,n)},requestHandler:n,encrypt:!0})},e.getService=function(e){var t=this.services;if(t.hasOwnProperty(e))return t[e];var n=p.create(e);return t[e]=n,n},e.serviceUnavailable=function(t,n){var r=this.waitingServices,i=t.serviceName;if(r.hasOwnProperty(i))return;r[i]=t,t.running=!1;var s=function(r){var i=n.onServiceUnavailable;i&&i.call(r,n),r.onServiceUnavailable&&r.onServiceUnavailable(),e.onServiceUnavailable&&e.onServiceUnavailable(r)};t.discardRequests&&s(t);if(this.pollingServiceStatus)return;var u=this,a,f="/api/v1/service-status/game/read/"+window.gameSlug,l=function(i,o){if(o===200){var f=i.data,l=f.services,c=!1,h;for(h in r)if(r.hasOwnProperty(h)){var p=r[h],d=l[h],v=d.running;p.running=v,p.description=d.description
;if(v){if(p.discardRequests){var m=n.onServiceAvailable;m&&m.call(p,n),p.onServiceAvailable&&p.onServiceAvailable(),e.onServiceAvailable&&e.onServiceAvailable(p)}delete r[h],p.discardRequests=!1,p.serviceStatusObserver.notify(v,p.discardRequests)}else d.discardRequests&&!p.discardRequests&&(p.discardRequests=!0,s(p),p.serviceStatusObserver.notify(v,p.discardRequests)),c=!0}if(!c){this.pollingServiceStatus=!1;return}TurbulenzEngine.setTimeout(a,f.pollInterval*1e3)}else TurbulenzEngine.setTimeout(a,u.defaultPollInterval)};a=function(){o.ajax({url:f,method:"GET",callback:l})},a()},e.multiplayerJoinRequestQueue={argsQueue:[],handler:function(){},context:undefined,paused:!0,onEvent:function(t,n){this.handler=t,this.context=n},push:function(t){var n=[t];this.paused?this.argsQueue.push(n):this.handler.apply(this.context,n)},shift:function(){var t=this.argsQueue.shift();return t?t[0]:undefined},clear:function(){this.argsQueue=[]},pause:function(){this.paused=!0},resume:function(){this.paused=!1;while(this.argsQueue.length){this.handler.apply(this.context,this.argsQueue.shift());if(this.paused)break}}},e.defaultErrorCallback=function(e,t){},e.services={},e.waitingServices={},e.pollingServiceStatus=!1,e.defaultPollInterval=4e3,e}();typeof v!="undefined"&&d.addBridgeEvents();var v=function(){function e(){}return e._initInstance=function(){var e=window.top.Turbulenz;if(e&&e.Services){var t=e.Services.bridge;if(!t)return;this._bridge=t,this.emit=t.emit,this.on=t.gameListenerOn||t.addListener||t.setListener,this.addListener=t.gameListenerOn||t.addListener||t.setListener,this.setListener=t.gameListenerOn||t.setListener}typeof d!="undefined"&&d.addBridgeEvents()},e.isInitialised=function(){return this._bridge!==undefined},e.emit=function(e,t,n){},e.on=function(e,t){},e.addListener=function(){},e.setListener=function(e,t){},e.setOnReceiveConfig=function(e){this.on("config.set",e)},e.triggerRequestConfig=function(){this.emit("config.request")},e.startLoading=function(){this.emit("status.loading.start")},e.startSaving=function(){this.emit("status.saving.start")},e.stopLoading=function(){this.emit("status.loading.stop")},e.stopSaving=function(){this.emit("status.saving.stop")},e.createdGameSession=function(e){this.emit("game.session.created",e)},e.destroyedGameSession=function(e){this.emit("game.session.destroyed",e)},e.setGameSessionStatus=function(e,t){this.emit("game.session.status",e,t)},e.setGameSessionInfo=function(e){this.emit("game.session.info",e)},e.updateUserBadge=function(e){this.emit("userbadge.update",e)},e.updateLeaderBoard=function(e){this.emit("leaderboards.update",e)},e.setOnMultiplayerSessionToJoin=function(e){this.on("multiplayer.session.join",e)},e.triggerJoinedMultiplayerSession=function(e){this.emit("multiplayer.session.joined",e)},e.triggerLeaveMultiplayerSession=function(e){this.emit("multiplayer.session.leave",e)},e.triggerMultiplayerSessionMakePublic=function(e){this.emit("multiplayer.session.makepublic",e)},e.setOnBasketUpdate=function(e){this.on("basket.site.update",e)},e.triggerBasketUpdate=function(e){this.emit("basket.game.update.v2",e)},e.triggerUserStoreUpdate=function(e){this.emit("store.user.update",e)},e.setOnPurchaseConfirmed=function(e){this.on("purchase.confirmed",e)},e.setOnPurchaseRejected=function(e){this.on("purchase.rejected",e)},e.triggerShowConfirmPurchase=function(){this.emit("purchase.show.confirm")},e.triggerFetchStoreMeta=function(){this.emit("fetch.store.meta")},e.setOnStoreMeta=function(e){this.on("store.meta.v2",e)},e.triggerSendInstantNotification=function(e){this.emit("notifications.ingame.sendInstant",e)},e.triggerSendDelayedNotification=function(e){this.emit("notifications.ingame.sendDelayed",e)},e.setOnNotificationSent=function(e){this.on("notifications.ingame.sent",e)},e.triggerCancelNotificationByID=function(e){this.emit("notifications.ingame.cancelByID",e)},e.triggerCancelNotificationsByKey=function(e){this.emit("notifications.ingame.cancelByKey",e)},e.triggerCancelAllNotifications=function(e){this.emit("notifications.ingame.cancelAll",e)},e.triggerInitNotificationManager=function(e){this.emit("notifications.ingame.initNotificationManager",e)},e.setOnReceiveNotification=function(e){this.on("notifications.ingame.receive",e)},e.changeAspectRatio=function(e){this.emit("change.viewport.ratio",e)},e.setOnViewportHide=function(e){this.on("change.viewport.hide",e)},e.setOnViewportShow=function(e){this.on("change.viewport.show",e)},e.setOnFullscreenOn=function(e){this.on("change.viewport.fullscreen.on",e)},e.setOnFullscreenOff=function(e){this.on("change.viewport.fullscreen.off",e)},e.setOnMenuStateChange=function(e){this.on("change.menu.state",e)},e.setOnUserStateChange=function(e){this.on("change.user.state",e)},e.triggerOnFullscreen=function(){this.emit("trigger.viewport.fullscreen")},e.triggerOnViewportVisibility=function(){this.emit("trigger.viewport.visibility")},e.triggerOnMenuStateChange=function(){this.emit("trigger.menu.state")},e.triggerOnUserStateChange=function(){this.emit("trigger.user.state")},e.queryFullscreen=function(e){this.emit("query.viewport.fullscreen",e)},e.queryViewportVisibility=function(e){this.emit("query.viewport.visibility",e)},e.queryMenuState=function(e){this.emit("query.menu.state",e)},e.queryUserState=function(e){this.emit("query.user.state",e)},e._bridge=undefined,e}();v.isInitialised()||v._initInstance();var m=function(){function e(){this.post_delay=1e3}return e.prototype.setStatus=function(e){if(this.destroyed||this.status===e)return;this.status=e,v.setGameSessionStatus(this.gameSessionId,e)},e.prototype.destroy=function(e){var t;this.pendingUpdate&&(TurbulenzEngine.clearTimeout(this.pendingUpdate),this.pendingUpdate=null),!this.destroyed&&this.gameSessionId?(v.destroyedGameSession(this.gameSessionId),this.destroyed=!0,t={gameSessionId:this.gameSessionId},d.bridgeServices?d.callOnBridge("gamesession.destroy",t,e):o.ajax({url:"/api/v1/games/destroy-session",method:"POST",data:t,callback:e,requestHandler:this.requestHandler})):e&&TurbulenzEngine.setTimeout(e,0)},e.prototype.setTeamInfo=function(e){var t=this.info.sessionData,n=t.teamList||[];e.join("#")!==n.join("#")&&(t.teamList=e,this.update())},e.prototype.setPlayerInfo=function(e,t){var n=this.info.playerSessionData[e],r,i=!1;n||(n={},this.info.playerSessionData[e]=n,i=!0);for(r in t)if(t.hasOwnProperty(r)){if(!this.templatePlayerData.hasOwnProperty(r))throw"unknown session data property "+r;n[r]!==t[r]&&(n[r]=t[r],i=!0)}i&&this.update()},e.prototype.removePlayerInfo=function(e){delete this.info.playerSessionData[e],this.update()},e.prototype.clearAllPlayerInfo=function(){this.info.playerSessionData={},this.update()},e.prototype.update=function(){this.pendingUpdate||(this.pendingUpdate=TurbulenzEngine.setTimeout(this.postData,this.post_delay))},e.create=function(t,n,r){var i=new e,s=window.gameSlug,o=window.top.Turbulenz,u=o&&o.Data||{},a=u.mode||d.mode,f="/api/v1/games/create-session/"+s;i.info={sessionData:{},playerSessionData:{}},i.templatePlayerData={team:null,color:null,status:null,rank:null,score:null,sortkey:null},i.postData=function(){v.setGameSessionInfo(JSON.stringify(i.info)),i.pendingUpdate=null},i.pendingUpdate=null,i.gameSlug=s,i.requestHandler=t,i.errorCallbackFn=r||d.defaultErrorCallback,i.gameSessionId=null,i.service=d.getService("gameSessions"),i.status=null;if(!d.available())return n&&TurbulenzEngine.setTimeout(function(){n(i)},0),i;var l=function(t,r){r===200?(i.mappingTable=t.mappingTable,i.gameSessionId=t.gameSessionId,n&&n(i),v.createdGameSession(i.gameSessionId)):404===r?(window.gameSlug=undefined,i.gameSlug=undefined,n&&n(i)):i.errorCallbackFn("TurbulenzServices.createGameSession error with HTTP status "+r+": "+t.msg,r)};return a&&(f+="/"+a),i.service.request({url:f,method:"POST",callback:l,requestHandler:t,neverDiscard:!0}),i},e.version=1,e}(),g=function(){function e(){}return e.prototype.getURL=function(e,t){var n=this.overrides,r=this.currentProfile,i=n[r],s;while(i){s=i.urnmapping[e];if(s)return s;i=n[i.parent]}return s=this.urlMapping[e],s?s:(t&&t(e),this.assetPrefix+e)},e.prototype.setMapping=function(e){this.urlMapping=e},e.prototype.map=function(e,t){this.urlMapping[e]=t},e.prototype.alias=function(e,t){var n=this.urlMapping;n[e]=n[t]},e.prototype.getCurrentProfile=function(){return this.currentProfile},e.prototype.setProfile=function(e){this.overrides.hasOwnProperty(e)?this.currentProfile=e:this.currentProfile=undefined},e.create=function(t){var n=new e;n.mappingTableURL=t.mappingTableURL,n.tablePrefix=t.mappingTablePrefix,n.assetPrefix=t.assetPrefix,n.overrides={},n.errorCallbackFn=t.errorCallback||d.defaultErrorCallback,n.currentProfile=TurbulenzEngine.getSystemInfo().platformProfile;var r=function(r){var i=r.urnmapping||r.urnremapping||{},s=r.overrides||{};n.urlMapping=i,n.overrides=s;var o=n.tablePrefix;if(o){var u=function(t){var n;for(n in t)t.hasOwnProperty(n)&&(t[n]=o+t[n])};u(i);var a;for(a in s)s.hasOwnProperty(a)&&u(s[a].urnmapping)}t.onload(n)};return n.mappingTableURL?t.requestHandler.request({src:n.mappingTableURL,onload:function(t,i){if(i===200){var s=JSON.parse(t);r(s)}else n.urlMapping={},t=t||{msg:"(no response)"},n.errorCallbackFn("MappingTable.create: HTTP status "+i+": "+t.msg,i)}}):t.mappingTableData?TurbulenzEngine.setTimeout(function(){r(JSON.parse(t.mappingTableData))},0):TurbulenzEngine.setTimeout(function(){n.errorCallbackFn("!! mappingtable params contain no url or data")},0),n},e.version=1,e}(),y={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},b=function(t,n){var r=parseInt,i;t=t.replace(/ /g,"").toLowerCase(),t=y[t]||t;if(t[0]==="#"){t=t.substr(1,6);var s=t.length;if(s===6){i=/^(\w{2})(\w{2})(\w{2})$/.exec(t);if(i)return n[0]=r(i[1],16)/255,n[1]=r(i[2],16)/255,n[2]=r(i[3],16)/255,n[3]=1,n}else if(s===3){i=/^(\w{1})(\w{1})(\w{1})$/.exec(t);if(i)return n[0]=r(i[1],16)/15,n[1]=r(i[2],16)/15,n[2]=r(i[3],16)/15,n[3]=1,n}}else{var o=t.substr(0,4);if(o==="rgba"){i=/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d*\.?\d+)\)$/.exec(t);if(i)return n[0]=r(i[1],10)/255,n[1]=r(i[2],10)/255,n[2]=r(i[3],10)/255,n[3]=parseFloat(i[4]),n}else if(o==="rgb("){i=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(t);if(i)return n[0]=r(i[1],10)/255,n[1]=r(i[2],10)/255,n[2]=r(i[3],10)/255,n[3]=1,n}else{o==="hsla"?(i=/^hsla\((\d{1,3}),\s*(\d{1,3})\%,\s*(\d{1,3})\%,\s*(\d*\.?\d+)\)$/.exec(t),i&&(n[3]=parseFloat(i[4]))):o==="hsl("&&(i=/^hsl\((\d{1,3}),\s*(\d{1,3})\%,\s*(\d{1,3})\%\)$/.exec(t),i&&(n[3]=1));if(i){var u=r(i[1],10)/360,a=r(i[2],10)/100,f=r(i[3],10)/100;if(a===0)n[0]=f,n[1]=f,n[2]=f;else{var l,c;f<.5?c=f*(a+1):c=f+a-f*a,l=f*2-c;var h=function(t,n,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(n-t)*r*6:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t};n[0]=h(l,c,u+1/3),n[1]=h(l,c,u),n[2]=h(l,c,u-1/3)}return n}}}return undefined},w=function(){function e(){}return e.prototype.addColorStop=function(e,t){function n(e,t){return e[0]-t[0]}if(e<0||e>1)throw"INDEX_SIZE_ERR";var r=this.stops,i=r.length,s=b(t,new Array(4));s[3]<1&&(this.opaque=!1),s[0]=s[0]*255,s[1]=s[1]*255,s[2]=s[2]*255,s[3]=s[3]*255,r[i]=[e,s],i+=1,i>1&&r.sort(n)},e.prototype.updateTexture=function(e){var t=this.texture,n=this.stops,r=n.length;if(this.numTextureStops!==r){this.numTextureStops=r;var i=this.width,s=this.height;t||(this.texture=t=e.createTexture({name:"linear:"+i+"x"+s,width:i,height:s,depth:1,format:e.PIXELFORMAT_R8G8B8A8,cubemap:!1,mipmaps:!1}));var o=this.opaque,u=this.x1-this.x0,a=this.y1-this.y0,f=u*u+a*a;f===0?f=1:f=1/Math.sqrt(f),u*=f,a*=f;var l=u/(i>1?i-1:1),c=a/(s>1?s-1:1),h=i*s*4,p=new Array(h),d=0,v=0;for(var m=0;m<s;m+=1,v+=c){var g=v*a,y=0;for(var b=0;b<i;b+=1,d+=4,y+=l){var w=y*u+g,E=n[0],S=E[0],x=E[1],T=S,N=x;if(w>S)for(var C=1;C<r;C+=1){E=n[C],S=E[0],x=E[1];if(w<=S)break;T=S,N=x}var k=S-T;if(k<=0||w===S)p[d]=x[0],p[d+1]=x[1],p[d+2]=x[2],o?p[d+3]=255:p[d+3]=x[3];else{var L=(w-T)/k;if(L<.996){var A=1-L;p[d]=x[0]*L+N[0]*A,p[d+1]=x[1]*L+N[1]*A,p[d+2]=x[2]*L+N[2]*A,o?p[d+3]=255:p[d+3]=x[3]*L+N[3]*A}else p[d]=x[0],p[d+1]=x[1],p[d+2]=x[2],o?p[d+3]=255:p[d+3]=x[3]}}}t.setData(p)}return t},e.create=function(t,n,r,i){var s=r-t,o=i-n,u=Math.abs(s),a=Math.abs(o);if(u===0&&a===0)return null;while(u<16&&a<16)u*=16,a*=16;u<1?u=1:u=Math.floor(u),a<1?a=1:a=Math.floor(a);var f=new e;f.x0=t,f.y0=n,f.x1=r,f.y1=i,f.width=u,f.height=a,f.stops=[];var l=1/s,c=1/o;return f.matrix=[l,0,-t*l,0,c,-n*c],f.numTextureStops=0,f.texture=null,f.opaque=!0,f},e.version=1,e}(),E=function(){function e(){}return e.prototype.addColorStop=function(e,t){function n(e,t){return e[0]-t[0]}if(e<0||e>1)throw"INDEX_SIZE_ERR";var r=this.stops,i=r.length,s=b(t,new Array(4));s[3]<1&&(this.opaque=!1),s[0]=s[0]*255,s[1]=s[1]*255,s[2]=s[2]*255,s[3]=s[3]*255,r[i]=[e,s],i+=1,i>1&&r.sort(n)},e.prototype.updateTexture=function(e){var t=this.texture,n=this.stops,r=n.length;if(this.numTextureStops!==r){this.numTextureStops=r;var i=this.width;i<r&&(this.width=i=r);var s=this.height;s<r&&(this.height=s=r);if(!t||t.width!==i||t.height!==s)this.texture=t=e.createTexture({name:"radial:"+i+"x"+s,width:i,height:s,depth:1,format:e.PIXELFORMAT_R8G8B8A8,cubemap:!1,mipmaps:!1});var o=this.x0-this.minX,u=this.x1-this.minX,a=u-o,f=this.y0-this.minY,l=this.y1-this.minY,c=l-f,h=this.r0,p=this.r1,d=p-h,v=i*s*4,m=new Array(v),g=Math.cos,y=Math.sin,b=Math.abs,w=Math.PI*2,E=Math.max(b(a|0),b(c|0),b(d|0)),S=1/E,x,T,N,C;for(var k=0;k<=1;k+=S){var L=n[0],A=L[0],O=L[1],M=A,_=O;if(k>A)for(var D=1;D<r;D+=1){L=n[D],A=L[0],O=L[1];if(k<=A)break;M=A,_=O}var P=A-M;if(P<=0||k===A)x=O[0],T=O[1],N=O[2],C=O[3];else{var H=(k-M)/P,B=1-H;x=O[0]*H+_[0]*B,T=O[1]*H+_[1]*B,N=O[2]*H+_[2]*B,C=O[3]*H+_[3]*B}var j=o+k*a,F=f+k*c,I=h+k*d,q,R,U,z,W;for(var X=1;X<I;X+=1){R=1/X;for(q=0;q<w;q+=R)U=j+X*g(q)|0,z=F+X*y(q)|0,W=U+z*i<<2,m[W+3]===undefined&&(m[W]=x,m[W+1]=T,m[W+2]=N,m[W+3]=C)}R=1/I;for(q=0;q<w;q+=R)U=j+I*g(q)|0,z=F+I*y(q)|0,W=U+z*i<<2,m[W+3]===undefined&&(m[W]=x,m[W+1]=T,m[W+2]=N,m[W+3]=C)}var V=n[r-1][1],$=V[0],J=V[1],K=V[2],Q=V[3];for(var G=0;G<v;G+=4)m[G+3]===undefined&&(m[G]=$,m[G+1]=J,m[G+2]=K,m[G+3]=Q);t.setData(m)}return t},e.create=function(t,n,r,i,s,o){if(r<0||o<0)throw"INDEX_SIZE_ERR";var u=new e;u.x0=t,u.y0=n,u.r0=r,u.x1=i,u.y1=s,u.r1=o;var a=Math.min(t-r,i-o)-1,f=Math.max(t+r,i+o)+1,l=Math.min(n-r,s-o)-1,c=Math.max(n+r,s+o)+1;u.minX=a,u.minY=l,u.stops=[];var h=Math.ceil(f-a),p=Math.ceil(c-l);if(!h||!p)return null;u.width=h,u.height=p;var d=1/h,v=1/p;return u.matrix=[d,0,-a*d,0,v,-l*v],u.numTextureStops=0,u.texture=null,u.opaque=!0,u},e.version=1,e}(),S=function(){function e(e,t,n,r){this.compositeOperations={"source-atop":1,"source-in":1,"source-out":1,"source-over":1,"destination-atop":1,"destination-in":1,"destination-out":1,"destination-over":1,lighter:1,copy:1,xor:1},this.capStyles={butt:1,round:1,square:1},this.joinStyles={bevel:1,round:1,miter:1},this.shaderDefinition={version:1,name:"canvas.cgfx",samplers:{texture:{MinFilter:9985,MagFilter:9729,WrapS:33071,WrapT:33071},pattern:{MinFilter:9728,MagFilter:9729,WrapS:10497,WrapT:10497},gradient:{MinFilter:9728,MagFilter:9729,WrapS:33071,WrapT:33071},image:{MinFilter:9728,MagFilter:9729,WrapS:33071,WrapT:33071}},parameters:{screen:{type:"float",columns:4},uvtransform:{type:"float",rows:2,columns:3},color:{type:"float",columns:4},alpha:{type:"float"},texture:{type:"sampler2D"},pattern:{type:"sampler2D"},gradient:{type:"sampler2D"},image:{type:"sampler2D"}},techniques:{flat_source_atop:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,771]},programs:["vp_flat","fp_flat"]}],flat_source_in:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,0]},programs:["vp_flat","fp_flat"]}],flat_source_out:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,0]},programs:["vp_flat","fp_flat"]}],flat_source_over:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_flat","fp_flat"]}],flat_destination_atop:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,770]},programs:["vp_flat","fp_flat"]}],flat_destination_in:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,770]},programs:["vp_flat","fp_flat"]}],flat_destination_out:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,771]},programs:["vp_flat","fp_flat"]}],flat_destination_over:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,1]},programs:["vp_flat","fp_flat"]}],flat_lighter:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,1]},programs:["vp_flat","fp_flat"]}],flat_copy:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_flat","fp_flat"]}],flat_xor:[{parameters:["screen","color"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,771]},programs:["vp_flat","fp_flat"]}],texture_source_atop:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,771]},programs:["vp_texture","fp_texture"]}],texture_source_in:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,0]},programs:["vp_texture","fp_texture"]}],texture_source_out:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,0]},programs:["vp_texture","fp_texture"]}],texture_source_over:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture","fp_texture"]}],texture_destination_atop:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,770]},programs:["vp_texture","fp_texture"]}],texture_destination_in:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,770]},programs:["vp_texture","fp_texture"]}],texture_destination_out:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,771]},programs:["vp_texture","fp_texture"]}],texture_destination_over:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,1]},programs:["vp_texture","fp_texture"]}],texture_lighter:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,1]},programs:["vp_texture","fp_texture"]}],texture_copy:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_texture","fp_texture"]}],texture_xor:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,771]},programs:["vp_texture","fp_texture"]}],pattern_source_atop:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,771]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_source_in:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,0]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_source_out:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,0]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_source_over:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_destination_atop:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,770]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_destination_in:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,770]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_destination_out:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,771]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_destination_over:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,1]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_lighter:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,1]},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_copy:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_texture_uvtransform","fp_pattern"]}],pattern_xor:[{parameters:["screen","uvtransform","alpha","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,771]},programs:["vp_texture_uvtransform","fp_pattern"]}],gradient_source_atop:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,771]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_source_in:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[772,0]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_source_out:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,0]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_source_over:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_destination_atop:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,770]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_destination_in:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,770]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_destination_out:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[0,771]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_destination_over:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,1]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_lighter:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,1]},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_copy:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_texture_uvtransform","fp_gradient"]}],gradient_xor:[{parameters:["screen","uvtransform","alpha","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[773,771]},programs:["vp_texture_uvtransform","fp_gradient"]}],texture_shadow:[{parameters:["screen","color","texture"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture","fp_texture_shadow"]}],pattern_shadow:[{parameters:["screen","uvtransform","color","pattern"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture_uvtransform","fp_pattern_shadow"]}],gradient_shadow:[{parameters:["screen","uvtransform","color","gradient"],semantics:["POSITION"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[1,771]},programs:["vp_texture_uvtransform","fp_gradient_shadow"]}],image:[{parameters:["image"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_image","fp_image"]}]},programs:{fp_image:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D image;void main()\n{gl_FragColor=texture2D(image,tz_TexCoord[0].xy);}"},vp_image:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvoid main()\n{vec4 tmpvar_1;tmpvar_1.zw=vec2(0.0,1.0);tmpvar_1.x=ATTR0.x;tmpvar_1.y=ATTR0.y;tz_TexCoord[0].xy=ATTR8.xy;gl_Position=tmpvar_1;}"},fp_gradient_shadow:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D gradient;uniform vec4 color;void main()\n{gl_FragColor=(color*texture2D(gradient,tz_TexCoord[0].xy).w);}"},vp_texture_uvtransform:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;\nuniform vec3 uvtransform[2];uniform vec4 screen;void main()\n{vec2 tmpvar_1;vec2 tmpvar_2;tmpvar_2=((ATTR0.xy*screen.xy)+screen.zw);vec4 tmpvar_3;tmpvar_3.zw=vec2(0.0,1.0);tmpvar_3.x=tmpvar_2.x;tmpvar_3.y=tmpvar_2.y;vec3 tmpvar_4;tmpvar_4.z=1.0;tmpvar_4.x=ATTR0.x;tmpvar_4.y=ATTR0.y;tmpvar_1.x=dot(tmpvar_4,uvtransform[0]);tmpvar_1.y=dot(tmpvar_4,uvtransform[1]);tz_TexCoord[0].xy=tmpvar_1;gl_Position=tmpvar_3;}"},fp_pattern_shadow:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D pattern;uniform vec4 color;void main()\n{gl_FragColor=(color*texture2D(pattern,tz_TexCoord[0].xy).w);}"},fp_texture_shadow:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D texture;uniform vec4 color;void main()\n{gl_FragColor=(color*texture2D(texture,tz_TexCoord[0].xy).w);}"},vp_texture:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nuniform vec4 screen;void main()\n{vec2 tmpvar_1;tmpvar_1=((ATTR0.xy*screen.xy)+screen.zw);vec4 tmpvar_2;tmpvar_2.zw=vec2(0.0,1.0);tmpvar_2.x=tmpvar_1.x;tmpvar_2.y=tmpvar_1.y;tz_TexCoord[0].xy=ATTR8.xy;gl_Position=tmpvar_2;}"},fp_gradient:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D gradient;uniform float alpha;void main()\n{vec4 _fg;vec4 tmpvar_1;tmpvar_1=texture2D(gradient,tz_TexCoord[0].xy);_fg=tmpvar_1;_fg.w=(tmpvar_1.w*alpha);_fg.xyz=(tmpvar_1.xyz*_fg.w);gl_FragColor=_fg;}"},fp_pattern:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D pattern;uniform float alpha;void main()\n{vec4 _fg;vec4 tmpvar_1;tmpvar_1=texture2D(pattern,tz_TexCoord[0].xy);_fg=tmpvar_1;_fg.w=(tmpvar_1.w*alpha);_fg.xyz=(tmpvar_1.xyz*_fg.w);gl_FragColor=_fg;}"},fp_texture:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nuniform sampler2D texture;uniform vec4 color;void main()\n{vec4 _fg;vec4 tmpvar_1;tmpvar_1=(texture2D(texture,tz_TexCoord[0].xy)*color);_fg=tmpvar_1;_fg.xyz=(tmpvar_1.xyz*tmpvar_1.w);gl_FragColor=_fg;}"
},fp_flat:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nuniform vec4 color;void main()\n{gl_FragColor=color;}"},vp_flat:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nattribute vec4 ATTR0;\nuniform vec4 screen;void main()\n{vec2 tmpvar_1;tmpvar_1=((ATTR0.xy*screen.xy)+screen.zw);vec4 tmpvar_2;tmpvar_2.zw=vec2(0.0,1.0);tmpvar_2.x=tmpvar_1.x;tmpvar_2.y=tmpvar_1.y;gl_Position=tmpvar_2;}"}}},this.canvas=e,this.globalAlpha=1,this.globalCompositeOperation="source-over",this.strokeStyle="#000000",this.fillStyle="#000000",this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="rgba(0,0,0,0)",this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic",this.imageColor="#fff",this.gd=t,this.fm=null,this.target=null,this.viewport=[0,0,n,r],this.pixelRatio=1,this.width=n,this.height=r;var i=this.floatArrayConstructor;this.screen=new i(4),this.screen[0]=2/n,this.screen[1]=-2/r,this.screen[2]=-1,this.screen[3]=1,this.subPaths=[],this.needToSimplifyPath=[],this.currentSubPath=[],this.activeVertexBuffer=null,this.activeTechnique=null,this.activeScreen=new i(4),this.activeColor=new i(4);var s=t.createShader(this.shaderDefinition);this.shader=s,this.triangleStripPrimitive=t.PRIMITIVE_TRIANGLE_STRIP,this.triangleFanPrimitive=t.PRIMITIVE_TRIANGLE_FAN,this.trianglePrimitive=t.PRIMITIVE_TRIANGLES,this.lineStripPrimitive=t.PRIMITIVE_LINE_STRIP,this.linePrimitive=t.PRIMITIVE_LINES,this.textureVertexFormats=[t.VERTEXFORMAT_FLOAT2,t.VERTEXFORMAT_FLOAT2],this.textureSemantics=t.createSemantics(["POSITION","TEXCOORD0"]),this.textureVertexBuffer=t.createVertexBuffer({numVertices:4,attributes:this.textureVertexFormats,dynamic:!0,"transient":!0}),this.flatVertexFormats=[t.VERTEXFORMAT_FLOAT2],this.flatSemantics=t.createSemantics(["POSITION"]),this.flatVertexBuffer=t.createVertexBuffer({numVertices:256,attributes:this.flatVertexFormats,dynamic:!0,"transient":!0}),this.flatOffset=0,this.bufferData=new i(512),this.subBufferDataCache={},this.tempRect=new i(8),this.tempPoint=new i(2),this.tempVertices=[],this.tempStack=[],this.v4Zero=new i(4),this.v4Zero[0]=0,this.v4Zero[1]=0,this.v4Zero[2]=0,this.v4Zero[3]=0,this.v4One=new i(4),this.v4One[0]=1,this.v4One[1]=1,this.v4One[2]=1,this.v4One[3]=1,this.cachedColors={},this.numCachedColors=0,this.uvtransform=new i(6),this.uvtransform[0]=1,this.uvtransform[1]=0,this.uvtransform[2]=0,this.uvtransform[3]=0,this.uvtransform[4]=1,this.uvtransform[5]=0,this.tempColor=new i(4),this.tempScreen=new i(4),this.tempImage=null,this.imageTechnique=s.getTechnique("image");var o=this.compositeOperations,u={},a={},f={},l={};this.flatTechniques=u,this.textureTechniques=a,this.patternTechniques=f,this.gradientTechniques=l;for(var c in o)if(o.hasOwnProperty(c)){var h=c.replace("-","_");u[c]=s.getTechnique("flat_"+h),a[c]=s.getTechnique("texture_"+h),f[c]=s.getTechnique("pattern_"+h),l[c]=s.getTechnique("gradient_"+h)}this.textureShadowTechnique=s.getTechnique("texture_shadow"),this.patternShadowTechnique=s.getTechnique("pattern_shadow"),this.gradientShadowTechnique=s.getTechnique("gradient_shadow"),this.matrix=new i(6),this.resetTransform(),this.clipExtents=new i(4),this.clipExtents[0]=0,this.clipExtents[1]=0,this.clipExtents[2]=n,this.clipExtents[3]=r,this.statesStack=[this.createStatesObject()],this.numStatesInStack=0,this.defaultStates=this.createStatesObject(),this.cachedTriangulation={},this.tempAngles=[],this.cachedPaths={},this.numCachedPaths=0}return e.prototype.save=function(){var e=this.statesStack,t=this.numStatesInStack,n=e[t];n?this.setStates(n,this):e[t]=this.createStatesObject(),this.numStatesInStack=t+1},e.prototype.restore=function(){var e=this.numStatesInStack;if(0<e){e-=1,this.numStatesInStack=e;var t=this.statesStack[e];this.setStates(this,t)}},e.prototype.scale=function(e,t){var n=this.matrix;n[0]*=e,n[1]*=t,n[3]*=e,n[4]*=t},e.prototype.rotate=function(e){if(e){var t=Math.sin(e),n=Math.cos(e);(t<-0.005||.005<t||n<.995||1.005<n)&&this.transform(n,t,-t,n,0,0)}},e.prototype.translate=function(e,t){var n=this.matrix;n[2]+=n[0]*e+n[1]*t,n[5]+=n[3]*e+n[4]*t},e.prototype.transform=function(e,t,n,r,i,s){var o=this.matrix,u=o[0],a=o[1],f=o[2],l=o[3],c=o[4],h=o[5];o[0]=u*e+a*t,o[3]=l*e+c*t,o[1]=u*n+a*r,o[4]=l*n+c*r,o[2]=u*i+a*s+f,o[5]=l*i+c*s+h},e.prototype.setTransform=function(e,t,n,r,i,s){var o=this.matrix;o[0]=e,o[1]=n,o[2]=i,o[3]=t,o[4]=r,o[5]=s},e.prototype.resetTransform=function(){var e=this.matrix;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,this.scale=this.scaleIdentity,this.translate=this.translateIdentity,this.transform=this.setTransformIdentity,this.setTransform=this.setTransformIdentity,this.transformPoint=this.transformPointIdentity,this.transformRect=this.transformRectIdentity},e.prototype.createLinearGradient=function(e,t,n,r){return w.create(e,t,n,r)},e.prototype.createRadialGradient=function(e,t,n,r,i,s){return E.create(e,t,n,r,i,s)},e.prototype.createPattern=function(e){if(!e)throw"INVALID_STATE_ERR";return e.width===0||e.height===0?null:e},e.prototype.clearRect=function(e,t,n,r){if(n>0&&r>0){var i=this.gd,s=this.clipExtents,o=s[0],u=s[1],a=s[2],f=s[3],l=this.transformRect(e,t,n,r,this.tempRect);if(l[0]<=o&&l[1]>=f&&l[2]>=a&&l[3]>=f&&l[4]<=o&&l[5]<=u&&l[6]>=a&&l[7]<=u)i.clear(this.v4Zero);else{this.fillFlatBuffer(l,4);var c=this.flatTechniques.copy;this.setTechniqueWithColor(c,this.screen,this.v4Zero),i.draw(this.triangleStripPrimitive,4,this.flatOffset),this.flatOffset+=4}}},e.prototype.fillRect=function(e,t,n,r){if(n>0&&r>0){var i=this.transformRect(e,t,n,r,this.tempRect);this.fillFlatBuffer(i,4);var s=this.triangleStripPrimitive,o=this.fillStyle,u=this.gd;this.setShadowStyle(o)&&u.draw(s,4,this.flatOffset),this.setStyle(o),u.draw(s,4,this.flatOffset),this.flatOffset+=4}},e.prototype.strokeRect=function(e,t,n,r){if(n>0||r>0){var i=this.transformRect(e,t,n,r,this.tempRect),s=this.strokeStyle,o=this.lineWidth,u=this.pixelRatio*o<2,a,f,l;if(u)a=this.lineStripPrimitive,f=5,l=this.getFlatBuffer(5),l&&(l[0]=i[4],l[1]=i[5],l[2]=i[6],l[3]=i[7],l[4]=i[2],l[5]=i[3],l[6]=i[0],l[7]=i[1],l[8]=i[4],l[9]=i[5],this.fillFlatBuffer(l,5));else{var c=[i[0],i[1]],h=[i[2],i[3]],p=[i[4],i[5]],d=[i[6],i[7]],v=[p,d,h,c,p];a=this.triangleStripPrimitive,f=this.fillFatStrip(v,5,o)}var m=this.gd;this.setShadowStyle(s)&&m.draw(a,f,this.flatOffset),this.setStyle(s),m.draw(a,f,this.flatOffset),this.flatOffset+=f}},e.prototype.beginPath=function(){this.subPaths.length=0,this.currentSubPath.length=0,this.needToSimplifyPath[0]=!0},e.prototype.closePath=function(){var e=this.currentSubPath,t=e.length;if(t>1){var n=e[0];if(t>2){var r=e[t-1],i=Math.abs;if(i(n[0]-r[0])>=1||i(n[1]-r[1])>=1)e[t]=n;this.simplifyShape(e)}var s=this.subPaths,o=s.length;s[o]=e,this.currentSubPath=[n];var u=this.needToSimplifyPath;u[o]=!1,u[o+1]=!0}},e.prototype.moveTo=function(e,t){var n=this.currentSubPath,r=n.length;if(r>1){var i=this.subPaths,s=i.length;i[s]=n,this.currentSubPath=[this.transformPoint(e,t)];var o=this.needToSimplifyPath;o[s]=r>2,o[s+1]=!0}else n[0]=this.transformPoint(e,t)},e.prototype.lineTo=function(e,t){var n=this.currentSubPath;n[n.length]=this.transformPoint(e,t)},e.prototype.quadraticCurveTo=function(e,t,n,r){var i=this.currentSubPath,s=i.length;if(s===0)throw"Needs starting point!";var o=i[s-1],u=o[0],a=o[1],f=this.transformPoint(e,t),l=f[0],c=f[1],h=this.transformPoint(n,r),p=h[0],d=h[1],v=Math.abs,m=Math.ceil(this.pixelRatio*Math.sqrt(v(l-u)+v(c-a)+v(p-l)+v(d-c)));if(1<m){i.length+=m;var g=1/m;for(var y=g;1<m;y+=g,m-=1){var b=1-y,w=b*b,E=y*y,S=2*y*b;i[s]=[w*u+S*l+E*p,w*a+S*c+E*d],s+=1}}i[s]=h},e.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=this.currentSubPath,u=o.length;if(u===0)throw"Needs starting point!";var a=o[u-1],f=a[0],l=a[1],c,h,p,d,v,m,g;if(this.transformPoint===this.transformPointIdentity)c=e,h=t,p=n,d=r,m=i,g=s,v=[i,s];else if(this.transformPoint===this.transformPointTranslate){var y=this.matrix,b=y[2],w=y[5];c=e+b,h=t+w,p=n+b,d=r+w,m=i+b,g=s+w,v=[m,g]}else{var E=this.transformPoint(e,t);c=E[0],h=E[1];var S=this.transformPoint(n,r);p=S[0],d=S[1],v=this.transformPoint(i,s),m=v[0],g=v[1]}var x=Math.abs,T=Math.ceil(this.pixelRatio*Math.sqrt(x(c-f)+x(h-l)+x(p-c)+x(d-h)+x(m-p)+x(g-d)));if(1<T){o.length+=T;var N=1/T;for(var C=N;1<T;C+=N,T-=1){var k=1-C,L=k*k,A=L*k,O=C*C,M=O*C,_=3*C*L,D=3*O*k;o[u]=[A*f+_*c+D*p+M*m,A*l+_*h+D*d+M*g],u+=1}}o[u]=v},e.prototype.arcTo=function(e,t,n,r,i){if(i<0)throw"INDEX_SIZE_ERR";var s,o,u=this.currentSubPath,a=u.length;if(a===0)u[0]=this.transformPoint(e,t),a=1,s=e,o=t;else{var f=this.untransformPoint(u[a-1],this.tempPoint);s=f[0],o=f[1]}var l=s-e,c=o-t,h=l*l+c*c,p=n-e,d=r-t,v=p*p+d*d;if(i<2||h<2||v<2)u.push(this.transformPoint(e,t));else{var m=Math.sqrt,g=Math.acos,y=Math.PI;h=1/m(h),l*=h,c*=h,v=1/m(v),p*=v,d*=v;var b=l+p,w=c+d,E=1/m(b*b+w*w);b*=E,w*=E;var S=b*p+w*d,x=i/S,T=this.transformPoint(e+x*b,t+x*w),N=T[0],C=T[1],k=l*d-p*c>0,L=g(-b);w<0&&(L=-L),L=.5*y-L;var A=g(S),O=y+A+L,M=2*y-A+L;k?this.interpolateArc(N,C,i,M,O,!0):this.interpolateArc(N,C,i,O,M)}},e.prototype.arc=function(e,t,n,r,i,s){if(n<0)throw"INDEX_SIZE_ERR";var o=this.transformPoint(e,t);n<2?this.currentSubPath.push(o):this.interpolateArc(o[0],o[1],n,r,i,s)},e.prototype.ellipse=function(e,t,n,r,i,s,o,u){if(n<0||r<0)throw"INDEX_SIZE_ERR";if(n<2&&r<2){var a=this.transformPoint(e,t);this.currentSubPath.push(a);return}var f,l,c;n===r?(f=n,l=1,c=1):n>r?(f=n,l=1,c=r/n):(f=r,l=n/r,c=1),i!==0||l!==1||c!==1?(this.translate(e,t),i!==0&&this.rotate(i),(l!==1||c!==1)&&this.scale(l,c),this.arc(0,0,f,s,o,u),(l!==1||c!==1)&&this.scale(1/l,1/c),i!==0&&this.rotate(-i),this.translate(-e,-t)):this.arc(e,t,f,s,o,u)},e.prototype.rect=function(e,t,n,r){var i=this.subPaths,s=i.length,o=this.currentSubPath,u=o.length,a=this.needToSimplifyPath;u>1&&(i[s]=o,a[s]=u>2,s+=1);var f=this.transformRect(e,t,n,r,this.tempRect),l=[f[0],f[1]],c=[f[2],f[3]],h=[f[4],f[5]],p=[f[6],f[7]];i[s]=[h,p,c,l,h],this.currentSubPath=[l],a[s]=n<1||r<1,a[s+1]=!0},e.prototype.parsePath=function(e){var t=[],n=e.length,r=-1,i=-1,s=0,o=function(){var r=e.charCodeAt(s);while(r<=32||r===44){s+=1;if(s>=n)return-1;r=e.charCodeAt(s)}return r},u=function(){var r=e.charCodeAt(s);while(r<=32||r===44){s+=1;if(s>=n)throw"Reached end of string without required coordinate.";r=e.charCodeAt(s)}var i=s;if(r===45||r===43){s+=1;if(s>=n)return 0;r=e.charCodeAt(s)}while(r>=48&&r<=57){s+=1;if(s>=n)break;r=e.charCodeAt(s)}if(r===46||r===101||r===101){if(r===46)do{s+=1;if(s>=n)break;r=e.charCodeAt(s)}while(r>=48&&r<=57);if(r===101||r===101){s+=1;if(s<n){r=e.charCodeAt(s);if(r===45||r===43)s+=1,s<n&&(r=e.charCodeAt(s));while(r>=48&&r<=57){s+=1;if(s>=n)break;r=e.charCodeAt(s)}}}return parseFloat(e.slice(i,s))}return parseInt(e.slice(i,s),10)},a=function(){var n=o();if(n<-1)throw"Reached end of string without required flag.";if(n===48)return s+=1,!1;if(n===49)return s+=1,!0;throw"Unknown flag: "+e.slice(s)},f=-1,l=function(t,n,r){var i=t.length;if(0<f){var s=t[f];s<0?t[f]=s-1:t[f]=-2,t.push(n,r)}else f=i,t.push(76,n,r)},c=function(t,n){var r=t[0],i=t[1],s=n[0],o=n[1];return(r*s+i*o)/Math.sqrt((r*r+i*i)*(s*s+o*o))},h=function(t,n){return(t[0]*n[1]<t[1]*n[0]?-1:1)*Math.acos(c(t,n))},p=Math.sqrt,d=Math.abs,v=Math.PI,m=0,g=0,y=0,b=0,w,E,S,x,T,N,C,k,L,A,O;while(s<n){var M=o();if(M<0)return t;if(M===43||M===45||M===46||M>=48&&M<=57){if(r<0)throw"Coordinates without a command: "+e.slice(s);r===77?r=76:r===109&&(r=108)}else i=r,r=M,s+=1;switch(r){case 77:case 109:w=u(),E=u(),r===109&&(w+=m,E+=g),y=w,b=E,t.push(77,w,E),f=-1;break;case 76:case 108:w=u(),E=u(),r===108&&(w+=m,E+=g),l(t,w,E);break;case 72:case 104:w=u(),r===104&&(w+=m),E=g,l(t,w,E);break;case 86:case 118:w=m,E=u(),r===118&&(E+=g),l(t,w,E);break;case 67:case 99:S=u(),x=u(),T=u(),N=u(),w=u(),E=u(),r===99&&(S+=m,x+=g,T+=m,N+=g,w+=m,E+=g),t.push(67,S,x,T,N,w,E),f=-1;break;case 83:case 115:i===67||i===99||i===83||i===115?(S=2*m-T,x=2*g-N):(S=m,x=g),T=u(),N=u(),w=u(),E=u(),r===115&&(T+=m,N+=g,w+=m,E+=g),t.push(67,S,x,T,N,w,E),f=-1;break;case 81:case 113:S=u(),x=u(),w=u(),E=u(),r===113&&(S+=m,x+=g,w+=m,E+=g),t.push(81,S,x,w,E),f=-1;break;case 84:case 116:i===81||i===113||i===84||i===116?(S=2*m-S,x=2*g-x):(S=m,x=g),w=u(),E=u(),r===116&&(w+=m,E+=g),t.push(81,S,x,w,E),f=-1;break;case 65:case 97:S=m,x=g,C=u(),k=u(),L=u(),L*=v/180,A=a(),O=a(),w=u(),E=u(),r===97&&(w+=m,E+=g);var _=Math.cos(L),D=Math.sin(L),P=(S-w)*.5,H=(x-E)*.5,B=_*P+D*H,j=B*B,F=-D*P+_*H,I=F*F,q=j/(C*C)+I/(k*k);if(q>1){var R=p(q);C*=R,k*=R}var U=C*C,z=1/C,W=k*k,X=1/k,V=(A===O?-1:1)*p((U*W-U*I-W*j)/(U*I+W*j));isNaN(V)&&(V=0);var $=V*C*F*X,J=V*-k*B*z,K=(S+w)*.5+_*$-D*J,Q=(x+E)*.5+D*$+_*J,G=[(B-$)*z,(F-J)*X],Y=[(-B-$)*z,(-F-J)*X],Z=h([1,0],G),et,tt=c(G,Y);tt<=-1?et=v:tt>=1?et=0:et=h(G,Y),O?et<0&&(et+=2*v):et>0&&(et-=2*v);var nt,rt,it;C===k?(nt=C,rt=1,it=1):C>k?(nt=C,rt=1,it=k*z):(nt=k,rt=C*X,it=1),t.push(65,L,rt,it,K,Q,nt,Z,Z+et,!O),f=-1;break;case 90:case 122:if(3<=f&&t[f-3]===77){var st=t[f-2],ot=t[f-1];d(st-m)<1&&d(ot-g)<1&&(t[f]+=1,t[f]===0?t.length=f:t.length-=2)}w=y,E=b,t.push(90),f=-1;break;default:throw"Unknown command: "+e.slice(s)}m=w,g=E}return t},e.prototype.addPoints=function(e,t,n){var r=this.currentSubPath,i=r.length,s=i+n,o=t;r.length=s;if(this.transformPoint===this.transformPointIdentity){do r[i]=[e[o],e[o+1]],o+=2,i+=1;while(i<s)}else if(this.transformPoint===this.transformPointTranslate){var u=this.matrix,a=u[2],f=u[5];do r[i]=[e[o]+a,e[o+1]+f],o+=2,i+=1;while(i<s)}else do r[i]=this.transformPoint(e[o],e[o+1]),o+=2,i+=1;while(i<s);return o},e.prototype.path=function(e){var t=this.cachedPaths[e];t===undefined&&(this.numCachedPaths>=1024&&(this.cachedPaths={},this.numCachedPaths=0),t=this.parsePath(e),this.cachedPaths[e]=t,this.numCachedPaths+=1),this.compiledPath(t)},e.prototype.compiledPath=function(e){var t=e.length,n=-1,r=0,i,s,o,u,a,f;while(r<t){n=e[r],r+=1;if(n<0){r=this.addPoints(e,r,-n);continue}switch(n){case 77:i=e[r],r+=1,s=e[r],r+=1,this.moveTo(i,s);break;case 76:i=e[r],r+=1,s=e[r],r+=1,this.currentSubPath.push(this.transformPoint(i,s));break;case 67:o=e[r],r+=1,u=e[r],r+=1,a=e[r],r+=1,f=e[r],r+=1,i=e[r],r+=1,s=e[r],r+=1,this.bezierCurveTo(o,u,a,f,i,s);break;case 81:o=e[r],r+=1,u=e[r],r+=1,i=e[r],r+=1,s=e[r],r+=1,this.quadraticCurveTo(o,u,i,s);break;case 65:var l=e[r];r+=1;var c=e[r];r+=1;var h=e[r];r+=1;var p=e[r];r+=1;var d=e[r];r+=1;var v=e[r];r+=1;var m=e[r];r+=1;var g=e[r];r+=1;var y=e[r];r+=1,l!==0||c!==1||h!==1?(this.translate(p,d),l!==0&&this.rotate(l),(c!==1||h!==1)&&this.scale(c,h),this.arc(0,0,v,m,g,y),(c!==1||h!==1)&&this.scale(1/c,1/h),l!==0&&this.rotate(-l),this.translate(-p,-d)):this.arc(p,d,v,m,g,y);break;case 90:this.closePath();break;default:}}},e.prototype.fill=function(){var e=this.subPaths,t=e.length,n=this.currentSubPath,r=this.needToSimplifyPath;if(t>0||n.length>2){var i=this.autoClose,s=this.canTriangulateAsFan,o=this.triangulateAsFan,u,a,f,l=this.fillStyle,c,h,p=0;if(t>1||t===1&&n.length>2){c=this.trianglePrimitive,h=this.tempVertices;for(var d=0;d<t;d+=1)u=e[d],a=u.length,a>2&&(a=i(u,a),f=a-1,r[d]&&(r[d]=!1,f=this.simplifyShape(u)),f>1&&(s(u,f)?p=o(u,f,h,p):p=this.triangulateConcaveCached(u,f,h,p)));u=n,a=u.length,a>2&&(a=i(u,a),f=a-1,r[t]&&(r[t]=!1,f=this.simplifyShape(u)),f>1&&(s(u,f)?p=o(u,f,h,p):p=this.triangulateConcaveCached(u,f,h,p)))}else t>0?u=e[0]:u=n,a=u.length,a>2&&(a=i(u,a),f=a-1,r[0]&&(r[0]=!1,f=this.simplifyShape(u)),f>1&&(s(u,f)?(c=this.triangleFanPrimitive,h=u,p=f):(c=this.trianglePrimitive,h=this.tempVertices,p=this.triangulateConcaveCached(u,f,h,0))));if(p>0){var v=this.getFlatBuffer(p);this.fillFlatVertices(v,h,p),this.fillFlatBuffer(v,p);var m=this.gd;this.setShadowStyle(l)&&m.draw(c,p,this.flatOffset),this.setStyle(l),m.draw(c,p,this.flatOffset),this.flatOffset+=p}}},e.prototype.stroke=function(){var e=this.subPaths,t=e.length,n=this.currentSubPath,r=this.needToSimplifyPath;if(t>0||n.length>0){var i=this.gd,s=this.strokeStyle,o=this.lineWidth,u=this.pixelRatio*o<2,a,f,l,c,h;u?l=this.lineStripPrimitive:l=this.triangleStripPrimitive;for(var p=0;p<t;p+=1){a=e[p],f=a.length,r[p]&&(r[p]=!1,f=1+this.simplifyShape(a));if(u)c=f,h=this.getFlatBuffer(c),this.fillFlatVertices(h,a,c),this.fillFlatBuffer(h,c);else{if(!(f>1))continue;c=this.fillFatStrip(a,f,o)}this.setShadowStyle(s)&&i.draw(l,c,this.flatOffset),this.setStyle(s),i.draw(l,c,this.flatOffset),this.flatOffset+=c}a=n,f=a.length;if(f>0){r[t]&&(r[t]=!1,f>2&&(f=1+this.simplifyShape(a)));if(u)c=f,h=this.getFlatBuffer(c),this.fillFlatVertices(h,a,c),this.fillFlatBuffer(h,c);else{if(!(f>1))return;c=this.fillFatStrip(a,f,o)}this.setShadowStyle(s)&&i.draw(l,c,this.flatOffset),this.setStyle(s),i.draw(l,c,this.flatOffset),this.flatOffset+=c}}},e.prototype.drawSystemFocusRing=function(){},e.prototype.drawCustomFocusRing=function(){return!1},e.prototype.scrollPathIntoView=function(){},e.prototype.clip=function(){var e,t,n,r,i,s,o,u=0,a=[],f=this.subPaths,l=f.length;if(l>0){a.length=l,n=0;do e=f[n],e.length>2&&(a[u]=e.slice(),u+=1),n+=1;while(n<l)}var c=this.currentSubPath;c.length>2&&(a[u]=c.slice(0),u+=1);if(u===0)return;var h=this.autoClose,p,d,v,m;n=0;do{e=a[n],t=h(e,e.length),r=0,p===undefined&&(i=e[0],p=v=i[0],d=m=i[1],r=1);do i=e[r],s=i[0],o=i[1],p>s?p=s:v<s&&(v=s),d>o?d=o:m<o&&(m=o),r+=1;while(r<t);n+=1}while(n<u);var g=this.clipExtents,y=g[0],b=g[1],w=g[2],E=g[3];y=y>p?y:p,b=b>d?b:d,w=w<v?w:v,E=E<m?E:m,g[0]=y,g[1]=b,g[2]=w,g[3]=E,this.updateScissor()},e.prototype.isPointInPath=function(e,t){var n=this.subPaths,r=n.length;if(r>0)for(var i=0;i<r;i+=1)if(this.isPointInSubPath(e,t,n[i]))return!0;var s=this.currentSubPath;return this.isPointInSubPath(e,t,s)?!0:!1},e.prototype.fillText=function(t,n,r,i){if(i!==undefined&&i<=0)return;var s=this.fm;if(!s)return;var o=this.buildFontName();if(!o)return;var u=s.load(o);if(!u)return;i||(i=this.width);var a,f=this.fillStyle;typeof f=="string"?a=this.parseColor(f):a=this.v4One;var l=this.globalAlpha;if(l<1){var c=this.tempColor;c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]*l,a=c}var h=this.textureTechniques[this.globalCompositeOperation];if(!h)throw"Unknown composite operation: "+this.globalCompositeOperation;this.setTechniqueWithColor(h,this.screen,a);var p=this.calculateFontScale(u);if(this.textBaseline==="alphabetic")r-=u.baseline*p;else if(this.textBaseline==="middle")r-=u.baseline*.5*p;else if(this.textBaseline==="bottom"||this.textBaseline==="ideographic")r-=u.lineHeight*p;var d;this.textAlign==="left"||this.textAlign==="start"?d=0:this.textAlign==="right"||this.textAlign==="end"?d=2:d=1;var v;if(this.transformRect===e.prototype.transformRect){var m=u.calculateTextDimensions(t,p,0);v={rect:[n,r,i,i],scale:p,spacing:0,alignment:d,dimensions:m};var g=m.numGlyphs,y=m.glyphCounts,b=y.length,w,E,S=u.fm.scratchPageContext;for(w=0;w<b;w+=1){E=y[w];if(E){S=u.generatePageTextVertices(t,v,w,S);var x=S.vertices;if(x){var T=x.length,N;for(N=0;N<T;N+=4){var C=this.transformPoint(x[N],x[N+1]);x[N]=C[0],x[N+1]=C[1]}}u.drawTextVertices(S,w,!0)}g-=E;if(0===g)break}}else{var k=this.transformRect(n,r,i,i,this.tempRect);n=k[4],r=k[5];var L=k[2]-n,A=k[3]-r;v={rect:[n,r,L,A],scale:p,spacing:0,alignment:d}}u.drawTextRect(t,v),this.activeVertexBuffer=null},e.prototype.strokeText=function(){},e.prototype.measureText=function(e){var t=this.fm;if(t){var n=this.buildFontName();if(n){var r=t.load(n);if(r){var i=this.calculateFontScale(r);return{width:r.calculateTextDimensions(e,i,0).width}}}}return{width:0}},e.prototype.drawImage=function(e,t,n,r,i){var s,o,u,a,f,l,c,h;if(arguments.length>=7){var p=arguments[1],d=arguments[2],v=arguments[3],m=arguments[4];s=arguments[5],o=arguments[6],arguments.length>=9?(u=arguments[7],a=arguments[8]):(u=v,a=m);var g=1/e.width,y=1/e.height;f=p*g,l=d*y,c=(p+v)*g,h=(d+m)*y}else s=arguments[1],o=arguments[2],arguments.length>=5?(u=arguments[3],a=arguments[4]):(u=e.width,a=e.height),f=0,l=0,c=1,h=1;if(u>0&&a>0){var b=this.getTextureBuffer(4);if(b){var w=this.transformRect(s,o,u,a,this.tempRect);b[0]=w[0],b[1]=w[1],b[2]=f,b[3]=h,b[4]=w[2],b[5]=w[3],b[6]=c,b[7]=h,b[8]=w[4],b[9]=w[5],b[10]=f,b[11]=l,b[12]=w[6],b[13]=w[7],b[14]=c,b[15]=l,this.fillTextureBuffer(b,4);var E=this.triangleStripPrimitive,S=this.gd;this.setShadowStyle(e,!0)&&S.draw(E,4);var x=this.textureTechniques[this.globalCompositeOperation];if(!x)throw"Unknown composite operation: "+this.globalCompositeOperation;var T=this.parseColor(this.imageColor),N=this.globalAlpha;if(N<1){var C=this.tempColor;C[0]=T[0],C[1]=T[1],C[2]=T[2],C[3]=T[3]*N,T=C}this.setTechniqueWithColor(x,this.screen,T),x.texture=e,S.draw(E,4)}}},e.prototype.createImageData=function(){var e,t;if(arguments.length===2)e=arguments[0],t=arguments[1];else{if(arguments.length!==1)throw"Wrong arguments";var n=arguments[0];e=n.width,t=n.height}var r=e*t*4,i=new Array(r);for(var s=0;s<r;s+=1)i[s]=0;return{width:e,height:t,data:i}},e.prototype.getImageData=function(e,t,n,r){var i=this.gd;t=this.height-(t+r);var s=i.getScreenshot(!1,e,t,n,r);return{width:n,height:r,data:s}},e.prototype.putImageData=function(e,t,n){if(!e||!e.data)throw"TYPE_MISMATCH_ERR";var r=e.width,i=e.height,s,o,u,a;arguments.length>=7?(s=arguments[3],o=arguments[4],u=arguments[5],a=arguments[6]):(s=0,o=0,u=r,a=i);if(u&&a){var f=this.gd,l=this.tempImage;if(l===null||l.width!==u||l.height!==a)this.tempImage=l=f.createTexture({name:"imageData:"+u+"x"+a,width:u,height:a,depth:1,format:f.PIXELFORMAT_R8G8B8A8,cubemap:!1,mipmaps:!1});l.setData(e.data);var c=this.viewport;f.setScissor(c[0],c[1],c[2],c[3]);var h=this.getTextureBuffer(4);if(h){var p=2/this.width,d=2/this.height,v=t*p-1,m=1-n*d,g=(t+u)*p-1,y=1-(n+a)*d,b=1/r,w=1/i,E=s*b,S=o*w,x=(s+u)*b,T=(o+a)*w;h[0]=v,h[1]=y,h[2]=E,h[3]=T,h[4]=g,h[5]=y,h[6]=x,h[7]=T,h[8]=v,h[9]=m,h[10]=E,h[11]=S,h[12]=g,h[13]=m,h[14]=x,h[15]=S,this.fillTextureBuffer(h,4);var N=this.imageTechnique;f.setTechnique(N),this.activeTechnique=null,N.image=l,f.draw(this.triangleStripPrimitive,4)}this.updateScissor()}},e.prototype.beginFrame=function(e,t){if(this.target)throw'"endFrame" was never called!';var n=this.gd;e||(e=n),this.target=e,n.setViewport(0,0,e.width,e.height);var r=this.viewport;t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):(r[0]=0,r[1]=0,r[2]=e.width,r[3]=e.height);var i=this.canvas,s=i.width,o=i.height;this.updateScreenScale(),this.updateScissor(),this.pixelRatio=Math.max(r[2]/s,r[3]/o),this.activeVertexBuffer=null,this.activeTechnique=null,this.flatOffset=0;if(s!==this.width||o!==this.height)this.width=s,this.height=o,this.resetState(),this.clearRect(0,0,s,o);return!0},e.prototype.endFrame=function(){var e=this.target;if(!e)throw'"beginFrame" was never called!';this.target=null,this.gd.setScissor(0,0,e.width,e.height)},e.prototype.setWidth=function(e){this.width=e,this.resetState(),this.target&&(this.updateScreenScale(),this.clearRect(0,0,e,this.height))},e.prototype.setHeight=function(e){this.height=e,this.resetState(),this.target&&(this.updateScreenScale(),this.clearRect(0,0,this.width,e))},e.prototype.createStatesObject=function(){var e={globalAlpha:this.globalAlpha,globalCompositeOperation:this.globalCompositeOperation,strokeStyle:this.strokeStyle,fillStyle:this.fillStyle,lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,miterLimit:this.miterLimit,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,font:this.font,textAlign:this.textAlign,textBaseline:this.textBaseline,imageColor:this.imageColor,matrix:new this.floatArrayConstructor(6),scale:this.scale,translate:this.translate,transform:this.transform,setTransform:this.setTransform,transformPoint:this.transformPoint,transformRect:this.transformRect,clipExtents:new this.floatArrayConstructor(4)},t=e.matrix,n=this.matrix;t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5];var r=e.clipExtents,i=this.clipExtents;return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],e},e.prototype.setStates=function(e,t){e.globalAlpha=t.globalAlpha,e.globalCompositeOperation=t.globalCompositeOperation,e.strokeStyle=t.strokeStyle,e.fillStyle=t.fillStyle,e.lineWidth=t.lineWidth,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.imageColor=t.imageColor;var n=e.matrix,r=t.matrix;n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],e.scale=t.scale,e.translate=t.translate,e.transform=t.transform,e.setTransform=t.setTransform,e.transformPoint=t.transformPoint,e.transformRect=t.transformRect;var i=e.clipExtents,s=t.clipExtents;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],e},e.prototype.resetState=function(){this.numStatesInStack=0,this.beginPath(),this.setStates(this,this.defaultStates);var e=this.clipExtents;e[0]=0,e[1]=0,e[2]=this.width,e[3]=this.height,this.target&&this.updateScissor()},e.prototype.updateScreenScale=function(){var e=this.screen,t=this.target,n=this.viewport,r=t.width,i=t.height;e[0]=2*n[2]/(this.width*r),e[1]=-2*n[3]/(this.height*i),e[2]=-1+2*n[0]/r,e[3]=1-2*(n[1]+n[3]-i)/i},e.prototype.updateScissor=function(){var e=this.viewport,t=e[0],n=e[1],r=e[2],i=e[3],s=r/this.width,o=i/this.height,u=this.clipExtents,a=u[0]*s,f=u[1]*o,l=u[2]*s,c=u[3]*o,h=t+a,p=n+(i-c),d=l-a,v=c-f;h<0&&(h=0),p<0&&(p=0);var m=this.target;h+d>m.width&&(d=m.width-h),p+v>m.height&&(v=m.height-p),this.gd.setScissor(h,p,d,v)},e.prototype.setFontManager=function(e){this.fm=e},e.prototype.buildFontName=function(){var e,t=this.font,n=t.lastIndexOf(" ");return n!==-1&&(e="fonts/"+t.substr(n+1)+".fnt"),e},e.prototype.calculateFontScale=function(e){var t=parseInt(this.font,10);return isNaN(t)?1:t/e.lineHeight},e.prototype.resetTransformMethods=function(){var t=e.prototype;this.scale=t.scale,this.translate=t.translate,this.transform=t.transform,this.setTransform=t.setTransform,this.transformPoint=t.transformPoint,this.transformRect=t.transformRect},e.prototype.transformPoint=function(e,t){var n=this.matrix;return[e*n[0]+t*n[1]+n[2],e*n[3]+t*n[4]+n[5]]},e.prototype.transformRect=function(e,t,n,r,i){var s=this.matrix,o=s[0],u=s[1],a=s[2],f=s[3],l=s[4],c=s[5],h=e*o+t*u+a,p=e*f+t*l+c,d=n*o,v=r*u,m=n*f,g=r*l;return i[0]=h+v,i[1]=p+g,i[2]=h+d+v,i[3]=p+m+g,i[4]=h,i[5]=p,i[6]=h+d,i[7]=p+m,i},e.prototype.transformPointTranslate=function(e,t){var n=this.matrix;return[e+n[2],t+n[5]]},e.prototype.transformRectTranslate=function(e,t,n,r,i){var s=this.matrix,o=e+s[2],u=t+s[5],a=o+n,f=u+r;return i[0]=o,i[1]=f,i[2]=a,i[3]=f,i[4]=o,i[5]=u,i[6]=a,i[7]=u,i},e.prototype.transformPointIdentity=function(e,t){return[e,t]},e.prototype.transformRectIdentity=function(e,t,n,r,i){var s=e+n,o=t+r;return i[0]=e,i[1]=o,i[2]=s,i[3]=o,i[4]=e,i[5]=t,i[6]=s,i[7]=t,i},e.prototype.transformTranslate=function(e,t,n,r,i,s){var o=this.matrix;o[0]=e,o[3]=t,o[1]=n,o[4]=r,o[2]=i+o[2],o[5]=s+o[5],this.resetTransformMethods()},e.prototype.scaleIdentity=function(e,t){if(e<.999||1.001<e||t<.999||1.001<t){var n=this.matrix;n[0]=e,n[4]=t,this.resetTransformMethods()}},e.prototype.translateIdentity=function(t,n){if(t!==0||n!==0){var r=this.matrix;r[2]=t,r[5]=n,this.translate=e.prototype.translate,this.transform=this.transformTranslate,this.transformPoint=this.transformPointTranslate,this.transformRect=this.transformRectTranslate}},e.prototype.setTransformIdentity=function(e,t,n,r,i,s){var o=this.matrix;o[0]=e,o[1]=n,o[2]=i,o[3]=t,o[4]=r,o[5]=s,this.resetTransformMethods()},e.prototype.untransformPoint=function(e,t){if(this.transformPoint===this.transformPointIdentity)return e;var n=this.matrix,r=e[0],i=e[1];if(this.transformPoint===this.transformPointTranslate)return t[0]=r-n[2],t[1]=i-n[5],t;var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c,h,p,d,v,m,g=s*f-o*a;if(g===0)return e;c=f,d=-a,h=-o,v=s,p=o*l-f*u,m=u*a-s*l;if(g!==1){var y=1/g;c*=y,d*=y,h*=y,v*=y,p*=y,m*=y}return t[0]=r*c+i*h+p,t[1]=r*d+i*v+m,t},e.prototype.calculateGradientUVtransform=function(e){var t=this.matrix,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=e[0],f=e[1],l=e[2],c=e[3],h=e[4],p=e[5],d,v,m,g,y,b,w=n*o-r*s;if(w===0)d=1,g=0,v=0,y=1,m=0,b=0;else{d=o,g=-s,v=-r,y=n,m=r*u-o*i,b=i*s-n*u;if(w!==1){var E=1/w;d*=E,g*=E,v*=E,y*=E,m*=E,b*=E}}var S=this.uvtransform;return S[0]=a*d+f*g,S[1]=a*v+f*y,S[2]=a*m+f*b+l,S[3]=c*d+h*g,S[4]=c*v+h*y,S[5]=c*m+h*b+p,S},e.prototype.calculatePatternUVtransform=function(e,t){var n=this.matrix,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=1/e,l=1/t,c,h,p,d,v,m,g=r*u-i*o;if(g===0)c=1,d=0,h=0,v=1,p=0,m=0;else{c=u,d=-o,h=-i,v=r,p=i*a-u*s,m=s*o-r*a;if(g!==1){var y=1/g;c*=y,d*=y,h*=y,v*=y,p*=y,m*=y}}var b=this.uvtransform;return b[0]=f*c,b[1]=f*h,b[2]=f*p,b[3]=l*d,b[4]=l*v,b[5]=l*m,b},e.prototype.setShadowStyle=function(e,t){var n=this.shadowOffsetX,r=this.shadowOffsetY;if(n<1&&r<1)return!1;if(this.globalCompositeOperation!=="source-over")return!1;var i=this.parseColor(this.shadowColor),s=i[3]*this.globalAlpha;this.shadowBlur>0&&(s*=.5);if(s<.004)return!1;if(s<1){var o=this.tempColor;o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=s,i=o}var u=this.screen,a=u[0],f=u[1],l=this.tempScreen;l[0]=a,l[1]=f,l[2]=u[2]+n*a,l[3]=u[3]+r*f,u=l;var c;if(typeof e!="string"&&!e.opaque)if(t)c=this.textureShadowTechnique,this.setTechniqueWithColor(c,u,i),c.texture=e;else if(e.stops){var h=e.updateTexture(this.gd),p=h.width,d=h.height;if(!p||!d)throw"INVALID_STATE_ERR";c=this.gradientShadowTechnique,this.setTechniqueWithColor(c,u,i),c.uvtransform=this.calculateGradientUVtransform(e.matrix),c.gradient=h}else{var v=e.width,m=e.height;if(!v||!m)throw"INVALID_STATE_ERR";c=this.patternShadowTechnique,this.setTechniqueWithColor(c,u,i),c.uvtransform=this.calculatePatternUVtransform(v,m),c.pattern=e}else s<1?c=this.flatTechniques["source-over"]:c=this.flatTechniques.copy,this.setTechniqueWithColor(c,u,i);return!0},e.prototype.setStyle=function(e){if(!e)throw"INVALID_STATE_ERR";var t=this.globalCompositeOperation,n=this.screen,r;if(typeof e=="string"){var i=this.parseColor(e),s=i[3]*this.globalAlpha;if(s<1){var o=this.tempColor;o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=s,i=o}if(t!=="source-over"||s<1){r=this.flatTechniques[t];if(!r)throw"Unknown composite operation: "+t}else r=this.flatTechniques.copy;this.setTechniqueWithColor(r,n,i)}else if(e.stops){var u=e.updateTexture(this.gd),a=u.width,f=u.height;if(!a||!f)throw"INVALID_STATE_ERR";var l=this.globalAlpha;if(t!=="source-over"||l<1||!e.opaque){r=this.gradientTechniques[t];if(!r)throw"Unknown composite operation: "+t}else r=this.gradientTechniques.copy;this.setTechniqueWithAlpha(r,n,l),r.uvtransform=this.calculateGradientUVtransform(e.matrix),r.gradient=u}else{var c=e.width,h=e.height;if(!c||!h)throw"INVALID_STATE_ERR";r=this.patternTechniques[t];if(!r)throw"Unknown composite operation: "+t;this.setTechniqueWithAlpha(r,n,this.globalAlpha),r.uvtransform=this.calculatePatternUVtransform(c,h),r.pattern=e}},e.prototype.setStream=function(e,t){this.activeVertexBuffer!==e&&(this.activeVertexBuffer=e,this.gd.setStream(e,t,0))},e.prototype.setTechniqueWithAlpha=function(e,t,n){var r=this.activeScreen,i=this.activeColor;if(this.activeTechnique!==e)this.activeTechnique=e,this.gd.setTechnique(e),e.screen=t,e.alpha=n,r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],i[3]=n;else{if(r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3])r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],e.screen=t;i[3]!==n&&(i[3]=n,e.alpha=n)}},e.prototype.setTechniqueWithColor=function(e,t,n){var r=this.activeScreen,i=this.activeColor;if(this.activeTechnique!==e)this.activeTechnique=e,this.gd.setTechnique(e),e.screen=t,e.color=n,r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3];else{if(r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3])r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],e.screen=t;if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],e.color=n}},e.prototype.parseColor=function(e){var t=this.cachedColors[e];if(t!==undefined)return t;this.numCachedColors>=1024&&(this.cachedColors={},this.numCachedColors=0),t=b(e,new this.floatArrayConstructor(4));if(t)return this.cachedColors[e]=t,this.numCachedColors+=1,t;throw"Unknown color: "+e},e.prototype.interpolateArc=function(e,t,n,r,i,s){var o=Math.cos,u=Math.sin,a=Math.PI*2,f=this.currentSubPath,l=f.length,c,h,p,d,v=1/Math.sqrt(n*this.pixelRatio),m=this.matrix,g=m[0]*n,y=m[1]*n,b=m[3]*n,w=m[4]*n;if(s){while(i>=r)i-=a;h=r-i;if(h>=v)for(c=r;c>i;c-=v)p=o(c),d=u(c),f[l]=[p*g+d*y+e,p*b+d*w+t],l+=1}else{while(i<=r)i+=a;h=i-r;if(h>=v)for(c=r;c<i;c+=v)p=o(c),d=u(c),f[l]=[p*g+d*y+e,p*b+d*w+t],l+=1}p=o(i),d=u(i),f[l]=[p*g+d*y+e,p*b+
d*w+t]},e.prototype.getFlatBuffer=function(e){var t=this.bufferData,n=2*e;if(t.length<n)this.bufferData=t=new this.floatArrayConstructor(n),this.subBufferDataCache={};else if(n<t.length){var r=this.subBufferDataCache[n];r===undefined&&(r=t.subarray(0,n),this.subBufferDataCache[n]=r),t=r}return t},e.prototype.fillFlatBuffer=function(e,t){var n=this.flatVertexBuffer;n.numVertices<t?(n.destroy(),this.flatVertexBuffer=n=this.gd.createVertexBuffer({numVertices:t,attributes:this.flatVertexFormats,dynamic:!0,"transient":!0}),this.flatOffset=0):this.flatOffset+t>n.numVertices&&(this.flatOffset=0),n.setData(e,this.flatOffset,t),this.setStream(n,this.flatSemantics)},e.prototype.getTextureBuffer=function(e){var t=this.bufferData,n=4*e;if(t.length<n)this.bufferData=t=new this.floatArrayConstructor(n),this.subBufferDataCache={};else if(n<t.length){var r=this.subBufferDataCache[n];r===undefined&&(r=t.subarray(0,n),this.subBufferDataCache[n]=r),t=r}return t},e.prototype.fillTextureBuffer=function(e,t){var n=this.textureVertexBuffer;n.numVertices<t&&(n.destroy(),this.textureVertexBuffer=n=null,this.textureVertexBuffer=n=this.gd.createVertexBuffer({numVertices:t,attributes:this.textureVertexFormats,dynamic:!0,"transient":!0})),n.setData(e,0,t),this.setStream(n,this.textureSemantics)},e.prototype.fillFatStrip=function(e,t,n){var r=0,i=this.getFlatBuffer(t*2);if(i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=Math.sqrt,S=Math.abs,x=n*.5;o=e[0],u=o[0],a=o[1];var T=e[t-1],N=S(u-T[0])<1&&S(a-T[1])<1;if(N){if(t<3)return 0;o=e[t-2],c=u-o[0],h=a-o[1]}else o=e[1],c=o[0]-u,h=o[1]-a;v=c*c+h*h,v>0&&(v=1/E(v),c*=v,h*=v),s=0,y=0;do{s+=1;if(s<t)o=e[s],f=o[0],l=o[1];else{if(!N){c*=x,h*=x,i[y+0]=u-h,i[y+1]=a+c,i[y+2]=u+h,i[y+3]=a-c,y+=4,r+=2;break}o=e[1],f=o[0],l=o[1]}p=f-u,d=l-a,v=p*p+d*d,v>=1&&(v=1/E(v),p*=v,d*=v,m=c+p,g=h+d,v=m*m+g*g,v>.001?(b=n/v,w=x/E(v),h*p>c*d&&(v=b,b=w,w=v)):(m=-h,g=c,b=x,w=x),i[y+0]=u-g*b,i[y+1]=a+m*b,i[y+2]=u+g*w,i[y+3]=a-m*w,y+=4,r+=2,u=f,a=l,c=p,h=d)}while(s<t);this.fillFlatBuffer(i,r)}return r},e.prototype.autoClose=function(e,t){var n=e[0],r=e[t-1];if(n===r)return t;var i=Math.abs;return i(n[0]-r[0])<1&&i(n[1]-r[1])<1?t:(e[t]=n,t+1)},e.prototype.isClosed=function(e,t){if(e===t)return!0;var n=Math.abs;return n(e[0]-t[0])<1&&n(e[1]-t[1])<1?!0:!1},e.prototype.canTriangulateAsFan=function(e,t){if(t<4)return!0;var n=0,r=e[0],i=e[1],s=r[0],o=r[1],u=i[0],a=i[1],f=u-s,l=a-o,c=2;do{var h=e[c],p=h[0],d=h[1],v=p-s,m=d-o,g=f*m-l*v;g<0?n|=1:g>0&&(n|=2);if(n===3)return!1;f=v,l=m,c+=1}while(c<t);return n!==0?!0:!1},e.prototype.simplifyShape=function(e){var t=Math.abs,n=.5/this.pixelRatio,r=this.tempStack,i=0,s=0,o=e.length-1,u=e[o],a=u[0],f=u[1],l,c;for(;;){var h=e[s],p=h[0],d=h[1],v=a-p,m=f-d,g=s+1,y=n,b=-1;if(t(v)<n)for(l=g;l<o;l+=1)c=t(e[l][0]-a),y<c&&(y=c,b=l);else if(t(m)<n)for(l=g;l<o;l+=1)c=t(e[l][1]-f),y<c&&(y=c,b=l);else{var w=m/v,E=d-w*p,S;y*=Math.sqrt(w*w+1);for(l=g;l<o;l+=1)S=e[l],c=t(w*S[0]-S[1]+E),y<c&&(y=c,b=l)}if(b===-1){o===e.length-1?(e[g]=u,e.length=g+1):e.splice(g,o-g);if(i===0)break;i-=2,s=r[i],o=r[i+1],u=e[o],a=u[0],f=u[1]}else if(g<b)b+1<o?(r[i]=s,r[i+1]=b,i+=2,s=b):(o=b,u=e[o],a=u[0],f=u[1]);else if(b+1<o)s=b;else{if(i===0)break;i-=2,s=r[i],o=r[i+1],u=e[o],a=u[0],f=u[1]}}return e.length-1},e.prototype.calculateArea=function(e,t){var n=0,r=e[t-2],i=e[t-1],s=0;do{var o=e[s];n+=i[0]*(o[1]-r[1]),r=i,i=o,s+=1}while(s<t);return n*.5},e.prototype.triangulateAsFan=function(e,t,n,r){var i=e[0],s=e[1],o=2;do{var u=e[o];n[r]=i,n[r+1]=s,n[r+2]=u,r+=3,s=u,o+=1}while(o<t);return r},e.prototype.getAngles=function(e,t,n){var r=e[0],i=e[1],s=r[0],o=r[1],u=i[0],a=i[1],f=u-s,l=a-o,c=f*f+l*l,h=2,p=Math.sqrt,d;do{var v=e[h],m=v[0],g=v[1],y=m-s,b=g-o,w=y*y+b*b;d=(f*b-l*y)/p(c*w),n[h-2]=d*100|0,f=y,l=b,c=w,h+=1}while(h<t);return h-2},e.prototype.lowerBound=function(e,t,n){var r=0,i=e.length>>>1,s,o,u,a,f,l;while(0<i){s=i>>>1,o=r+s,u=(o<<1)+1,f=0,l=e[u];for(;;){a=l[f]-t[f];if(a<0){r=o+1,i-=s+1;break}if(a>0){i=s;break}f+=1;if(f>=n)return-u}}return r<<1},e.prototype.triangulateConcaveCached=function(e,t,n,r){var i,s=this.tempAngles,o=this.getAngles(e,t,s),u=this.cachedTriangulation,a=u[o];a===undefined?(u[o]=a=[],i=0):i=this.lowerBound(a,s,o);if(i<0)i=-i-1,r=this.expandIndices(e,n,r,a[i]);else{var f=this.calculateArea(e,t);if(f===0)return r;var l=t+1,c;for(c=0;c<l;c+=1)e[c][2]=c;var h=r;r=this.triangulateConcave(e,t,n,r,!1,f);var p=r-h,d=l<256?new this.byteArrayConstructor(p):new this.shortArrayConstructor(p);for(c=0;c<p;c+=1)d[c]=n[h+c][2];a.length>=1024&&(a.length=0,i=0);var v=s.slice(0,o);i<a.length?a.splice(i,0,d,v):a.push(d,v)}return r},e.prototype.expandIndices=function(e,t,n,r){var i=r.length,s,o;for(s=0,o=n;s<i;s+=1,o+=1)t[o]=e[r[s]];return o},e.prototype.triangulateConcave=function(e,t,n,r,i,s){var o=this.canTriangulateAsFan;i?e.length=t:e=e.slice(0,t);var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I;do{u=t-2,a=t-1,f=0,l=e[u],v=l[0],m=l[1],c=e[a],g=c[0],y=c[1],x=g-v,T=y-m,F=!1;do{I=!1,h=e[f],b=h[0],w=h[1],E=b-v,S=w-m,d=x*S-E*T;if(s*d>0){N=v<g?v:g,N=N<b?N:b,C=v>g?v:g,C=C>b?C:b,k=m<y?m:y,k=k<w?k:w,L=m>y?m:y,L=L>w?L:w,0<d?(A=g-v,O=m-y,M=v*y-m*g,_=b-g,D=y-w,P=g*w-y*b,H=v-b,B=w-m,j=b*m-w*v):(A=v-g,O=y-m,M=m*g-v*y,_=g-b,D=w-y,P=y*b-g*w,H=b-v,B=m-w,j=w*v-b*m);var q=.1,R=-1;p=0;do{var U=e[p],z=U[0];if(N<z&&z<C){var W=U[1];if(k<W&&W<L){var X=B*z+H*W+j;q<X&&.1<O*z+A*W+M&&.1<D*z+_*W+P&&(q=X,R=p)}}p+=1}while(p<t);if(R<0)n[r]=l,n[r+1]=c,n[r+2]=h,r+=3,I=!0;else if(R===(a+2)%t)u=a,a=f,f=R,l=c,v=g,m=y,c=h,h=e[f],b=h[0],w=h[1],E=b-v,S=w-m,n[r]=l,n[r+1]=c,n[r+2]=h,r+=3,I=!0;else{if(a!==(R+2)%t){var V,$;a<R?(V=a,$=R):(V=R,$=a);var J=$-V+1,K,Q;J<=e.length-J+2?(K=e.splice(V,J,e[V],e[$]),Q=e):(Q=e.splice(V,J,e[V],e[$]),K=e),e=null;var G=K.length;G===3?(n[r]=K[0],n[r+1]=K[1],n[r+2]=K[2],r+=3):(K[G]=K[0],o(K,G)?r=this.triangulateAsFan(K,G,n,r):r=this.triangulateConcave(K,G,n,r,!0,s)),K=null;var Y=Q.length;if(Y===3)return n[r]=Q[0],n[r+1]=Q[1],n[r+2]=Q[2],r+=3,r;Q[Y]=Q[0],e=Q,t=Y,Q=null,e.length=t,F=!0;break}f=a,a=u,u=R,h=c,b=g,w=y,c=l,l=e[u],v=l[0],m=l[1],E=b-v,S=w-m,n[r]=l,n[r+1]=c,n[r+2]=h,r+=3,I=!0}}else d===0&&(I=!0);if(I){F=!0,e.splice(a,1),t-=1;if(t<4)break;if(f<t){a===0?u=t-1:(u=a-1,a===t&&(a=0)),f=a+1,c=h,g=b,y=w,x=E,T=S;continue}break}u=a,a=f,f+=1,l=c,v=g,m=y,c=h,g=b,y=w,x=g-v,T=y-m}while(f<t)}while(F&&!o(e,t));if(!F)return r;l=e[0],v=l[0],m=l[1],c=e[1],g=c[0],y=c[1],x=g-v,T=y-m,p=2;do h=e[p],b=h[0],w=h[1],E=b-v,S=w-m,d=x*S-E*T,s*d>0&&(n[r]=l,n[r+1]=c,n[r+2]=h,r+=3),c=h,g=b,y=w,x=E,T=S,p+=1;while(p<t);return r},e.prototype.fillFlatVertices=function(e,t,n){var r=0,i=0;do{var s=t[r];e[i]=s[0],i+=1,e[i]=s[1],i+=1,r+=1}while(r<n)},e.prototype.isPointInPolygon=function(e,t,n,r){var i,s,o,u,a,f;u=n[r-1],i=u[1]>=t,o=!1;for(f=0;f<r;f+=1)a=n[f],s=a[1]>=t,i!==s&&(a[1]-t)*(u[0]-a[0])>=(a[0]-e)*(u[1]-a[1])===s&&(o=!o),u=a,i=s;return o},e.prototype.isPointInSubPath=function(e,t,n){var r=n.length;return r>2&&this.isClosed(n[0],n[r-1])?(r-=1,this.isPointInPolygon(e,t,n,r)):!1},e.create=function(t,n,r,i){return new e(t,n,r,i)},e.version=1,e}(),x=function(){function e(){}return e.prototype.getContext=function(e){return e.toLowerCase()==="2d"?this.context:null},e.prototype.toDataURL=function(){if(this.width===0||this.height===0)return"data:,";var e=this.context.gd.getScreenshot(!0,0,0,this.width,this.height);return e?"data:image/jpeg;base64,"+e.toBase64():null},e.prototype.toBlob=function(e){if(e){var t=this.context.gd.getScreenshot(!0,0,0,this.width,this.height);e(t)}},e.prototype.setAttribute=function(e,t){t.substr(-2,2)==="px"&&(t=t.substr(0,t.lengh-2)),t=parseInt(t,10);if(e==="width")this.width=t;else{if(e!=="height")throw"UNSUPPORTED ATTRIBUTE!";this.height=t}},e.prototype.setFontManager=function(e){this.context.setFontManager(e)},e.create=function(t){var n=t.width,r=t.height,i=new e;return i.context=S.create(i,t,n,r),Object.defineProperty?(Object.defineProperty(i,"width",{get:function(){return n},set:function(t){n=t,this.context.setWidth(t),this.clientWidth=t},enumerable:!0,configurable:!1}),Object.defineProperty(i,"height",{get:function(){return r},set:function(t){r=t,this.context.setHeight(t),this.clientHeight=t},enumerable:!0,configurable:!1})):(i.width=n,i.height=r),i.clientWidth=n,i.clientHeight=r,i},e.version=1,e}();(function(){S.prototype.floatArrayConstructor=Array,S.prototype.byteArrayConstructor=Array,S.prototype.shortArrayConstructor=Array;if(typeof Float32Array!="undefined"){var e=Object.prototype.toString.call(new Float32Array(4));e==="[object Float32Array]"&&(S.prototype.floatArrayConstructor=Float32Array)}if(typeof Uint8Array!="undefined"){var e=Object.prototype.toString.call(new Uint8Array(4));e==="[object Uint8Array]"&&(S.prototype.byteArrayConstructor=Uint8Array)}if(typeof Uint16Array!="undefined"){var e=Object.prototype.toString.call(new Uint16Array(4));e==="[object Uint16Array]"&&(S.prototype.shortArrayConstructor=Uint16Array)}})(),TurbulenzEngine.onload=function(){function S(e,t,n){var r=[],i=e-n|0,s=e+t,o=t+n,u=s/t,a=Math.PI/72,f=Math.cos,l=Math.sin;r[0]=[i,0];var c=i,h=0,p,d,v=1;do{var m=v*a,g=u*m;p=s*f(m)-o*f(g),d=s*l(m)-o*l(g);var y=p|0,b=d|0;if(c!==y||h!==b){c=y,h=b,r.push([p,d]);if(y===i&&b===0)break}v+=1}while(v<2e3);return r}function D(){var e=TurbulenzEngine.time,t=e-g;t>.1&&(t=.1);var s,f,l,c,h,p,d,S=!1;TurbulenzEngine.canvas?(s=r.width,f=r.height,S=!0):n.beginFrame()&&(s=n.width,f=n.height,r.width!==s&&(r.width=s),r.height!==f&&(r.height=f),i.beginFrame(),S=!0);if(S){i.fillStyle="#000",i.fillRect(0,0,s,f),u&&(i.save(),a||(a=i.createPattern(u,"repeat")),i.globalAlpha=.5,i.fillStyle=a,i.fillRect(0,0,s,f),i.restore()),i.save(),i.translate(330,70);for(l=0;l<6;l+=1)for(c=0;c<6;c+=1)i.fillStyle="rgb("+Math.floor(255-42.5*l)+","+Math.floor(255-42.5*c)+",0)",i.fillRect(c*25,l*25,25,25);i.restore(),o&&(i.save(),i.translate(50,525),i.drawImage(o,40,0,128,128),i.restore()),i.save(),i.translate(330,320),i.fillStyle="#FD0",i.fillRect(0,0,75,75),i.fillStyle="#6C0",i.fillRect(75,0,75,75),i.fillStyle="#09F",i.fillRect(0,75,75,75),i.fillStyle="#F30",i.fillRect(75,75,75,75),i.fillStyle="#FFF",i.globalAlpha=.2;for(l=0;l<7;l+=1)i.beginPath(),i.arc(75,75,10+10*l,0,Math.PI*2,!0),i.fill();i.restore(),i.save(),i.translate(330,520),i.strokeStyle="#FFF";var x=["round","bevel","miter"],N=["butt","round","square"];i.lineWidth=10;for(l=0;l<x.length;l+=1)i.lineJoin=x[l],i.lineCap=N[l],i.beginPath(),i.moveTo(-5,5+l*40),i.lineTo(35,45+l*40),i.lineTo(75,5+l*40),i.lineTo(115,45+l*40),i.lineTo(155,5+l*40),i.stroke();i.restore();for(l=0;l<3;l+=1)for(c=0;c<3;c+=1){i.save(),i.strokeStyle="#9CFF00",i.translate(50+c*100,50+l*100),h=T[l*3+c],p=h.length,i.beginPath(),d=h[0],i.moveTo(d[0],d[1]);for(var C=1;C<p;C+=1)d=h[C],i.lineTo(d[0],d[1]);i.stroke(),i.restore()}i.save(),i.translate(150,390);for(l=1;l<6;l+=1){i.save(),i.fillStyle="rgb("+51*l+","+(255-51*l)+",255)",i.beginPath();for(c=0;c<l*6;c+=1)i.rotate(Math.PI*2/(l*6)),i.moveTo(0,l*12.5),i.arc(0,l*12.5,5,0,Math.PI*2,!0);i.fill(),i.restore()}i.restore(),i.save(),i.translate(550,70),i.fillStyle=k,i.strokeStyle=L,i.fillRect(10,10,130,130),i.strokeRect(50,50,50,50),i.restore(),i.save(),i.translate(550,320),i.fillStyle=_,i.fillRect(0,0,150,150),i.fillStyle=M,i.fillRect(0,0,150,150),i.fillStyle=O,i.fillRect(0,0,150,150),i.fillStyle=A,i.fillRect(0,0,150,150),i.restore(),p=E.length,d=E[0],i.save(),i.translate(530,490),i.scale(.5,.5),i.beginPath(),i.moveTo(d[0],d[1]);for(l=1;l<p;l+=1)d=E[l],i.lineTo(d[0],d[1]);i.closePath(),i.fillStyle="#00F",i.fill(),i.strokeStyle="#FFF",i.stroke(),i.restore(),i.save(),i.translate(0,100),i.beginPath(),i.strokeStyle="black",i.lineWidth=3,i.moveTo(120,100),i.lineTo(180,100),i.arcTo(200,100,200,80,20),i.lineTo(200,20),i.arcTo(200,0,180,0,20),i.lineTo(120,0),i.arcTo(100,0,100,20,20),i.lineTo(100,80),i.arcTo(100,100,120,100,20),i.stroke(),i.translate(250,80),i.rotate(Math.PI/4),i.beginPath(),i.moveTo(20,0),i.lineTo(80,0),i.arcTo(100,0,100,20,20),i.lineTo(100,80),i.arcTo(100,100,80,100,20),i.lineTo(20,100),i.arcTo(0,100,0,80,20),i.lineTo(0,20),i.arcTo(0,0,20,0,20),i.stroke(),i.restore(),TurbulenzEngine.canvas?(v+=1,e-m>=1&&(b=(v/(e-m)).toFixed(2),v=0,m=e)):(i.endFrame(),n.endFrame(),b=n.fps.toFixed(2))}w!==b&&(w=b,y&&(y.innerHTML=b+" fps")),g=e}if(!TurbulenzEngine.canvas)var t={},n=TurbulenzEngine.createGraphicsDevice(t);var r,i,o,u,a,f={},l=s.create(f),c=function(t){if(TurbulenzEngine.canvas){var r=new Image;r.onload=function(){o=r},r.src=t.getURL("textures/crate.jpg");var i=new Image;i.onload=function(){u=i},i.src=t.getURL("textures/stones.jpg")}else{var s={src:t.getURL("textures/crate.jpg"),mipmaps:!0,onload:function(e){o=e}};n.createTexture(s);var a={src:t.getURL("textures/stones.jpg"),mipmaps:!0,onload:function(e){u=e}};n.createTexture(a)}},h=function(t){d.createMappingTable(l,t,c)},p=d.createGameSession(l,h);if(TurbulenzEngine.canvas){r=TurbulenzEngine.canvas;var v=0,m=0}else r=x.create(n);var i=r.getContext("2d"),g=TurbulenzEngine.time,y=document.getElementById("fpscounter"),b="0",w="0",E=[[204,49],[48,233],[296,328],[261,244],[87,228],[211,206],[170,178],[274,132]],T=[];for(var N=0;N<3;N+=1)for(var C=0;C<3;C+=1)T[N*3+C]=S(20*(C+2)/(C+1),-8*(N+3)/(N+1),10);var k=i.createLinearGradient(0,0,0,150);k.addColorStop(0,"#00ABEB"),k.addColorStop(.5,"#fff"),k.addColorStop(.5,"#26C000"),k.addColorStop(1,"#fff");var L=i.createLinearGradient(0,50,0,95);L.addColorStop(.5,"#000"),L.addColorStop(1,"rgba(0,0,0,0)");var A=i.createRadialGradient(45,45,10,52,50,30);A.addColorStop(0,"#A7D30C"),A.addColorStop(.9,"#019F62"),A.addColorStop(.95,"rgba(1,159,98,0)"),A.addColorStop(1,"rgba(1,159,98,0)");var O=i.createRadialGradient(105,105,20,112,120,50);O.addColorStop(0,"#FF5F98"),O.addColorStop(.75,"#FF0188"),O.addColorStop(.99,"rgba(255,1,136,0)"),O.addColorStop(1,"rgba(255,1,136,0)");var M=i.createRadialGradient(95,15,15,102,20,40);M.addColorStop(0,"#00C9FF"),M.addColorStop(.8,"#00B5E2"),M.addColorStop(.99,"rgba(0,201,255,0)"),M.addColorStop(1,"rgba(0,201,255,0)");var _=i.createRadialGradient(0,150,50,0,140,90);_.addColorStop(0,"#F4F201"),_.addColorStop(.8,"#E4C700"),_.addColorStop(.99,"rgba(228,199,0,0)"),_.addColorStop(1,"rgba(228,199,0,0)");var P=TurbulenzEngine.setInterval(D,1e3/60);TurbulenzEngine.onunload=function(){TurbulenzEngine.clearInterval(P),p&&(p.destroy(),p=null),_=null,M=null,O=null,A=null,L=null,k=null,a=null,u=null,o=null,i=null,r=null,l=null,y=null,TurbulenzEngine.flush(),n=null,TurbulenzEngine.onunload=null}};if(!TurbulenzEngine.onload){window.alert("Entry point 'TurbulenzEngine.onload' must be defined.");return}TurbulenzEngine.onload.call(this)})();