(function(){var e=Array;typeof Float32Array!="undefined"&&Float32Array.prototype!==undefined&&Float32Array.prototype.slice===undefined&&(Float32Array.prototype.slice=function(t,n){var r=this.length;t===undefined?t=0:t<0&&(t+=r),n===undefined?n=r:n<0&&(n+=r),r=n-t;if(0<r){var i=new Float32Array(r),s=0;do i[s]=this[t],s+=1,t+=1;while(t<n);return i}return new Float32Array(0)});var t={version:1,precision:1e-6,FLOAT_MAX:3.402823466e38,select:function(t,n,r){return t?n:r},reciprocal:function(t){if(t!==0)return 1/t;throw"Division by zero"},truncate:function(t){return t|0},v2BuildZero:function(n){return n===undefined&&(n=new e(2)),n[0]=0,n[1]=0,n},v2BuildOne:function(n){return n===undefined&&(n=new e(2)),n[0]=1,n[1]=1,n},v2BuildXAxis:function(n){return n===undefined&&(n=new e(2)),n[0]=1,n[1]=0,n},v2BuildYAxis:function(n){return n===undefined&&(n=new e(2)),n[0]=0,n[1]=1,n},v2Build:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n,i[1]=r,i},v2Copy:function(n,r){return r===undefined&&(r=new e(2)),r[0]=n[0],r[1]=n[1],r},v2Set:function(t,n){t[0]=n[0],t[1]=n[1]},v2Neg:function(n,r){return r===undefined&&(r=new e(2)),r[0]=-n[0],r[1]=-n[1],r},v2Add:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]+r[0],i[1]=n[1]+r[1],i},v2Add3:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s},v2Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(2)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o},v2Sub:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]-r[0],i[1]=n[1]-r[1],i},v2Mul:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i},v2MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s},v2Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},v2PerpDot:function(t,n){return t[0]*n[1]-t[1]*n[0]},v2LengthSq:function(t){var n=t[0],r=t[1];return n*n+r*r},v2Length:function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},v2Reciprocal:function(r,i){i===undefined&&(i=new e(2));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i},v2Normalize:function(n,r){r===undefined&&(r=new e(2));var i=n[0],s=n[1],o=i*i+s*s;if(o>0){var u=1/Math.sqrt(o);r[0]=i*u,r[1]=s*u}else r[0]=0,r[1]=0;return r},v2Abs:function(n,r){r===undefined&&(r=new e(2));var i=Math.abs;return r[0]=i(n[0]),r[1]=i(n[1]),r},v2Max:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.max;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i},v2Min:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.min;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i},v2Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r},v2MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s]},v2MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1]]},v2MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1]]},v2MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1]]},v2MaskNot:function(t){return[!t[0],!t[1]]},v2MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1]]},v2MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1]]},v2Select:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s},v2ScalarBuild:function(n,r){return r===undefined&&(r=new e(2)),r[0]=n,r[1]=n,r},v2ScalarMax:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i},v2ScalarMin:function(n,r,i){i===undefined&&(i=new e(2));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i},v2ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]+r,i[1]=n[1]+r,i},v2ScalarSub:function(n,r,i){return i===undefined&&(i=new e(2)),i[0]=n[0]-r,i[1]=n[1]-r,i},v2ScalarMul:function(n,r,i){return i===undefined&&(i=new e(2)),r===0?(i[0]=0,i[1]=0):(i[0]=n[0]*r,i[1]=n[1]*r),i},v2AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s},v2EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s]},v2LessScalarMask:function(t,n){return[t[0]<n,t[1]<n]},v2GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n]},v2GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n]},v2Lerp:function(n,r,i,s){return s===undefined&&(s=new e(2)),s[0]=n[0]+(r[0]-n[0])*i,s[1]=n[1]+(r[1]-n[1])*i,s},v3BuildZero:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=0,r[2]=0,r},v3BuildOne:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=1,r[1]=1,r[2]=1,r},v3BuildXAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=1,r[1]=0,r[2]=0,r},v3BuildYAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=1,r[2]=0,r},v3BuildZAxis:function(n){var r=n;return r===undefined&&(r=new e(3)),r[0]=0,r[1]=0,r[2]=1,r},v3Build:function(n,r,i,s){var o=s;return o===undefined&&(o=new e(3)),o[0]=n,o[1]=r,o[2]=i,o},v3Copy:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},v3Set:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},v3Neg:function(n,r){return r===undefined&&(r=new e(3)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},v3Add:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0],s[1]=n[1]+r[1],s[2]=n[2]+r[2],s},v3Add3:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s[2]=n[2]+r[2]+i[2],s},v3Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(3)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o[2]=n[2]+r[2]+i[2]+s[2],o},v3Sub:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),s[0]=n[0]-r[0],s[1]=n[1]-r[1],s[2]=n[2]-r[2],s},v3Mul:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i[2]=n[2]*r[2],i},v3MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s[2]=n[2]*r[2]+i[2],s},v3Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},v3Cross:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=n[0],u=n[1],a=n[2],f=r[0],l=r[1],c=r[2];return s[0]=u*c-a*l,s[1]=a*f-o*c,s[2]=o*l-u*f,s},v3LengthSq:function(t){var n=t[0],r=t[1],i=t[2];return n*n+r*r+i*i},v3Length:function(t){var n=t[0],r=t[1],i=t[2];return Math.sqrt(n*n+r*r+i*i)},v3Reciprocal:function(r,i){i===undefined&&(i=new e(3));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i[2]=s(r[2]),i},v3Normalize:function(n,r){var i=r;i===undefined&&(i=new e(3));var s=n[0],o=n[1],u=n[2],a=s*s+o*o+u*u;if(a>0){var f=1/Math.sqrt(a);i[0]=s*f,i[1]=o*f,i[2]=u*f}else i[0]=0,i[1]=0,i[2]=0;return i},v3Abs:function(n,r){var i=r;i===undefined&&(i=new e(3));var s=Math.abs;return i[0]=s(n[0]),i[1]=s(n[1]),i[2]=s(n[2]),i},v3Max:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=Math.max;return s[0]=o(n[0],r[0]),s[1]=o(n[1],r[1]),s[2]=o(n[2],r[2]),s},v3Min:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=Math.min;return s[0]=o(n[0],r[0]),s[1]=o(n[1],r[1]),s[2]=o(n[2],r[2]),s},v3Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r},v3MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s,i(n[2]-r[2])<=s]},v3MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1],t[2]<n[2]]},v3MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1],t[2]>n[2]]},v3MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1],t[2]>=n[2]]},v3MaskNot:function(t){return[!t[0],!t[1],!t[2]]},v3MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1],t[2]||n[2]]},v3MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1],t[2]&&n[2]]},v3Select:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s[2]=n[2]?r[2]:i[2],s},v3ScalarBuild:function(n,r){return r===undefined&&(r=new e(3)),r[0]=n,r[1]=n,r[2]=n,r},v3ScalarMax:function(n,r,i){i===undefined&&(i=new e(3));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i},v3ScalarMin:function(n,r,i){i===undefined&&(i=new e(3));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i},v3ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]+r,i[1]=n[1]+r,i[2]=n[2]+r,i},v3ScalarSub:function(n,r,i){return i===undefined&&(i=new e(3)),i[0]=n[0]-r,i[1]=n[1]-r,i[2]=n[2]-r,i},v3ScalarMul:function(n,r,i){var s=i;return s===undefined&&(s=new e(3)),r===0?(s[0]=0,s[1]=0,s[2]=0):(s[0]=n[0]*r,s[1]=n[1]*r,s[2]=n[2]*r),s},v3AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(3)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s[2]=n[2]+r[2]*i,s},v3EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s,i(n[2]-r)<=s]},v3LessScalarMask:function(t,n){return[t[0]<n,t[1]<n,t[2]<n]},v3GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n,t[2]>n]},v3GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n,t[2]>=n]},v3Lerp:function(n,r,i,s){var o=s;return o===undefined&&(o=new e(3)),o[0]=n[0]+(r[0]-n[0])*i,o[1]=n[1]+(r[1]-n[1])*i,o[2]=n[2]+(r[2]-n[2])*i,o},v4BuildZero:function(n){var r=n;return r===undefined&&(r=new e(4)),r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},v4BuildOne:function(n){var r=n;return r===undefined&&(r=new e(4)),r[0]=1,r[1]=1,r[2]=1,r[3]=1,r},v4Build:function(n,r,i,s,o){var u=o;return u===undefined&&(u=new e(4)),u[0]=n,u[1]=r,u[2]=i,u[3]=s,u},v4Copy:function(n,r){var i=r;return i===undefined&&(i=new e(4)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},v4Set:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]},v4Neg:function(n,r){return r===undefined&&(r=new e(4)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},v4Add:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]+r[0],i[1]=n[1]+r[1],i[2]=n[2]+r[2],i[3]=n[3]+r[3],i},v4Add3:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+r[0]+i[0],s[1]=n[1]+r[1]+i[1],s[2]=n[2]+r[2]+i[2],s[3]=n[3]+r[3]+i[3],s},v4Add4:function(n,r,i,s,o){return o===undefined&&(o=new e(4)),o[0]=n[0]+r[0]+i[0]+s[0],o[1]=n[1]+r[1]+i[1]+s[1],o[2]=n[2]+r[2]+i[2]+s[2],o[3]=n[3]+r[3]+i[3]+s[3],o},v4Sub:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]-r[0],i[1]=n[1]-r[1],i[2]=n[2]-r[2],i[3]=n[3]-r[3],i},v4Mul:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]*r[0],i[1]=n[1]*r[1],i[2]=n[2]*r[2],i[3]=n[3]*r[3],i},v4MulAdd:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]*r[0]+i[0],s[1]=n[1]*r[1]+i[1],s[2]=n[2]*r[2]+i[2],s[3]=n[3]*r[3]+i[3],s},v4Dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},v4LengthSq:function(t){var n=t[0],r=t[1],i=t[2],s=t[3];return n*n+r*r+i*i+s*s},v4Length:function(t){var n=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(n*n+r*r+i*i+s*s)},v4Reciprocal:function(r,i){i===undefined&&(i=new e(4));var s=t.reciprocal;return i[0]=s(r[0]),i[1]=s(r[1]),i[2]=s(r[2]),i[3]=s(r[3]),i},v4Normalize:function(n,r){r===undefined&&(r=new e(4));var i=n[0],s=n[1],o=n[2],u=n[3],a=i*i+s*s+o*o+u*u;if(a>0){var f=1/Math.sqrt(a);r[0]=i*f,r[1]=s*f,r[2]=o*f,r[3]=u*f}else r[0]=0,r[1]=0,r[2]=0,r[3]=0;return r},v4Abs:function(n,r){r===undefined&&(r=new e(4));var i=Math.abs;return r[0]=i(n[0]),r[1]=i(n[1]),r[2]=i(n[2]),r[3]=i(n[3]),r},v4Max:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.max;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i[2]=s(n[2],r[2]),i[3]=s(n[3],r[3]),i},v4Min:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.min;return i[0]=s(n[0],r[0]),i[1]=s(n[1],r[1]),i[2]=s(n[2],r[2]),i[3]=s(n[3],r[3]),i},v4Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r},v4MaskEqual:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r[0])<=s,i(n[1]-r[1])<=s,i(n[2]-r[2])<=s,i(n[3]-r[3])<=s]},v4MaskLess:function(t,n){return[t[0]<n[0],t[1]<n[1],t[2]<n[2],t[3]<n[3]]},v4MaskGreater:function(t,n){return[t[0]>n[0],t[1]>n[1],t[2]>n[2],t[3]>n[3]]},v4MaskGreaterEq:function(t,n){return[t[0]>=n[0],t[1]>=n[1],t[2]>=n[2],t[3]>=n[3]]},v4MaskNot:function(t){return[!t[0],!t[1],!t[2],!t[3]]},v4MaskOr:function(t,n){return[t[0]||n[0],t[1]||n[1],t[2]||n[2],t[3]||n[3]]},v4MaskAnd:function(t,n){return[t[0]&&n[0],t[1]&&n[1],t[2]&&n[2],t[3]&&n[3]]},v4Many:function(t){return t[0]||t[1]||t[2]||t[3]},v4MaskAll:function(t){return t[0]&&t[1]&&t[2]&&t[3]},v4Select:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]?r[0]:i[0],s[1]=n[1]?r[1]:i[1],s[2]=n[2]?r[2]:i[2],s[3]=n[3]?r[3]:i[3],s},v4ScalarBuild:function(n,r){return r===undefined&&(r=new e(4)),r[0]=n,r[1]=n,r[2]=n,r[3]=n,r},v4ScalarMax:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.max;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i[3]=s(n[3],r),i},v4ScalarMin:function(n,r,i){i===undefined&&(i=new e(4));var s=Math.min;return i[0]=s(n[0],r),i[1]=s(n[1],r),i[2]=s(n[2],r),i[3]=s(n[3],r),i},v4ScalarAdd:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]+r,i[1]=n[1]+r,i[2]=n[2]+r,i[3]=n[3]+r,i},v4ScalarSub:function(n,r,i){return i===undefined&&(i=new e(4)),i[0]=n[0]-r,i[1]=n[1]-r,i[2]=n[2]-r,i[3]=n[3]-r,i},v4ScalarMul:function(r,i,s){return i===0?t.v4BuildZero(s):(s===undefined&&(s=new e(4)),s[0]=r[0]*i,s[1]=r[1]*i,s[2]=r[2]*i,s[3]=r[3]*i,s)},v4AddScalarMul:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+r[0]*i,s[1]=n[1]+r[1]*i,s[2]=n[2]+r[2]*i,s[3]=n[3]+r[3]*i,s},v4ScalarEqual:function(n,r){var i=Math.abs,s=t.precision;return i(n[0]-r)<=s&&i(n[1]-r)<=s&&i(n[2]-r)<=s&&i(n[3]-r)<=s},v4EqualScalarMask:function(n,r){var i=Math.abs,s=t.precision;return[i(n[0]-r)<=s,i(n[1]-r)<=s,i(n[2]-r)<=s,i(n[3]-r)<=s]},v4LessScalarMask:function(t,n){return[t[0]<n,t[1]<n,t[2]<n,t[3]<n]},v4GreaterScalarMask:function(t,n){return[t[0]>n,t[1]>n,t[2]>n,t[3]>n]},v4GreaterEqScalarMask:function(t,n){return[t[0]>=n,t[1]>=n,t[2]>=n,t[3]>=n]},v4Lerp:function(n,r,i,s){return s===undefined&&(s=new e(4)),s[0]=n[0]+(r[0]-n[0])*i,s[1]=n[1]+(r[1]-n[1])*i,s[2]=n[2]+(r[2]-n[2])*i,s[3]=n[3]+(r[3]-n[3])*i,s},aabbBuild:function(n,r,i,s,o,u,a){var f=a;return f===undefined&&(f=new e(6)),f[0]=n,f[1]=r,f[2]=i,f[3]=s,f[4]=o,f[5]=u,f},aabbBuildEmpty:function(n){var r=this.FLOAT_MAX,i=n;return i===undefined&&(i=new e(6)),i[0]=r,i[1]=r,i[2]=r,i[3]=-r,i[4]=-r,i[5]=-r,i},aabbCopy:function(n,r){var i=r;return i===undefined&&(i=new e(6)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},aabbSet:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5]},aabbIsEmpty:function(t){return t[0]>t[3]},aabbMin:function(t,n){return n===undefined?t.slice(0,3):(n[0]=t[0],n[1]=t[1],n[2]=t[2],n)},aabbMax:function(t,n){return n===undefined?t.slice(3,6):(n[0]=t[3],n[1]=t[4],n[2]=t[5],n)},aabbGetCenterAndHalf:function(t,n,r){var i=(t[0]+t[3])*.5,s=(t[1]+t[4])*.5,o=(t[2]+t[5])*.5;n[0]=i,n[1]=s,n[2]=o,r[0]=t[3]-i,r[1]=t[4]-s,r[2]=t[5]-o},aabbIsInsidePlanes:function(t,n){var r=n.length,i=0;do{var s=n[i],o=s[0],u=s[1],a=s[2],f=o*(o<0?t[0]:t[3])+u*(u<0?t[1]:t[4])+a*(a<0?t[2]:t[5]);if(f<s[3])return!1;i+=1}while(i<r);return!0},aabbIsFullyInsidePlanes:function(t,n){var r=n.length,i=0;do{var s=n[i],o=s[0],u=s[1],a=s[2],f=o*(o>0?t[0]:t[3])+u*(u>0?t[1]:t[4])+a*(a>0?t[2]:t[5]);if(f<s[3])return!1;i+=1}while(i<r);return!0},aabbUnion:function(n,r,i){return i===undefined&&(i=new e(6)),i[0]=n[0]<r[0]?n[0]:r[0],i[1]=n[1]<r[1]?n[1]:r[1],i[2]=n[2]<r[2]?n[2]:r[2],i[3]=n[3]>r[3]?n[3]:r[3],i[4]=n[4]>r[4]?n[4]:r[4],i[5]=n[5]>r[5]?n[5]:r[5],i},aabbUnionArray:function(r,i){i===undefined&&(i=new e(6)),t.aabbCopy(r[0],i);var s=r.length;for(var o=1;o<s;o+=1){var u=r[o];i[0]=i[0]<u[0]?i[0]:u[0],i[1]=i[1]<u[1]?i[1]:u[1],i[2]=i[2]<u[2]?i[2]:u[2],i[3]=i[3]>u[3]?i[3]:u[3],i[4]=i[4]>u[4]?i[4]:u[4],i[5]=i[5]>u[5]?i[5]:u[5]}return i},aabbAddPoints:function(t,n){var r,i=n.length,s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c,h,p,d;for(r=0;r<i;r+=1)c=n[r],h=c[0],p=c[1],d=c[2],s=s<h?s:h,o=o<p?o:p,u=u<d?u:d,a=a>h?a:h,f=f>p?f:p,l=l>d?l:d;t[0]=s,t[1]=o,t[2]=u,t[3]=a,t[4]=f,t[5]=l},aabbTransform:function(n,r,i){i===undefined&&(i=new e(6));var s=(n[0]+n[3])*.5,o=(n[1]+n[4])*.5,u=(n[2]+n[5])*.5,a=n[3]-s,f=n[4]-o,l=n[5]-u,c=r[0],h=r[1],p=r[2],d=r[3],v=r[4],m=r[5],g=r[6],y=r[7],b=r[8],w=r[9]+(c*s+d*o+g*u),E=r[10]+(h*s+v*o+y*u),S=r[11]+(p*s+m*o+b*u),x=Math.abs,T=x(c)*a+x(d)*f+x(g)*l,N=x(h)*a+x(v)*f+x(y)*l,C=x(p)*a+x(m)*f+x(b)*l;return i[0]=w-T,i[1]=E-N,i[2]=S-C,i[3]=w+T,i[4]=E+N,i[5]=S+C,i},aabbIntercept:function(n,r,i){return i===undefined&&(i=new e(6)),i[0]=n[0]>r[0]?n[0]:r[0],i[1]=n[1]>r[1]?n[1]:r[1],i[2]=n[2]>r[2]?n[2]:r[2],i[3]=n[3]<r[3]?n[3]:r[3],i[4]=n[4]<r[4]?n[4]:r[4],i[5]=n[5]<r[5]?n[5]:r[5],i},aabbOverlaps:function(t,n){return t[0]<=n[3]&&t[1]<=n[4]&&t[2]<=n[5]&&t[3]>=n[0]&&t[4]>=n[1]&&t[5]>=n[2]},aabbSphereOverlaps:function(t,n,r){var i=n[0],s=n[1],o=n[2],u=r*r,a=t[0],f=t[1],l=t[2],c=t[3],h=t[4],p=t[5],d=0,v;return i<a?(v=a-i,d+=v*v):i>c&&(v=i-c,d+=v*v),s<f?(v=f-s,d+=v*v):s>h&&(v=s-h,d+=v*v),o<l?(v=l-o,d+=v*v):o>p&&(v=o-p,d+=v*v),d<=u},aabbIsInside:function(t,n){return t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[3]<=n[3]&&t[4]<=n[4]&&t[5]<=n[5]},aabbTestInside:function(t,n){return t[0]<=n[3]&&t[1]<=n[4]&&t[2]<=n[5]&&t[3]>=n[0]&&t[4]>=n[1]&&t[5]>=n[2]?t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[3]<=n[3]&&t[4]<=n[4]&&t[5]<=n[5]?2:1:0},m33BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(9)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},m33Build:function(n,r,i,s){var o,u=arguments.length;return u>=9?(u>9?(o=arguments[9],o===undefined&&(o=new e(9))):o=new e(9),o[0]=arguments[0],o[1]=arguments[1],o[2]=arguments[2],o[3]=arguments[3],o[4]=arguments[4],o[5]=arguments[5],o[6]=arguments[6],o[7]=arguments[7],o[8]=arguments[8]):(o=s,o===undefined&&(o=new e(9)),o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=r[0],o[4]=r[1],o[5]=r[2],o[6]=i[0],o[7]=i[1],o[8]=i[2]),o},m33Copy:function(n,r){var i=r;return i===undefined&&(i=new e(9)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},m33FromAxisRotation:function(n,r,i){var s=i;s===undefined&&(s=new e(9));var o=Math.sin(r),u=Math.cos(r),a=1-u,f=n[0],l=n[1],c=n[2],h=a*f,p=a*l,d=a*c,v=o*f,m=o*l,g=o*c;return s[0]=h*f+u,s[1]=h*l-g,s[2]=h*c+m,s[3]=p*f+g,s[4]=p*l+u,s[5]=p*c-v,s[6]=d*f-m,s[7]=d*l+v,s[8]=d*c+u,s},m33FromQuat:function(n,r){var i=r;i===undefined&&(i=new e(9));var s=n[0],o=n[1],u=n[2],a=n[3],f=2*s*s,l=2*o*o,c=2*u*u,h=2*s*o,p=2*u*a,d=2*s*u,v=2*o*a,m=2*o*u,g=2*s*a;return i[0]=1-l-c,i[1]=h-p,i[2]=d+v,i[3]=h+p,i[4]=1-f-c,i[5]=m-g,i[6]=d-v,i[7]=m+g,i[8]=1-f-l,i},m33Right:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},m33Up:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[3],i[1]=n[4],i[2]=n[5],i},m33At:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[6],i[1]=n[7],i[2]=n[8],i},m33SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},m33SetUp:function(t,n){t[3]=n[0],t[4]=n[1],t[5]=n[2]},m33SetAt:function(t,n){t[6]=n[0],t[7]=n[1],t[8]=n[2]},m33Transpose:function(n,r){r===undefined&&(r=new e(9));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8];return r[0]=i,r[1]=u,r[2]=l,r[3]=s,r[4]=a,r[5]=c,r[6]=o,r[7]=f,r[8]=h,r},m33Determinant:function(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return n*(o*l-u*f)+r*(u*a-s*l)+i*(s*f-o*a)},m33Inverse:function(n,r){r===undefined&&(r=new e(9));var i=h*m-p*v,s=p*d-c*m,o=c*v-h*d,u=a*i+f*s+l*o;if(u===0)return r[0]=r[1]=r[2]=0,r[3]=r[4]=r[5]=0,r[6]=r[7]=r[8]=0,r;var a=n[0],f=n[1],l=n[2],c=n[3],h=n[4],p=n[5],d=n[6],v=n[7],m=n[8],g=1/u;return r[0]=i*g,r[1]=(v*l-m*f)*g,r[2]=(f*p-l*h)*g,r[3]=s*g,r[4]=(m*a-d*l)*g,r[5]=(c*l-a*p)*g,r[6]=o*g,r[7]=(d*f-v*a)*g,r[8]=(a*h-c*f)*g,r},m33InverseTranspose:function(n,r){var i=r;i===undefined&&(i=new e(9));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=f*p-l*h,v=l*c-a*p,m=a*h-f*c,g=s*d+o*v+u*m;if(g===0)i[0]=i[1]=i[2]=0,i[3]=i[4]=i[5]=0,i[6]=i[7]=i[8]=0;else{var y=1/g;i[0]=d*y,i[3]=(h*u-p*o)*y,i[6]=(o*l-u*f)*y,i[1]=v*y,i[4]=(p*s-c*u)*y,i[7]=(a*u-s*l)*y,i[2]=m*y,i[5]=(c*o-h*s)*y,i[8]=(s*f-a*o)*y}return i},m33Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8];return i===undefined&&(i=new e(9)),i[0]=d*s+g*o+w*u,i[1]=v*s+y*o+E*u,i[2]=m*s+b*o+S*u,i[3]=d*a+g*f+w*l,i[4]=v*a+y*f+E*l,i[5]=m*a+b*f+S*l,i[6]=d*c+g*h+w*p,i[7]=v*c+y*h+E*p,i[8]=m*c+b*h+S*p,i},m33Transform:function(n,r,i){i===undefined&&(i=new e(3));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s+n[3]*o+n[6]*u,i[1]=n[1]*s+n[4]*o+n[7]*u,i[2]=n[2]*s+n[5]*o+n[8]*u,i},m33Equal:function(t,n,r){var i=Math.abs;return r===undefined&&(r=this.precision),i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r&&i(t[4]-n[4])<=r&&i(t[5]-n[5])<=r&&i(t[6]-n[6])<=r&&i(t[7]-n[7])<=r&&i(t[8]-n[8])<=r},m33MulM43:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8];return i[0]=d*s+g*o+w*u,i[1]=v*s+y*o+E*u,i[2]=m*s+b*o+S*u,i[3]=d*a+g*f+w*l,i[4]=v*a+y*f+E*l,i[5]=m*a+b*f+S*l,i[6]=d*c+g*h+w*p,i[7]=v*c+y*h+E*p,i[8]=m*c+b*h+S*p,i[9]=r[9],i[10]=r[10],i[11]=r[11],i},m33MulM44:function(n,r,i){i===undefined&&(i=new e(16));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=r[0],v=r[1],m=r[2],g=r[3],y=r[4],b=r[5],w=r[6],E=r[7],S=r[8],x=r[9],T=r[10],N=r[11];return i[0]=d*s+y*o+S*u,i[1]=v*s+b*o+x*u,i[2]=m*s+w*o+T*u,i[3]=g*s+E*o+N*u,i[4]=d*a+y*f+S*l,i[5]=v*a+b*f+x*l,i[6]=m*a+w*f+T*l,i[7]=g*a+E*f+N*l,i[8]=d*c+y*h+S*p,i[9]=v*c+b*h+x*p,i[10]=m*c+w*h+T*p,i[11]=g*c+E*h+N*p,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i},m33ScalarAdd:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]+r;return i},m33ScalarSub:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]-r;return i},m33ScalarMul:function(n,r,i){i===undefined&&(i=new e(9));for(var s=0;s<9;s+=1)i[s]=n[s]*r;return i},m34BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(12)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r},m34Pos:function(n,r){return r===undefined&&(r=new e(3)),r[0]=n[3],r[1]=n[7],r[2]=n[11],r},m34Scale:function(n,r,i){i===undefined&&(i=new e(12));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3],i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7],i[8]=n[8]*u,i[9]=n[9]*u,i[10]=n[10]*u,i[11]=n[11],i},m43BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(12)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r[9]=0,r[10]=0,r[11]=0,r},m43Build:function(n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m=arguments.length;return m>=12?(m>12?(v=arguments[12],v===undefined&&(v=new e(12))):v=new e(12),v[0]=arguments[0],v[1]=arguments[1],v[2]=arguments[2],v[3]=arguments[3],v[4]=arguments[4],v[5]=arguments[5],v[6]=arguments[6],v[7]=arguments[7],v[8]=arguments[8],v[9]=arguments[9],v[10]=arguments[10],v[11]=arguments[11]):(v=o,v===undefined&&(v=new e(12)),v[0]=n[0],v[1]=n[1],v[2]=n[2],v[3]=r[0],v[4]=r[1],v[5]=r[2],v[6]=i[0],v[7]=i[1],v[8]=i[2],v[9]=s[0],v[10]=s[1],v[11]=s[2]),v},m43BuildTranslation:function(n,r,i,s){var o;return 3<=arguments.length?(o=s,o===undefined&&(o=new e(12)),o[9]=n,o[10]=r,o[11]=i):(o=r,o===undefined&&(o=new e(12)),o[9]=n[0],o[10]=n[1],o[11]=n[2]),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},m43Copy:function(n,r){var i=r;return i===undefined&&(i=new e(12)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i},m43FromM33V3:function(n,r,i){var s=i;return s===undefined&&(s=new e(12)),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=r[0],s[10]=r[1],s[11]=r[2],s},m43FromAxisRotation:function(n,r,i){var s=Math.sin(r),o=Math.cos(r),u=1-o,a=n[0],f=n[1],l=n[2],c=u*a,h=u*f,p=u*l,d=s*a,v=s*f,m=s*l,g=i;return g===undefined&&(g=new e(12)),g[0]=c*a+o,g[1]=c*f-m,g[2]=c*l+v,g[3]=h*a+m,g[4]=h*f+o,g[5]=h*l-d,g[6]=p*a-v,g[7]=p*f+d,g[8]=p*l+o,g[9]=0,g[10]=0,g[11]=0,g},m43FromQuatPos:function(n,r){var i=r;i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=2*s*s,p=2*o*o,d=2*u*u,v=2*s*o,m=2*u*a,g=2*s*u,y=2*o*a,b=2*o*u,w=2*s*a;return i[0]=1-p-d,i[1]=v-m,i[2]=g+y,i[3]=v+m,i[4]=1-h-d,i[5]=b-w,i[6]=g-y,i[7]=b+w,i[8]=1-h-p,i[9]=f,i[10]=l,i[11]=c,i},m43FromRTS:function(n,r,i,s){var o=n[0],u=n[1],a=n[2],f=n[3],l=2*o*o,c=2*u*u,h=2*a*a,p=2*o*u,d=2*a*f,v=2*o*a,m=2*u*f,g=2*u*a,y=2*o*f,b=i[0],w=i[1],E=i[2],S=s;return S===undefined&&(S=new e(12)),S[0]=b*(1-c-h),S[1]=b*(p-d),S[2]=b*(v+m),S[3]=w*(p+d),S[4]=w*(1-l-h),S[5]=w*(g-y),S[6]=E*(v-m),S[7]=E*(g+y),S[8]=E*(1-l-c),S[9]=r[0],S[10]=r[1],S[11]=r[2],S},m43FromRT:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=2*s*s,l=2*o*o,c=2*u*u,h=2*s*o,p=2*u*a,d=2*s*u,v=2*o*a,m=2*o*u,g=2*s*a,y=i;return y===undefined&&(y=new e(12)),y[0]=1-l-c,y[1]=h-p,y[2]=d+v,y[3]=h+p,y[4]=1-f-c,y[5]=m-g,y[6]=d-v,y[7]=m+g,y[8]=1-f-l,y[9]=r[0],y[10]=r[1],y[11]=r[2],y},m43Right:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i},m43Up:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[3],i[1]=n[4],i[2]=n[5],i},m43At:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[6],i[1]=n[7],i[2]=n[8],i},m43Pos:function(n,r){var i=r;return i===undefined&&(i=new e(3)),i[0]=n[9],i[1]=n[10],i[2]=n[11],i},m43SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2]},m43SetUp:function(t,n){t[3]=n[0],t[4]=n[1],t[5]=n[2]},m43SetAt:function(t,n){t[6]=n[0],t[7]=n[1],t[8]=n[2]},m43SetPos:function(t,n){t[9]=n[0],t[10]=n[1],t[11]=n[2]},m43SetAxisRotation:function(t,n,r){var i=Math.sin(r),s=Math.cos(r),o=1-s,u=n[0],a=n[1],f=n[2],l=o*u,c=o*a,h=o*f,p=i*u,d=i*a,v=i*f;t[0]=l*u+s,t[1]=l*a-v,t[2]=l*f+d,t[3]=c*u+v,t[4]=c*a+s,t[5]=c*f-p,t[6]=h*u-d,t[7]=h*a+p,t[8]=h*f+s},m43InverseOrthonormal:function(n,r){r===undefined&&(r=new e(12));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11];return r[0]=i,r[1]=u,r[2]=l,r[3]=s,r[4]=a,r[5]=c,r[6]=o,r[7]=f,r[8]=h,r[9]=-(p*i+d*s+v*o),r[10]=-(p*u+d*a+v*f),r[11]=-(p*l+d*c+v*h),r},m43Orthonormalize:function(r,i){var s=t.v3Normalize,o=t.v3Length,u=t.v3Dot,a=t.v3Cross,f=Math.abs,l=t.m43Right(r),c=t.m43Up(r),h=t.m43At(r),p=t.m43Pos(r),d=o(l),v=o(c),m=o(h);s(l,l),s(c,c),s(h,h);var g,y,b;if(d>0)if(v>0)if(m>0){var w=f(u(c,h)),E=f(u(h,l)),S=f(u(l,c));w<E?w<S?(g=c,y=h,b=l):(g=l,y=c,b=h):E<S?(g=h,y=l,b=c):(g=l,y=c,b=h)}else g=l,y=c,b=h;else g=h,y=l,b=c;else g=c,y=h,b=l;return a(g,y,b),s(b,b),a(b,g,y),s(y,y),i===undefined&&(i=new e(12)),i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=c[0],i[4]=c[1],i[5]=c[2],i[6]=h[0],i[7]=h[1],i[8]=h[2],i[9]=p[0],i[10]=p[1],i[11]=p[2],i},m43Determinant:function(t){return t[0]*(t[4]*t[8]-t[5]*t[7])+t[1]*(t[5]*t[6]-t[3]*t[8])+t[2]*(t[3]*t[7]-t[4]*t[6])},m43Inverse:function(n,r){r===undefined&&(r=new e(12));var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=a*h-f*c,g=f*l-u*h,y=u*c-a*l,b=i*m+s*g+o*y;if(b===0)return r;r===undefined&&(r=new e(12));var w=1/b;return r[0]=m*w,r[1]=(c*o-h*s)*w,r[2]=(s*f-o*a)*w,r[3]=g*w,r[4]=(h*i-l*o)*w,r[5]=(u*o-i*f)*w,r[6]=y*w,r[7]=(l*s-c*i)*w,r[8]=(i*a-u*s)*w,r[9]=(u*(d*h-c*v)+a*(l*v-p*h)+f*(p*c-l*d))*w,r[10]=(l*(o*d-s*v)+c*(i*v-p*o)+h*(p*s-i*d))*w,r[11]=(p*(o*a-s*f)+d*(i*f-u*o)+v*(u*s-i*a))*w,r},m43Translate:function(t,n){t[9]+=n[0],t[10]+=n[1],t[11]+=n[2]},m43Scale:function(n,r,i){i===undefined&&(i=new e(12));var s=r[0],o=r[1],u=r[2];return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*u,i[7]=n[7]*u,i[8]=n[8]*u,i[9]=n[9],i[10]=n[10],i[11]=n[11],i},m43TransformVector:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=r[0],u=r[1],a=r[2];return s[0]=n[0]*o+n[3]*u+n[6]*a,s[1]=n[1]*o+n[4]*u+n[7]*a,s[2]=n[2]*o+n[5]*u+n[8]*a,s},m43TransformPoint:function(n,r,i){var s=i;s===undefined&&(s=new e(3));var o=r[0],u=r[1],a=r[2];return s[0]=n[0]*o+n[3]*u+n[6]*a+n[9],s[1]=n[1]*o+n[4]*u+n[7]*a+n[10],s[2]=n[2]*o+n[5]*u+n[8]*a+n[11],s},m43Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=i;return C===undefined&&(C=new e(12)),C[0]=g*s+w*o+x*u,C[1]=y*s+E*o+T*u,C[2]=b*s+S*o+N*u,C[3]=g*a+w*f+x*l,C[4]=y*a+E*f+T*l,C[5]=b*a+S*f+N*l,C[6]=g*c+w*h+x*p,C[7]=y*c+E*h+T*p,C[8]=b*c+S*h+N*p,C[9]=g*d+w*v+x*m+r[9],C[10]=y*d+E*v+T*m+r[10],C[11]=b*d+S*v+N*m+r[11],C},m43MulM44:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=r[9],k=r[10],L=r[11],A=i;return A===undefined&&(A=new e(16)),A[0]=g*s+E*o+N*u,A[1]=y*s+S*o+C*u,A[2]=b*s+x*o+k*u,A[3]=w*s+T*o+L*u,A[4]=g*a+E*f+N*l,A[5]=y*a+S*f+C*l,A[6]=b*a+x*f+k*l,A[7]=w*a+T*f+L*l,A[8]=g*c+E*h+N*p,A[9]=y*c+S*h+C*p,A[10]=b*c+x*h+k*p,A[11]=w*c+T*h+L*p,A[12]=g*d+E*v+N*m+r[12],A[13]=y*d+S*v+C*m+r[13],A[14]=b*d+x*v+k*m+r[14],A[15]=w*d+T*v+L*m+r[15],A},m43Transpose:function(n,r){var i=r;i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11];return i[0]=s,i[1]=a,i[2]=c,i[3]=d,i[4]=o,i[5]=f,i[6]=h,i[7]=v,i[8]=u,i[9]=l,i[10]=p,i[11]=m,i},m43MulTranspose:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2],w=r[3],E=r[4],S=r[5],x=r[6],T=r[7],N=r[8],C=r[9],k=r[10],L=r[11],A=i;return A===undefined&&(A=new e(12)),A[0]=g*s+w*o+x*u,A[1]=g*a+w*f+x*l,A[2]=g*c+w*h+x*p,A[3]=g*d+w*v+x*m+C,A[4]=y*s+E*o+T*u,A[5]=y*a+E*f+T*l,A[6]=y*c+E*h+T*p,A[7]=y*d+E*v+T*m+k,A[8]=b*s+S*o+N*u,A[9]=b*a+S*f+N*l,A[10]=b*c+S*h+N*p,A[11]=b*d+S*v+N*m+L,A},m43Offset:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=r[0],y=r[1],b=r[2];return i[0]=s,i[1]=o,i[2]=u,i[3]=a,i[4]=f,i[5]=l,i[6]=c,i[7]=h,i[8]=p,i[9]=s*g+a*y+c*b+d,i[10]=o*g+f*y+h*b+v,i[11]=u*g+l*y+p*b+m,i},m43NegOffset:function(n,r,i){i===undefined&&(i=new e(12));var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=-r[0],y=-r[1],b=-r[2];return i[0]=s,i[1]=o,i[2]=u,i[3]=a,i[4]=f,i[5]=l,i[6]=c,i[7]=h,i[8]=p,i[9]=s*g+a*y+c*b+d,i[10]=o*g+f*y+h*b+v,i[11]=u*g+l*y+p*b+m,i},m43InverseTransposeProjection:function(n,r,i){i===undefined&&(i=new e(12));var s=.5/r[0],o=.5/r[1],u=.5/r[2],a=n[0]*s,f=n[1]*s,l=n[2]*s,c=n[3]*o,h=n[4]*o,p=n[5]*o,d=n[6]*u,v=n[7]*u,m=n[8]*u,g=n[9],y=n[10],b=n[11];return i[0]=a,i[1]=f,i[2]=l,i[3]=.5-(g*a+y*f+b*l),i[4]=c,i[5]=h,i[6]=p,i[7]=.5-(g*c+y*h+b*p),i[8]=d,i[9]=v,i[10]=m,i[11]=.5-(g*d+y*v+b*m),i},m43ScalarAdd:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]+r;return i},m43ScalarSub:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]-r;return i},m43ScalarMul:function(n,r,i){i===undefined&&(i=new e(12));for(var s=0;s<12;s+=1)i[s]=n[s]*r;return i},m44BuildIdentity:function(n){var r=n;return r===undefined&&(r=new e(16)),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},m44Build:function(n,r,i,s,o){var u,a=arguments.length;return a>=16?(a>16?(u=arguments[16],u===undefined&&(u=new e(16))):u=new e(16),u[0]=arguments[0],u[1]=arguments[1],u[2]=arguments[2],u[3]=arguments[3],u[4]=arguments[4],u[5]=arguments[5],u[6]=arguments[6],u[7]=arguments[7],u[8]=arguments[8],u[9]=arguments[9],u[10]=arguments[10],u[11]=arguments[11],u[12]=arguments[12],u[13]=arguments[13],u[14]=arguments[14],u[15]=arguments[15]):(u=o,u===undefined&&(u=new e(16)),u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3],u[4]=r[0],u[5]=r[1],u[6]=r[2],u[7]=r[3],u[8]=i[0],u[9]=i[1],u[10]=i[2],u[11]=i[3],u[12]=s[0],u[13]=s[1],u[14]=s[2],u[15]=s[3]),u},m44Copy:function(n,r){return r===undefined&&(r=new e(16)),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},m44Right:function(t,n){return n===undefined?t.slice(0,4):(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n)},m44Up:function(t,n){return n===undefined?t.slice(4,8):(n[0]=t[4],n[1]=t[5],n[2]=t[6],n[3]=t[7],n)},m44At:function(t,n){return n===undefined?t.slice(8,12):(n[0]=t[8],n[1]=t[9],n[2]=t[10],n[3]=t[11],n)},m44Pos:function(t,n){return n===undefined?t.slice(12):(n[0]=t[12],n[1]=t[13],n[2]=t[14],n[3]=t[15],n)},m44SetRight:function(t,n){t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]},m44SetUp:function(t,n){t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3]},m44SetAt:function(t,n){t[8]=n[0],t[9]=n[1],t[10]=n[2],t[11]=n[3]},m44SetPos:function(t,n){t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=n[3]},m44Translate:function(t,n){t[12]+=n[0],t[13]+=n[1],t[14]+=n[2],t[15]+=n[3]},m44Scale:function(n,r,i){return i===undefined&&(i=new e(16)),i[0]=n[0]*r[0],i[1]=n[1]*r[0],i[2]=n[2]*r[0],i[3]=n[3],i[4]=n[4]*r[1],i[5]=n[5]*r[1],i[6]=n[6]*r[1],i[7]=n[7],i[8]=n[8]*r[2],i[9]=n[9]*r[2],i[10]=n[10]*r[2],i[11]=n[11],i
[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},m44Transform:function(n,r,i){var s=r[0],o=r[1],u=r[2],a=r[3];return i===undefined&&(i=new e(4)),a!==1?(i[0]=n[0]*s+n[4]*o+n[8]*u+n[12]*a,i[1]=n[1]*s+n[5]*o+n[9]*u+n[13]*a,i[2]=n[2]*s+n[6]*o+n[10]*u+n[14]*a,i[3]=n[3]*s+n[7]*o+n[11]*u+n[15]*a):(i[0]=n[0]*s+n[4]*o+n[8]*u+n[12],i[1]=n[1]*s+n[5]*o+n[9]*u+n[13],i[2]=n[2]*s+n[6]*o+n[10]*u+n[14],i[3]=n[3]*s+n[7]*o+n[11]*u+n[15]),i},m44Mul:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=n[12],y=n[13],b=n[14],w=n[15],E=r[0],S=r[1],x=r[2],T=r[3],N=r[4],C=r[5],k=r[6],L=r[7],A=r[8],O=r[9],M=r[10],_=r[11],D=r[12],P=r[13],H=r[14],B=r[15];return i===undefined&&(i=new e(16)),i[0]=E*s+N*o+A*u+D*a,i[1]=S*s+C*o+O*u+P*a,i[2]=x*s+k*o+M*u+H*a,i[3]=T*s+L*o+_*u+B*a,i[4]=E*f+N*l+A*c+D*h,i[5]=S*f+C*l+O*c+P*h,i[6]=x*f+k*l+M*c+H*h,i[7]=T*f+L*l+_*c+B*h,i[8]=E*p+N*d+A*v+D*m,i[9]=S*p+C*d+O*v+P*m,i[10]=x*p+k*d+M*v+H*m,i[11]=T*p+L*d+_*v+B*m,i[12]=E*g+N*y+A*b+D*w,i[13]=S*g+C*y+O*b+P*w,i[14]=x*g+k*y+M*b+H*w,i[15]=T*g+L*y+_*b+B*w,i},m44Inverse:function(n,r){var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=n[12],g=n[13],y=n[14],b=n[15];r===undefined&&(r=new e(16));var w=i*f-s*a,E=i*l-o*a,S=i*c-u*a,x=s*l-o*f,T=s*c-u*f,N=o*c-u*l,C=h*g-p*m,k=h*y-d*m,L=h*b-v*m,A=p*y-d*g,O=p*b-v*g,M=d*b-v*y,_=w*M-E*O+S*A+x*L-T*k+N*C;if(_===0)r[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=0;else{var D=1/_;r[0]=(+(f*M)-l*O+c*A)*D,r[4]=(-(a*M)+l*L-c*k)*D,r[8]=(+(a*O)-f*L+c*C)*D,r[12]=(-(a*A)+f*k-l*C)*D,r[1]=(-(s*M)+o*O-u*A)*D,r[5]=(+(i*M)-o*L+u*k)*D,r[9]=(-(i*O)+s*L-u*C)*D,r[13]=(+(i*A)-s*k+o*C)*D,r[2]=(+(g*N)-y*T+b*x)*D,r[6]=(-(m*N)+y*S-b*E)*D,r[10]=(+(m*T)-g*S+b*w)*D,r[14]=(-(m*x)+g*E-y*w)*D,r[3]=(-(p*N)+d*T-v*x)*D,r[7]=(+(h*N)-d*S+v*E)*D,r[11]=(-(h*T)+p*S-v*w)*D,r[15]=(+(h*x)-p*E+d*w)*D}return r},m44Transpose:function(n,r){return r===undefined&&(r=new e(16)),r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15],r},m44ScalarAdd:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]+r;return i},m44ScalarSub:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]-r;return i},m44ScalarMul:function(n,r,i){i===undefined&&(i=new e(16));for(var s=0;s<16;s+=1)i[s]=n[s]*r;return i},quatBuild:function(n,r,i,s,o){var u=o;return u===undefined&&(u=new e(4)),u[0]=n,u[1]=r,u[2]=i,u[3]=s,u},quatCopy:function(n,r){var i=r;return i===undefined&&(i=new e(4)),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},quatIsSimilar:function(n,r,i){i===undefined&&(i=this.precision);var s=n;n[3]*r[3]<0&&(s=t.v4Neg(n));var o=t.v4LengthSq(t.v4Sub(s,r)),u=i*i;return o<u},quatLength:function(n){return t.v4Length(n)},quatDot:function(n,r){return t.v4Dot(n,r)},quatMul:function(n,r,i){i===undefined&&(i=new e(4));var s=n[0],o=n[1],u=n[2],a=n[3],f=r[0],l=r[1],c=r[2],h=r[3],p=c*o-l*u,d=f*u-c*s,v=l*s-f*o;return i[0]=s*h+f*a+p,i[1]=o*h+l*a+d,i[2]=u*h+c*a+v,i[3]=h*a-(f*s+l*o+c*u),i},quatMulTranslate:function(t,n,r,i,s,o){var u=t[0],a=t[1],f=t[2],l=t[3],c=r[0],h=r[1],p=r[2],d=r[3],v=f*h-a*p,m=u*p-f*c,g=a*c-u*h;s[0]=c*l+u*d+v,s[1]=h*l+a*d+m,s[2]=p*l+f*d+g,s[3]=l*d-(u*c+a*h+f*p);var y=n[0],b=n[1],w=n[2],E=i[0],S=i[1],x=i[2],T=l*l-(u*u+a*a+f*f),N=E*T,C=S*T,k=x*T;T=u*E+a*S+f*x;var L=T+T;N+=u*L,C+=a*L,k+=f*L,v=f*S-a*x,m=u*x-f*E,g=a*E-u*S;var A=l+l;N+=v*A,C+=m*A,k+=g*A,o[0]=N+y,o[1]=C+b,o[2]=k+w},quatNormalize:function(n,r){var i=t.quatDot(n,n);if(i===0)return t.v4BuildZero(r);var s=1/Math.sqrt(i);return t.v4ScalarMul(n,s,r)},quatConjugate:function(n,r){return r===undefined&&(r=new e(4)),r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},quatLerp:function(n,r,i,s){s===undefined&&(s=new e(4));var o=n[0],u=n[1],a=n[2],f=n[3],l=r[0],c=r[1],h=r[2],p=r[3];return s[0]=(l-o)*i+o,s[1]=(c-u)*i+u,s[2]=(h-a)*i+a,s[3]=(p-f)*i+f,s},cosMinSlerpAngle:Math.cos(Math.PI/40),quatSlerp:function(r,i,s,o){var u=o;u===undefined&&(u=new e(4));var a=r[0],f=r[1],l=r[2],c=r[3],h=i[0],p=i[1],d=i[2],v=i[3],m=a*h+f*p+l*d+c*v,g=m;g<0&&(a=-a,f=-f,l=-l,c=-c,g=-g);if(g>t.cosMinSlerpAngle){if(g>1-1e-6)return u[0]=a,u[1]=f,u[2]=l,u[3]=c,u;var y=s;m<=0&&(y=-s);var b=(h-a)*y+a,w=(p-f)*y+f,E=(d-l)*y+l,S=(v-c)*y+c,x=Math.sqrt(b*b+w*w+E*E+S*S),T=1/x;return u[0]=b*T,u[1]=w*T,u[2]=E*T,u[3]=S*T,u}var N=Math.sin,C=Math.acos(g),k=1/N(C),L=N((1-s)*C)*k;return a*=L,f*=L,l*=L,c*=L,L=N(s*C)*k,h*=L,p*=L,d*=L,v*=L,u[0]=a+h,u[1]=f+p,u[2]=l+d,u[3]=c+v,u},quatFromM43:function(n,r){var i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p,d,v,m,g,y=i+a+h+1;y>t.precision?(m=Math.sqrt(y)/2,p=(f-c)/(4*m),d=(l-o)/(4*m),v=(s-u)/(4*m)):i>a&&i>h?(g=Math.sqrt(1+i-a-h)*2,m=(f-c)/g,p=.25*g,d=(u+s)/g,v=(l+o)/g):a>h?(g=Math.sqrt(1+a-i-h)*2,m=(l-o)/g,p=(u+s)/g,d=.25*g,v=(c+f)/g):(g=Math.sqrt(1+h-i-a)*2,m=(s-u)/g,p=(l+o)/g,d=(c+f)/g,v=.25*g);var b=t.quatNormalize([p,d,v,m],r);return t.quatConjugate(b,r)},quatFromAxisRotation:function(r,i,s){var o=.5*i,u=Math.sin(o),a=Math.cos(o),f=s;return f===undefined&&(f=new e(4)),f[0]=r[0]*u,f[1]=r[1]*u,f[2]=r[2]*u,f[3]=a,t.quatNormalize(f,f)},quatToAxisRotation:function(r,i){i===undefined&&(i=new e(4));var s=r[3],o=Math.acos(s)*2,u=1-s*s;if(u<t.precision)i[0]=1,i[1]=0,i[2]=0,i[3]=o;else{var a=1/Math.sqrt(u);i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=o}return i},quatTransformVector:function(n,r,i){var s=n[0],o=n[1],u=n[2],a=n[3],f=r[0],l=r[1],c=r[2],h=a*a-(s*s+o*o+u*u),p=f*h,d=l*h,v=c*h;h=s*f+o*l+u*c;var m=h+h;p+=s*m,d+=o*m,v+=u*m;var g=u*l-o*c,y=s*c-u*f,b=o*f-s*l,w=a+a;return p+=g*w,d+=y*w,v+=b*w,i===undefined&&(i=new e(3)),i[0]=p,i[1]=d,i[2]=v,i},quatEqual:function(t,n,r){r===undefined&&(r=this.precision);var i=Math.abs;return i(t[0]-n[0])<=r&&i(t[1]-n[1])<=r&&i(t[2]-n[2])<=r&&i(t[3]-n[3])<=r},quatPosBuild:function(n,r,i,s,o,u,a,f){var l;return arguments.length<7?(l=i,l===undefined&&(l=new e(7)),l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=r[0],l[5]=r[1],l[6]=r[2]):(l=f,l===undefined&&(l=new e(7)),l[0]=n,l[1]=r,l[2]=i,l[3]=s,l[4]=o,l[5]=u,l[6]=a),l},quatPosTransformVector:function(n,r,i){return t.quatTransformVector(n,r,i)},quatPosTransformPoint:function(n,r){var i=n.slice(4,7),s=t.quatTransformVector(n,r);return t.v3Add(s,i)},quatPosMul:function(n,r){var i=r.slice(4,7),s=t.quatMul(n,r),o=t.quatPosTransformPoint(n,i);return s[4]=o[0],s[5]=o[1],s[6]=o[2],s},isVisibleBox:function(t,n,r){var i=Math.abs,s=t[0],o=t[1],u=t[2],a=n[0],f=n[1],l=n[2],c=r[0],h=r[1],p=r[2],d=r[3],v=r[4],m=r[5],g=r[6],y=r[7],b=r[8],w=r[9],E=r[10],S=r[11],x=c*a,T=h*a,N=p*a,C=d*a,k=v*f,L=m*f,A=g*f,O=y*f,M=b*l,_=w*l,D=E*l,P=S*l,H=c*s+v*o+b*u+r[12],B=h*s+m*o+w*u+r[13],j=p*s+g*o+E*u+r[14],F=d*s+y*o+S*u+r[15];return!(H-F>i(x-C)+i(k-O)+i(M-P)||H+F<-(i(x+C)+i(k+O)+i(M+P))||B-F>i(T-C)+i(L-O)+i(_-P)||B+F<-(i(T+C)+i(L+O)+i(_+P))||j-F>i(N-C)+i(A-O)+i(D-P)||j+F<-(i(N+C)+i(A+O)+i(D+P))||F+F<-(i(C+C)+i(O+O)+i(P+P)))},isVisibleBoxOrigin:function(t,n){var r=Math.abs,i=t[0],s=t[1],o=t[2],u=n[0]*i,a=n[1]*i,f=n[2]*i,l=n[3]*i,c=n[4]*s,h=n[5]*s,p=n[6]*s,d=n[7]*s,v=n[8]*o,m=n[9]*o,g=n[10]*o,y=n[11]*o,b=n[12],w=n[13],E=n[14],S=n[15];return!(b-S>r(u-l)+r(c-d)+r(v-y)||b+S<-(r(u+l)+r(c+d)+r(v+y))||w-S>r(a-l)+r(h-d)+r(m-y)||w+S<-(r(a+l)+r(h+d)+r(m+y))||E-S>r(f-l)+r(p-d)+r(g-y)||E+S<-(r(f+l)+r(p+d)+r(g+y))||S+S<-(r(l+l)+r(d+d)+r(y+y)))},isVisibleSphere:function(t,n,r){var i=Math.abs,s=t[0],o=t[1],u=t[2],a=r[0],f=r[1],l=r[2],c=r[3],h=r[4],p=r[5],d=r[6],v=r[7],m=r[8],g=r[9],y=r[10],b=r[11],w=a,E=f,S=l,x=c,T=h,N=p,C=d,k=v,L=m,A=g,O=y,M=b,_=a*s+h*o+m*u+r[12],D=f*s+p*o+g*u+r[13],P=l*s+d*o+y*u+r[14],H=c*s+v*o+b*u+r[15],B=-n;return!(_-H>n*(i(w-x)+i(T-k)+i(L-M))||_+H<B*(i(w+x)+i(T+k)+i(L+M))||D-H>n*(i(E-x)+i(N-k)+i(A-M))||D+H<B*(i(E+x)+i(N+k)+i(A+M))||P-H>n*(i(S-x)+i(C-k)+i(O-M))||P+H<B*(i(S+x)+i(C+k)+i(O+M))||H+H<B*(i(x+x)+i(k+k)+i(M+M)))},isVisibleSphereOrigin:function(t,n){var r=Math.abs,i=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=n[12],g=n[13],y=n[14],b=n[15],w=-t;return!(m-b>t*(r(i-u)+r(a-c)+r(h-v))||m+b<w*(r(i+u)+r(a+c)+r(h+v))||g-b>t*(r(s-u)+r(f-c)+r(p-v))||g+b<w*(r(s+u)+r(f+c)+r(p+v))||y-b>t*(r(o-u)+r(l-c)+r(d-v))||y+b<w*(r(o+u)+r(l+c)+r(d+v))||b+b<w*(r(u+u)+r(c+c)+r(v+v)))},isVisibleSphereUnit:function(t){var n=Math.abs,r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15];return!(v-y>n(r-o)+n(u-l)+n(c-d)||v+y<-(n(r+o)+n(u+l)+n(c+d))||m-y>n(i-o)+n(a-l)+n(h-d)||m+y<-(n(i+o)+n(a+l)+n(h+d))||g-y>n(s-o)+n(f-l)+n(p-d)||g+y<-(n(s+o)+n(f+l)+n(p+d))||y+y<-(n(o+o)+n(l+l)+n(d+d)))},transformBox:function(n,r,i){var s=Math.abs,o=i[0],u=i[1],a=i[2],f=i[3],l=i[4],c=i[5],h=i[6],p=i[7],d=i[8],v=n[0],m=n[1],g=n[2],y=r[0],b=r[1],w=r[2],E=new e(3);E[0]=o*v+f*m+h*g+i[9],E[1]=u*v+l*m+p*g+i[10],E[2]=a*v+c*m+d*g+i[11];var S=new e(3);return S[0]=s(o)*y+s(f)*b+s(h)*w,S[1]=s(u)*y+s(l)*b+s(p)*w,S[2]=s(a)*y+s(c)*b+s(d)*w,{center:E,halfExtents:E}},planeNormalize:function(n,r){r===undefined&&(r=new e(4));var i=n[0],s=n[1],o=n[2],u=i*i+s*s+o*o;if(u>0){var a=1/Math.sqrt(u);r[0]=i*a,r[1]=s*a,r[2]=o*a,r[3]=n[3]*a}else r[0]=0,r[1]=0,r[2]=0,r[3]=0;return r},extractFrustumPlanes:function(n,r){var i=t.planeNormalize,s=n[0],o=n[1],u=n[2],a=n[3],f=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],v=n[10],m=n[11],g=n[12],y=n[13],b=n[14],w=n[15],E=r||[];return E[0]=i([a+s,h+f,m+p,-(w+g)],E[0]),E[1]=i([a-s,h-f,m-p,-(w-g)],E[1]),E[2]=i([a-o,h-l,m-d,-(w-y)],E[2]),E[3]=i([a+o,h+l,m+d,-(w+y)],E[3]),E[4]=i([a+u,h+c,m+v,-(w+b)],E[4]),E[5]=i([a-u,h-c,m-v,-(w-b)],E[5]),E},isInsidePlanesPoint:function(t,n){var r=t[0],i=t[1],s=t[2],o=n.length,u=0;do{var a=n[u];if(a[0]*r+a[1]*i+a[2]*s<a[3])return!1;u+=1}while(u<o);return!0},isInsidePlanesSphere:function(t,n,r){var i=t[0],s=t[1],o=t[2],u=r.length,a=0;do{var f=r[a];if(f[0]*i+f[1]*s+f[2]*o<f[3]-n)return!1;a+=1}while(a<u);return!0},isInsidePlanesBox:function(t,n,r){var i=t[0],s=t[1],o=t[2],u=n[0],a=n[1],f=n[2],l=i+u,c=s+a,h=o+f,p=i-u,d=s-a,v=o-f,m=r.length,g=0;do{var y=r[g],b=y[0],w=y[1],E=y[2];if(b*(b<0?p:l)+w*(w<0?d:c)+E*(E<0?v:h)<y[3])return!1;g+=1}while(g<m);return!0},extractIntersectingPlanes:function(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n.length,l=[],c=0,h=0;do{var p=n[h],d=p[0],v=p[1],m=p[2];d*(d>0?r:o)+v*(v>0?i:u)+m*(m>0?s:a)<p[3]&&(l[c]=p,c+=1),h+=1}while(h<f);return l}};if(typeof Float32Array!="undefined"){var n=new Float32Array([1,2,3]);n[0]=t.FLOAT_MAX,t.FLOAT_MAX=n[0],e=Float32Array}t.arrayConstructor=e,TurbulenzEngine.hasOwnProperty("VMath")&&(TurbulenzEngine.VMath=t);var r=1,i=function(){function e(){}return e.prototype.subscribe=function(e){var t=this.subscribers,n=t.length;for(var r=0;r<n;r+=1)if(t[r]===e)return;t.push(e)},e.prototype.unsubscribe=function(e){var t=this.subscribers,n=t.length;for(var r=0;r<n;r+=1)if(t[r]===e){t.splice(r,1);break}},e.prototype.unsubscribeAll=function(){this.subscribers.length=0},e.prototype.notify=function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.subscribers,p=this.subscribers.length,d=0;while(d<p)h[d].apply(null,arguments),h.length===p?d+=1:p=h.length},e.create=function(){var t=new e;return t.subscribers=[],t},e}(),s=function(){function e(){this.reasonConnectionLost=0,this.reasonServiceBusy=1}return e.prototype.retryExponential=function(e,t,n){if(!this.notifiedConnectionLost&&TurbulenzEngine.time-this.connectionLostTime>this.notifyTime*.001){this.notifiedConnectionLost=!0;var r;n===0?r=this.reasonConnectionLost:r=this.reasonServiceBusy,e.reason=r,this.onRequestTimeout(r,e)}if(this.connected)this.connectionLostTime=TurbulenzEngine.time,this.notifiedConnectionLost=!1,this.connected=!1,this.reconnectTest=e,e.status=n;else if(this.reconnectTest!==e){var i=this.reconnectedObserver,s=function(){i.unsubscribe(s),t()};i.subscribe(s);return}e.expTime?(e.expTime=2*e.expTime,e.expTime>this.maxRetryTime&&(e.expTime=this.maxRetryTime)):e.expTime=this.initialRetryTime,e.retries?e.retries+=1:e.retries=1,TurbulenzEngine.setTimeout(t,e.expTime)},e.prototype.retryAfter=function(e,t,n,r){e.retries?e.retries+=1:(e.firstRetry=TurbulenzEngine.time,e.retries=1);if(!e.notifiedMaxRetries&&TurbulenzEngine.time-e.firstRetry+t>this.notifyTime){e.notifiedMaxRetries=!0;var i=this.reasonServiceBusy;e.reason=i,this.onRequestTimeout(i,e)}TurbulenzEngine.setTimeout(n,t*1e3)},e.prototype.request=function(e){var t,n=this,r=function(i,s){if(n.destroyed)return;var o=n.sendEventToHandlers,u=n.handlers;if(s===0||s===408||s===429||s===480||s===504){n.retryExponential(e,t,s);return}n.connected||(n.connected=!0,n.reconnectTest===e&&n.notifiedConnectionLost&&n.onReconnected(n.reconnectTest.reason,n.reconnectTest),n.reconnectTest=null,n.reconnectedObserver.notify());if(e.responseFilter&&!e.responseFilter.call(this,e,t,i,s))return;if(n.responseFilter&&!n.responseFilter(e,t,i,s))return;if(e.onload){var a;i&&i.name?a=i.name:a=e.src,o(u.eventOnload,{eventType:"eventOnload",name:a}),e.onload(i,s,e),e.onload=null}e=null};t=function(){if(n.destroyed)return;e.requestFn?e.requestOwner?e.requestFn.call(e.requestOwner,e.src,r,e):e.requestFn(e.src,r,e):e.requestOwner?e.requestOwner.request(e.src,r,e):TurbulenzEngine.request(e.src,r)},t()},e.prototype.addEventListener=function(e,t){var n,r,i;if(this.handlers.hasOwnProperty(e)){i=this.handlers[e];if(t){r=i.length;for(n=0;n<r;n+=1)if(i[n]===t)return;i.push(t)}}},e.prototype.removeEventListener=function(e,t){var n,r,i;if(this.handlers.hasOwnProperty(e)){i=this.handlers[e];if(t){r=i.length;for(n=0;n<r;n+=1)if(i[n]===t){i.splice(n,1);break}}}},e.prototype.sendEventToHandlers=function(e,t){var n,r=e.length;if(r)for(n=0;n<r;n+=1)e[n](t)},e.prototype.destroy=function(){this.destroyed=!0,this.handlers=null,this.onReconnected=null,this.onRequestTimeout=null},e.create=function(t){var n=new e;n.initialRetryTime=t.initialRetryTime||500,n.notifyTime=t.notifyTime||4e3,n.maxRetryTime=t.maxRetryTime||8e3,n.notifiedConnectionLost=!1,n.connected=!0,n.reconnectedObserver=i.create(),n.reconnectTest=null,n.onReconnected=t.onReconnected||function(){},n.onRequestTimeout=t.onRequestTimeout||function(){};var r={eventOnload:[]};return n.handlers=r,n},e}(),o={skipAsserts:!1,assert:function(t,n){t||this.skipAsserts||this.breakInDebugger.doesNotExist()},beget:function(t){var n=function(){};return n.prototype=t,new n},log:function(t,n){var r=window.console;if(r)switch(arguments.length){case 1:r.log(arguments[0]);break;case 2:r.log(arguments[0],arguments[1]);break;case 3:r.log(arguments[0],arguments[1],arguments[2]);break;case 4:r.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:var i=[].splice.call(arguments,0);r.log(i.join(" "))}},nearestLowerPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t-(t>>>1)},nearestUpperPow2:function(t){return t-=1,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1},ajax:function(t){var n="",r=t.method,i=t.data||{},s=t.encrypt,u=null,a=t.url,f=t.requestHandler,l=t.callback;if(s){i.requestUrl=a;var c=JSON.stringify(i);r==="POST"&&(c=TurbulenzEngine.encrypt(c)),n+="data="+encodeURIComponent(c)+"&",n+="gameSessionId="+encodeURIComponent(i.gameSessionId),u=TurbulenzEngine.generateSignature(c)}else if(i){var h;for(h in i)i.hasOwnProperty(h)&&(n.length!==0&&(n+="&"),r==="POST"?n+=h+"="+i[h]:n+=encodeURIComponent(h)+"="+encodeURIComponent(i[h]))}var p=function(t,n){var r=this.xhr;this.xhr.onreadystatechange=null,this.xhr=null;if(r.getResponseHeader("Content-Type")!=="application/json; charset=utf-8")TurbulenzEngine.setTimeout(function(){l({msg:"HttpStatus "+n+" "+o.ajaxStatusCodes[n]},n),l=null},0);else{var i=JSON.parse(t);if(s){var u=r.getResponseHeader("X-TZ-Signature"),f=TurbulenzEngine.verifySignature(t,u);t=null,TurbulenzEngine.setTimeout(function(){var e=i.requestUrl;if(f)if(!TurbulenzEngine.encryptionEnabled||e===a){l(i,n),l=null;return}n===400?l(i,n,"Verification Failed"):l({msg:"Verification failed",ok:!1},400,"Verification Failed"),l=null},0)}else t=null,TurbulenzEngine.setTimeout(function(){l(i,n),l=null},0)}},d=function(i,s,o){var a;if(window.XMLHttpRequest)a=new window.XMLHttpRequest;else{if(!window.ActiveXObject){t.error&&t.error("No XMLHTTPRequest object could be created");return}a=new window.ActiveXObject("Microsoft.XMLHTTP")}o.xhr=a;var f=function(){if(a.readyState===4&&TurbulenzEngine&&!TurbulenzEngine.isUnloading()){var t=a.responseText,n=a.status,r=n!==0&&a.statusText||"No connection or cross domain request";if(a.getAllResponseHeaders()===""&&t===""&&n===200&&r==="OK"){s("",0);return}s.call(o,t,n)}};a.open(r,n&&r!=="POST"?i+"?"+n:i,!0),l&&(a.onreadystatechange=f),u&&a.setRequestHeader("X-TZ-Signature",u),r==="POST"?(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(n)):a.send()};if(f)f.request({src:a,requestFn:d,responseFilter:t.responseFilter,onload:p});else{var v={src:a};d(a,p,v)}},ajaxStatusCodes:{0:"No Connection, Timeout Or Cross Domain Request",100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",429:"Too Many Requests",480:"Temporarily Unavailable",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported"}},u={v2ToArray:function(t){return[t[0],t[1]]},arrayToV2:function(t,n,r){return t.v2Build(n[0],n[1],r)},v3ToArray:function(t){return[t[0],t[1],t[2]]},arrayToV3:function(t,n,r){return t.v3Build(n[0],n[1],n[2],r)},v4ToArray:function(t){return[t[0],t[1],t[2],t[3]]},arrayToV4:function(t,n,r){return t.v4Build(n[0],n[1],n[2],n[3],r)},quatToArray:function(t){return[t[0],t[1],t[2],t[3]]},arrayToQuat:function(t,n,r){return t.quatBuild(n[0],n[1],n[2],n[3],r)},aabbToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]},arrayToAABB:function(t,n,r){return t.aabbBuild(n[0],n[1],n[2],n[3],n[4],n[5],r)},quatPosToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6]]},arrayToQuatPos:function(t,n,r){return t.quatPosBuild(n[0],n[1],n[2],n[3],n[4],n[5],n[6],r)},m33ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},arrayToM33:function(t,n,r){return t.m33Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],r)},m43ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11]]},arrayToM43:function(t,n,r){return t.m43Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],r)},m34ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11]]},m44ToArray:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},arrayToM44:function(t,n,r){return t.m44Build(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15],r)}},a=function(){function e(){}return e.prototype.add=function(){this.referenceCount+=1},e.prototype.remove=function(){this.referenceCount-=1,this.referenceCount===0&&(this.destroyedObserver&&this.destroyedObserver.notify(this.object),this.object.destroy(),this.object=null)},e.prototype.subscribeDestroyed=function(e){this.destroyedObserver||(this.destroyedObserver=i.create()),this.destroyedObserver.subscribe(e)},e.prototype.unsubscribeDestroyed=function(e){this.destroyedObserver.unsubscribe(e)},e.create=function(t){var n=new e;return n.object=t,n.referenceCount=0,n},e.version=1,e}(),f={profiles:{},sortMode:{alphabetical:0,duration:1,max:2,min:3,calls:4},start:function(t){var n=this.profiles[t];n||(n={name:t,calls:0,duration:0,min:Number.MAX_VALUE,max:0,sumOfSquares:0},this.profiles[t]=n),n.start=TurbulenzEngine.time},stop:function(t){var n=TurbulenzEngine.time,r=this.profiles[t];if(r){var i=n-r.start;r.duration+=i,r.calls+=1,r.sumOfSquares+=i*i,i>r.max&&(r.max=i),i<r.min&&(r.min=i)}},reset:function(){this.profiles={}},getReport:function(t,n){var r=[],i,s=0,o;for(o in this.profiles)this.profiles.hasOwnProperty(o)&&(i=this.profiles[o],s<i.duration&&(s=i.duration),r.push(i));var u;t===f.sortMode.alphabetical?u=function(t,n){return t.name<n.name?-1:t.name>n.name?1:0}:t===f.sortMode.max?u=function(t,n){return n.max-t.max}:t===f.sortMode.min?u=function(t,n){return n.min-t.min}:t===f.sortMode.calls?u=function(t,n){return n.calls-t.calls}:u=function(t,n){return n.duration-t.duration},r.sort(u);var a,l="",c=n?n.precision:8,h=n?n.percentagePrecision:1,p=n?n.seperator:" ",d=r.length,v,m,g;for(g=0;g<d;g+=1)i=r[g],a=i.name,a+=p+i.calls,a+=p+i.duration.toFixed(c),a+=p+i.max.toFixed(c),a+=p+i.min.toFixed(c),m=i.duration/i.calls,a+=p+m.toFixed(c),v=Math.sqrt(i.sumOfSquares/i.calls-m*m),a+=p+v.toFixed(c),a+=p+(100*i.duration/s).toFixed(h)+"%\n",l+=a;return l}},l={};l.createArray=function(t){var n={},r=[];t.head&&(t=t.head);var i=function(t){var s=n[t.url];s||(s={},n[t.url]=s);var o=t.functionName===""?"(anonymous)":t.functionName,u=s[o];u||(u={},s[o]=u);var a=u[t.lineNumber];if(!a){var f={functionName:o,numberOfCalls:t.numberOfCalls,totalTime:t.totalTime,selfTime:t.selfTime,url:t.url,lineNumber:t.lineNumber};r[r.length]=f,u[t.lineNumber]=f}else a.totalTime+=t.totalTime,a.selfTime+=t.selfTime,a.numberOfCalls+=t.numberOfCalls;var l=typeof t.children=="function"?t.children():t.children;if(l){var c=l.length,h;for(h=0;h<c;h+=1)i(l[h])}};return i(t),r},l.sort=function(t,n,r){n||(n="totalTime");var i=function(e,t){return e[n]-t[n]},s=function(e,t){return t[n]-e[n]};r===!1?t.sort(i):t.sort(s)};var c=function(){function e(){}return e.create=function(){return new e},e}(),h=function(){function e(){}return e.prototype.push=function(e,t){var n=c.create();n.key=e,n.value=t,n.timeOffset=TurbulenzEngine.time,this.events.push(n)},e.prototype.length=function(){return this.events.length},e.prototype.clear=function(){this.events.length=0},e.create=function(){var t=new e;return t.events=[],t},e}(),p=function(){function e(){}return e.prototype.request=function(e){var t=function(){e.callback&&e.callback({ok:!1,msg:"Service Unavailable. Discarding request"},503)},n=this,r=this.serviceStatusObserver,i;i=function(o,u){u?e.neverDiscard||(r.unsubscribe(i),t()):o&&(r.unsubscribe(i),n.request(e))};if(!this.running)return this.discardRequests&&!e.neverDiscard?(TurbulenzEngine.setTimeout(t,0),!1):(e.waiting||(e.waiting=!0,r.subscribe(i)),!0);var s=e.responseFilter;return e.responseFilter=function(u,a,f,l){if(l===503){var c=JSON.parse(f),h=c.data,p=h?h.discardRequests:!0;return n.discardRequests=p,p&&!e.neverDiscard?t():r.subscribe(i),d.serviceUnavailable(n,u),!1}return s?s.call(e.requestHandler,u,a,f,l):!0},o.ajax(e),!0},e.create=function(t,n){var r=new e;return n||(n={}),r.running=!0,r.discardRequests=!1,r.serviceStatusObserver=i.create(),r.serviceName=t,r.onServiceUnavailable=n.onServiceUnavailable,r.onServiceAvailable=n.onServiceAvailable,r},e}(),d=function(){function e(){}return e.available=function(){return window.gameSlug!==undefined},e.addBridgeEvents=function(){var e=window.top.Turbulenz,t=e&&e.Data||{},n=t.joinMultiplayerSessionId,r=this,i=function(t){r.multiplayerJoinRequestQueue.push(t)},s=function(t){var n=JSON.parse(t);n.mode&&(r.mode=n.mode),n.joinMultiplayerSessionId&&r.multiplayerJoinRequestQueue.push(n.joinMultiplayerSessionId),r.bridgeServices=!!n.bridgeServices};n&&this.multiplayerJoinRequestQueue.push(n),v.setOnMultiplayerSessionToJoin(i),v.setOnReceiveConfig(s),v.triggerRequestConfig(),this.responseHandlers=[null],this.responseIndex=0,v.on("bridgeservices.response",function(e){r.routeResponse(e)})},e.callOnBridge=function(e,t,n){var r={data:t,key:undefined};n&&(this.responseIndex+=1,this.responseHandlers[this.responseIndex]=n,r.key=this.responseIndex),v.emit("bridgeservices."+e,JSON.stringify(r))},e.addSignature=function(e,t){var n;return e.requestUrl=t,n=TurbulenzEngine.encrypt(JSON.stringify(e)),e.str=n,e.signature=TurbulenzEngine.generateSignature(n),e},e.routeResponse=function(e){var t=JSON.parse(e),n=t.key||0,r=this.responseHandlers[n];r&&(this.responseHandlers[n]=null,r(t.data))},e.onServiceUnavailable=function(e,t){},e.onServiceAvailable=function(e,t){},e.createGameSession=function(e,t,n){return y.create(e,t,n)},e.createMappingTable=function(t,n,r,i,s){var o,u=n&&n.mappingTable,a,f,l;u?(a=u.mappingTableURL,f=u.mappingTablePrefix,l=u.assetPrefix):i?(a=i.mappingTableURL||(i.mappingTableURL===""?"":"mapping_table.json"),f=i.mappingTablePrefix||(i.mappingTablePrefix===""?"":"staticmax/"),l=i.assetPrefix||(i.assetPrefix===""?"":"missing/")):(a="mapping_table.json",f="staticmax/",l="missing/");var c=function(n){var r=i&&(i.urnMapping||{}),u=s||e.defaultErrorCallback;o.setMapping(r),u(n)},h={mappingTableURL:a,mappingTablePrefix:f,assetPrefix:l,requestHandler:t,onload:r,errorCallback:c};return o=b.create(h),o},e.createLeaderboardManager=function(e,t,n,r){return LeaderboardManager.create(e,t,n,r)},e.createBadgeManager=function(e,t){return BadgeManager.create(e,t)},e.createStoreManager=function(e,t,n,r){return m.create(e,t,n,r)},e.createNotificationsManager=function(e,t,n,r){return NotificationsManager.create(e,t,n,r)},e.createMultiplayerSessionManager=function(e,t){return MultiPlayerSessionManager.create(e,t)},e.createUserProfile=function(t,n,r){var i={};r||(r=e.defaultErrorCallback);var s=function(t){if(t&&t.ok){t=t.data;var n;for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}},o="/api/v1/profiles/user";return e.available()&&this.getService("profiles").request({url:o,method:"GET",callback:function(t,o){o===200?s(t):r&&r("TurbulenzServices.createUserProfile error with HTTP status "+o+": "+t.msg,o),n&&n(i)},requestHandler:t}),i},e.upgradeAnonymousUser=function(e){if(e){var t=function(n){e()};v.on("user.upgrade.occurred",t)}v.emit("user.upgrade.show")},e.sendCustomMetricEvent=function(t,n,r,i,s){s||(s=e.defaultErrorCallback);if(!e.available()){s("TurbulenzServices.sendCustomMetricEvent failed: Service not available",0);return}if("string"!=typeof t||0===t.length){s("TurbulenzServices.sendCustomMetricEvent failed: Event key must be a non-empty string",0);return}if("number"!=typeof n||isNaN(n)||!isFinite(n)){if("[object Array]"!==Object.prototype.toString.call(n)){s("TurbulenzServices.sendCustomMetricEvent failed: Event value must be a number or an array of numbers",0);return}var o,u=n.length;for(o=0;o<u;o+=1)if("number"!=typeof n[o]||isNaN(n[o])||!isFinite(n[o])){s("TurbulenzServices.sendCustomMetricEvent failed: Event value array elements must be numbers",0);return}}this.getService("customMetrics").request({url:"/api/v1/custommetrics/add-event/"+i.gameSlug,method:"POST",data:{key:t,value:n,gameSessionId:i.gameSessionId},callback:function(t,n){n!==200&&s("TurbulenzServices.sendCustomMetricEvent error with HTTP status "+n+": "+t.msg,n)},requestHandler:r,encrypt:!0})},e.sendCustomMetricEventBatch=function(t,n,r,i){i||(i=e.defaultErrorCallback);if(!e.available()){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Service not available",0);return}var s=TurbulenzEngine.time,o=t.events,u,a=o.length;for(u=0;u<a;u+=1){var f=o[u].key,l=o[u].value,c=o[u].timeOffset;if("string"!=typeof f||0===f.length){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event key must be a non-empty string",0);return}if("number"!=typeof l||isNaN(l)||!isFinite(l)){if("[object Array]"!==Object.prototype.toString.call(l)){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event value must be a number or an array of numbers",0);return}var h,p=l.length;for(h=0;h<p;h+=1)if("number"!=typeof l[h]||isNaN(l[h])||!isFinite(l[h])){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event value array elements must be numbers",0);return}}if("number"!=typeof c||isNaN(c)||!isFinite(c)){i&&i("TurbulenzServices.sendCustomMetricEventBatch failed: Event time offset is corrupted",0);return}o[u].timeOffset=c-s}this.getService("customMetrics").request({url:"/api/v1/custommetrics/add-event-batch/"+r.gameSlug,method:"POST",data:{batch:o,gameSessionId:r.gameSessionId},callback:function(t,n){n!==200&&i&&i("TurbulenzServices.sendCustomMetricEventBatch error with HTTP status "+n+": "+t.msg,n)},requestHandler:n,encrypt:!0})},e.getService=function(e){var t=this.services;if(t.hasOwnProperty(e))return t[e];var n=p.create(e);return t[e]=n,n},e.serviceUnavailable=function(t,n){var r=this.waitingServices,i=t.serviceName;if(r.hasOwnProperty(i))return;r[i]=t,t.running=!1;var s=function(r){var i=n.onServiceUnavailable;i&&i.call(r,n),r.onServiceUnavailable&&r.onServiceUnavailable(),e.onServiceUnavailable&&e.onServiceUnavailable(r)};t.discardRequests&&s(t);if(this.pollingServiceStatus)return;var u=this,a,f="/api/v1/service-status/game/read/"+window.gameSlug,l=function(i,o){if(o===200){var f=i.data,l=f.services,c=!1,h;for(h in r)if(r.hasOwnProperty(h)){var p=r[h],d=l[h],v=d.running;p.running=v,p.description=d.description;if(v){if(p.discardRequests){var m=n.onServiceAvailable;m&&m.call(p,n),p.onServiceAvailable&&p.onServiceAvailable(),e.onServiceAvailable&&e.onServiceAvailable(p)}delete r[h],p.discardRequests=!1,p.serviceStatusObserver.notify(v,p.discardRequests)}else d.discardRequests&&!p.discardRequests&&(p.discardRequests=!0,s(p),p.serviceStatusObserver.notify(v,p.discardRequests)),c=!0}if(!c){this.pollingServiceStatus=!1;return}TurbulenzEngine.setTimeout(a,f.pollInterval*1e3)}else TurbulenzEngine.setTimeout(a,u.defaultPollInterval)};a=function(){o.ajax({url:f,method:"GET",callback:l})},a()},e.multiplayerJoinRequestQueue={argsQueue:[],handler:function(){},context:undefined,paused:!0,onEvent:function(t,n){this.handler=t,this.context=n},push:function(t){var n=[t];this.paused?this.argsQueue.push(n):this.handler.apply(this.context,n)},shift:function(){var t=this.argsQueue.shift();return t?t[0]:undefined},clear:function(){this.argsQueue=[]},pause:function(){this.paused=!0},resume:function(){this.paused=!1;while(this.argsQueue.length){this.handler.apply(this.context,this.argsQueue.shift());if(this.paused)break}}},e.defaultErrorCallback=function(e,t){},e.services={},e.waitingServices={},e.pollingServiceStatus=!1,e.defaultPollInterval=4e3,e}();typeof v!="undefined"&&d.addBridgeEvents();var v=function(){function e(){}return e._initInstance=function(){var e=window.top.Turbulenz;if(e&&e.Services){var t=e.Services.bridge;if(!t)return;this._bridge=t,this.emit=t.emit,this.on=t.gameListenerOn||t.addListener||t.setListener,this.addListener=t.gameListenerOn||t.addListener||t.setListener,this.setListener=t.gameListenerOn||t.setListener}typeof d!="undefined"&&d.addBridgeEvents()},e.isInitialised=function(){return this._bridge!==undefined},e.emit=function(e,t,n){},e.on=function(e,t){},e.addListener=function(){},e.setListener=function(e,t){},e.setOnReceiveConfig=function(e){this.on("config.set",e)},e.triggerRequestConfig=function(){this.emit("config.request")},e.startLoading=function(){this.emit("status.loading.start")},e.startSaving=function(){this.emit("status.saving.start")},e.stopLoading=function(){this.emit("status.loading.stop")},e.stopSaving=function(){this.emit("status.saving.stop")},e.createdGameSession=function(e){this.emit("game.session.created",e)},e.destroyedGameSession=function(e){this.emit("game.session.destroyed",e)},e.setGameSessionStatus=function(e,t){this.emit("game.session.status",e,t)},e.setGameSessionInfo=function(e){this.emit("game.session.info",e)},e.updateUserBadge=function(e){this.emit("userbadge.update",e)},e.updateLeaderBoard=function(e){this.emit("leaderboards.update",e)},e.setOnMultiplayerSessionToJoin=function(e){this.on("multiplayer.session.join",e)},e.triggerJoinedMultiplayerSession=function(e){this.emit("multiplayer.session.joined",e)},e.triggerLeaveMultiplayerSession=function(e){this.emit("multiplayer.session.leave",e)},e.triggerMultiplayerSessionMakePublic=function(e){this.emit("multiplayer.session.makepublic",e)},e.setOnBasketUpdate=function(e){this.on("basket.site.update",e)},e.triggerBasketUpdate=function(e){this.emit("basket.game.update.v2",e)},e.triggerUserStoreUpdate=function(e){this.emit("store.user.update",e)},e.setOnPurchaseConfirmed=function(e){this.on("purchase.confirmed",e)},e.setOnPurchaseRejected=function(e){this.on("purchase.rejected",e)},e.triggerShowConfirmPurchase=function(){this.emit("purchase.show.confirm")},e.triggerFetchStoreMeta=function(){this.emit("fetch.store.meta")},e.setOnStoreMeta=function(
e){this.on("store.meta.v2",e)},e.triggerSendInstantNotification=function(e){this.emit("notifications.ingame.sendInstant",e)},e.triggerSendDelayedNotification=function(e){this.emit("notifications.ingame.sendDelayed",e)},e.setOnNotificationSent=function(e){this.on("notifications.ingame.sent",e)},e.triggerCancelNotificationByID=function(e){this.emit("notifications.ingame.cancelByID",e)},e.triggerCancelNotificationsByKey=function(e){this.emit("notifications.ingame.cancelByKey",e)},e.triggerCancelAllNotifications=function(e){this.emit("notifications.ingame.cancelAll",e)},e.triggerInitNotificationManager=function(e){this.emit("notifications.ingame.initNotificationManager",e)},e.setOnReceiveNotification=function(e){this.on("notifications.ingame.receive",e)},e.changeAspectRatio=function(e){this.emit("change.viewport.ratio",e)},e.setOnViewportHide=function(e){this.on("change.viewport.hide",e)},e.setOnViewportShow=function(e){this.on("change.viewport.show",e)},e.setOnFullscreenOn=function(e){this.on("change.viewport.fullscreen.on",e)},e.setOnFullscreenOff=function(e){this.on("change.viewport.fullscreen.off",e)},e.setOnMenuStateChange=function(e){this.on("change.menu.state",e)},e.setOnUserStateChange=function(e){this.on("change.user.state",e)},e.triggerOnFullscreen=function(){this.emit("trigger.viewport.fullscreen")},e.triggerOnViewportVisibility=function(){this.emit("trigger.viewport.visibility")},e.triggerOnMenuStateChange=function(){this.emit("trigger.menu.state")},e.triggerOnUserStateChange=function(){this.emit("trigger.user.state")},e.queryFullscreen=function(e){this.emit("query.viewport.fullscreen",e)},e.queryViewportVisibility=function(e){this.emit("query.viewport.visibility",e)},e.queryMenuState=function(e){this.emit("query.menu.state",e)},e.queryUserState=function(e){this.emit("query.user.state",e)},e._bridge=undefined,e}();v.isInitialised()||v._initInstance();var m=function(){function e(){}return e.prototype.requestUserItems=function(e,t){var n=this,r=function(i,s){if(s===200)n.userItems=i.data.userItems,e&&e(i.userItems);else{var o=t||n.errorCallbackFn;o&&o("StoreManager.requestUserItems failed with status "+s+": "+i.msg,s,n.requestUserItems,[e,t])}},i={token:this.userItemsRequestToken.next(),gameSessionId:this.gameSessionId};this.service.request({url:"/api/v1/store/user/items/read/"+this.gameSession.gameSlug,method:"GET",data:i,callback:r,requestHandler:this.requestHandler,encrypt:!0})},e.prototype.getUserItems=function(){return this.userItems},e.prototype.getItemsSortedDict=function(e){var t=[],n={},r,i;for(r in e)e.hasOwnProperty(r)&&(i=e[r],i.key=r,t[i.index]=i);var s,o=t.length;for(s=0;s<o;s+=1)i=t[s],n[i.key]=i;return n},e.prototype.getOfferings=function(){return this.getItemsSortedDict(this.offerings)},e.prototype.getResources=function(){return this.getItemsSortedDict(this.resources)},e.prototype.getItems=function(){return this.getOfferings()},e.prototype.updateBasket=function(e){var t=null;e&&(t=this.basketUpdateRequestToken.next(),this.updateBasketCallbacks[t]=e);var n=this;TurbulenzEngine.setTimeout(function(){v.triggerBasketUpdate(JSON.stringify({basketItems:n.basket.items,token:t}))},0)},e.prototype.addToBasket=function(e,t){function i(e){var t,n=e.output;for(t in n)if(n.hasOwnProperty(t)&&r[t].type!=="own")return!1;return!0}function o(e){var t,n=e.output;for(t in n)if(n.hasOwnProperty(t))if(!s.hasOwnProperty(t)||s[t].amount===0)return!1;return!0}var n=this.offerings[e];if(!n||!n.available||Math.floor(t)!==t||t<=0)return!1;var r=this.resources,s=this.userItems,u=this.basket.items,a=0;u[e]?a=u[e].amount:a=0;var f=a+t,l=i(n);if(l&&f>1){f=1;if(a===1)return!1}return f<=0||l&&o(n)?!1:(u[e]={amount:f},!0)},e.prototype.removeFromBasket=function(e,t){if(!this.offerings[e]||Math.floor(t)!==t||t<=0)return!1;var n=this.basket.items[e];if(!n||n.amount<=0)return!1;var r=n.amount-t;return r<=0?delete this.basket.items[e]:this.basket.items[e]={amount:r},!0},e.prototype.emptyBasket=function(){this.basket.items={}},e.prototype.isBasketEmpty=function(){var e,t=this.basket.items;for(e in t)if(t.hasOwnProperty(e)&&t[e].amount>0)return!1;return!0},e.prototype.showConfirmPurchase=function(){return this.isBasketEmpty()?!1:(this.updateBasket(function(){v.triggerShowConfirmPurchase()}),!0)},e.prototype.consume=function(e,t,n,r){var i=this,s=function(t,s){if(s===200)i.userItems=t.data.userItems,n&&n(t.data.consumed),v.triggerUserStoreUpdate(JSON.stringify(i.userItems));else{var o=r||i.errorCallbackFn;o&&o("StoreManager.consume failed with status "+s+": "+t.msg,s,i.consume,[n,r])}},o={token:this.consumeRequestToken.next(),gameSessionId:this.gameSessionId,key:e,consume:t};this.service.request({url:"/api/v1/store/user/items/consume",method:"POST",data:o,callback:s,requestHandler:this.requestHandler,encrypt:!0})},e.create=function(t,n,r,i){function u(){!o&&s.offerings!==null&&s.resources!==null&&s.basket!==null&&s.userItems!==null&&(r&&r(s),s.ready=!0,o=!0)}function l(){function e(){s.onSitePurchaseConfirmed&&s.onSitePurchaseConfirmed()}s.requestUserItems(e)}if(!d.available())return TurbulenzEngine.setTimeout(function(){i&&i("TurbulenzServices.createStoreManager requires Turbulenz services")},0),null;var s=new e;s.gameSession=n,s.gameSessionId=n.gameSessionId,s.errorCallbackFn=i||d.defaultErrorCallback,s.service=d.getService("store"),s.requestHandler=t,s.userItemsRequestToken=g.create(),s.basketUpdateRequestToken=g.create(),s.consumeRequestToken=g.create(),s.ready=!1,s.offerings=null,s.resources=null,s.basket=null,s.userItems=null;var o=!1;s.requestUserItems(u),s.onBasketUpdate=null,s.updateBasketCallbacks={};var a=function(t){var n=JSON.parse(t),r;n.token&&(r=n.token,delete n.token),s.basket=n,r&&s.updateBasketCallbacks.hasOwnProperty(r)&&(s.updateBasketCallbacks[r](),delete s.updateBasketCallbacks[r]),s.onBasketUpdate&&s.onBasketUpdate(n),u()};v.setOnBasketUpdate(a),v.triggerBasketUpdate();var f=function(t){var n=JSON.parse(t);s.currency=n.currency,s.offerings=n.items||n.offerings,s.resources=n.resources,u()};v.setOnStoreMeta(f),v.triggerFetchStoreMeta(),s.onSitePurchaseConfirmed=null,v.setOnPurchaseConfirmed(l),s.onSitePurchaseRejected=null;var c=function(){s.onSitePurchaseRejected&&s.onSitePurchaseRejected()};return v.setOnPurchaseRejected(c),s},e.version=1,e}(),g=function(){function e(){this.randomMax=Math.pow(2,32)}return e.prototype.next=function(){this.counter+=1;var e=this.counter,t=Math.random()*this.randomMax,n=this.bytes;return n[0]=t&255,n[1]=(t&65280)>>>8,n[2]=(t&16711680)>>>16,n[3]=(t&4278190080)>>>24,n[4]=e&255,n[5]=(e&65280)>>>8,TurbulenzEngine.base64Encode(n)},e.create=function(){var t=new e;return t.counter=0,t.randomGenerator=null,t.bytes=[],t},e.version=1,e}(),y=function(){function e(){this.post_delay=1e3}return e.prototype.setStatus=function(e){if(this.destroyed||this.status===e)return;this.status=e,v.setGameSessionStatus(this.gameSessionId,e)},e.prototype.destroy=function(e){var t;this.pendingUpdate&&(TurbulenzEngine.clearTimeout(this.pendingUpdate),this.pendingUpdate=null),!this.destroyed&&this.gameSessionId?(v.destroyedGameSession(this.gameSessionId),this.destroyed=!0,t={gameSessionId:this.gameSessionId},d.bridgeServices?d.callOnBridge("gamesession.destroy",t,e):o.ajax({url:"/api/v1/games/destroy-session",method:"POST",data:t,callback:e,requestHandler:this.requestHandler})):e&&TurbulenzEngine.setTimeout(e,0)},e.prototype.setTeamInfo=function(e){var t=this.info.sessionData,n=t.teamList||[];e.join("#")!==n.join("#")&&(t.teamList=e,this.update())},e.prototype.setPlayerInfo=function(e,t){var n=this.info.playerSessionData[e],r,i=!1;n||(n={},this.info.playerSessionData[e]=n,i=!0);for(r in t)if(t.hasOwnProperty(r)){if(!this.templatePlayerData.hasOwnProperty(r))throw"unknown session data property "+r;n[r]!==t[r]&&(n[r]=t[r],i=!0)}i&&this.update()},e.prototype.removePlayerInfo=function(e){delete this.info.playerSessionData[e],this.update()},e.prototype.clearAllPlayerInfo=function(){this.info.playerSessionData={},this.update()},e.prototype.update=function(){this.pendingUpdate||(this.pendingUpdate=TurbulenzEngine.setTimeout(this.postData,this.post_delay))},e.create=function(t,n,r){var i=new e,s=window.gameSlug,o=window.top.Turbulenz,u=o&&o.Data||{},a=u.mode||d.mode,f="/api/v1/games/create-session/"+s;i.info={sessionData:{},playerSessionData:{}},i.templatePlayerData={team:null,color:null,status:null,rank:null,score:null,sortkey:null},i.postData=function(){v.setGameSessionInfo(JSON.stringify(i.info)),i.pendingUpdate=null},i.pendingUpdate=null,i.gameSlug=s,i.requestHandler=t,i.errorCallbackFn=r||d.defaultErrorCallback,i.gameSessionId=null,i.service=d.getService("gameSessions"),i.status=null;if(!d.available())return n&&TurbulenzEngine.setTimeout(function(){n(i)},0),i;var l=function(t,r){r===200?(i.mappingTable=t.mappingTable,i.gameSessionId=t.gameSessionId,n&&n(i),v.createdGameSession(i.gameSessionId)):404===r?(window.gameSlug=undefined,i.gameSlug=undefined,n&&n(i)):i.errorCallbackFn("TurbulenzServices.createGameSession error with HTTP status "+r+": "+t.msg,r)};return a&&(f+="/"+a),i.service.request({url:f,method:"POST",callback:l,requestHandler:t,neverDiscard:!0}),i},e.version=1,e}(),b=function(){function e(){}return e.prototype.getURL=function(e,t){var n=this.overrides,r=this.currentProfile,i=n[r],s;while(i){s=i.urnmapping[e];if(s)return s;i=n[i.parent]}return s=this.urlMapping[e],s?s:(t&&t(e),this.assetPrefix+e)},e.prototype.setMapping=function(e){this.urlMapping=e},e.prototype.map=function(e,t){this.urlMapping[e]=t},e.prototype.alias=function(e,t){var n=this.urlMapping;n[e]=n[t]},e.prototype.getCurrentProfile=function(){return this.currentProfile},e.prototype.setProfile=function(e){this.overrides.hasOwnProperty(e)?this.currentProfile=e:this.currentProfile=undefined},e.create=function(t){var n=new e;n.mappingTableURL=t.mappingTableURL,n.tablePrefix=t.mappingTablePrefix,n.assetPrefix=t.assetPrefix,n.overrides={},n.errorCallbackFn=t.errorCallback||d.defaultErrorCallback,n.currentProfile=TurbulenzEngine.getSystemInfo().platformProfile;var r=function(r){var i=r.urnmapping||r.urnremapping||{},s=r.overrides||{};n.urlMapping=i,n.overrides=s;var o=n.tablePrefix;if(o){var u=function(t){var n;for(n in t)t.hasOwnProperty(n)&&(t[n]=o+t[n])};u(i);var a;for(a in s)s.hasOwnProperty(a)&&u(s[a].urnmapping)}t.onload(n)};return n.mappingTableURL?t.requestHandler.request({src:n.mappingTableURL,onload:function(t,i){if(i===200){var s=JSON.parse(t);r(s)}else n.urlMapping={},t=t||{msg:"(no response)"},n.errorCallbackFn("MappingTable.create: HTTP status "+i+": "+t.msg,i)}}):t.mappingTableData?TurbulenzEngine.setTimeout(function(){r(JSON.parse(t.mappingTableData))},0):TurbulenzEngine.setTimeout(function(){n.errorCallbackFn("!! mappingtable params contain no url or data")},0),n},e.version=1,e}(),w=function(){function e(){}return e.prototype.get=function(e){return null},e.create=function(t,n,r,s,o){function y(e){var t=e.parameters,n=e.techniques,r=e.programs,i,s,o,u,a,f,l,c,h,p,d,v,m,y,b;for(i in t)if(t.hasOwnProperty(i)){s=g[i];if(s!==undefined){t[i].rows=s,o={};for(u in n)if(n.hasOwnProperty(u)){a=n[u],f=a.length;for(l=0;l<f;l+=1){c=a[l];if(c.parameters.indexOf(i)!==-1){h=c.programs,p=h.length;for(d=0;d<p;d+=1)o[h[d]]=!0}}}v=new RegExp("uniform\\s+(\\w+)\\s+"+i+"\\s*\\[[^\\]]+\\]","mg"),m="uniform $1 "+i+"["+s+"]";for(y in o)o.hasOwnProperty(y)&&(b=r[y],b.code=b.code.replace(v,m))}}}s||(s=function(){});var u="default",a;if(r)a=r;else{var f={version:1,name:"default.cgfx",parameters:{worldViewProjection:{type:"float",rows:4,columns:4},diffuse:{type:"sampler2D"}},techniques:{textured3D:[{parameters:["worldViewProjection","diffuse"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!0,DepthFunc:515,DepthMask:!0,CullFaceEnable:!0,CullFace:1029,BlendEnable:!1},programs:["vp","fp"]}]},programs:{fp:{type:"fragment",code:"#ifdef GL_ES\nprecision mediump float;precision mediump int;\n#endif\nvarying vec4 tz_TexCoord[1];vec4 _ret_0;uniform sampler2D diffuse;void main()\n{_ret_0=texture2D(diffuse,tz_TexCoord[0].xy);gl_FragColor=_ret_0;}"},vp:{type:"vertex",code:"#ifdef GL_ES\nprecision mediump float;precision mediump int;\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvec4 _OUTpos1;vec2 _OUTuv1;uniform vec4 worldViewProjection[4];void main()\n{_OUTpos1=ATTR0.xxxx*worldViewProjection[0]+ATTR0.yyyy*worldViewProjection[1]+ATTR0.zzzz*worldViewProjection[2]+worldViewProjection[3];_OUTuv1=ATTR8.xy;tz_TexCoord[0].xy=ATTR8.xy;gl_Position=_OUTpos1;}"}}};a=t.createShader(f),a||s("Default shader not created.")}var l={},c={},h={},p=0,d=null,v="",m=!1,g={};l[u]=a;var b=function(r,u){r===undefined&&s("Invalid texture path passed to ShaderManager.Load");var f=l[r];if(!f){if(!c[r]){c[r]=!0,p+=1;var g=i.create();h[r]=g,u&&g.subscribe(u);var b=function(n){if(n){var i=JSON.parse(n);m&&y(i);var s=t.createShader(i);s?l[r]=s:delete l[r],g.notify(s),delete h[r]}else o&&(o.innerHTML+="ShaderManager.load:&nbsp;'"+r+"' failed to load<br>"),delete l[r];delete c[r],p-=1};n.request({src:d&&d[r]||v+r,onload:b})}else u&&h[r].subscribe(u);return a}return u&&TurbulenzEngine.setTimeout(function(){u(f)},0),f},w=function(t,n){l[t]=l[n]},E=function(t){var n=l[t];return n?n:a},S=function(t){typeof l[t]!="undefined"&&delete l[t]},x=function(t,n){S(t),b(t,n)},T=new e;return o?(T.load=function(t,n){return o.innerHTML+="ShaderManager.load:&nbsp;'"+t+"'<br>",b(t,n)},T.map=function(t,n){o.innerHTML+="ShaderManager.map:&nbsp;'"+n+"' -> '"+t+"'<br>",w(t,n)},T.get=function(t){return o.innerHTML+="ShaderManager.get:&nbsp;'"+t+"'<br>",E(t)},T.remove=function(t){o.innerHTML+="ShaderManager.remove:&nbsp;'"+t+"'<br>",S(t)},T.reload=function(t,n){o.innerHTML+="ShaderManager. reload:&nbsp;'"+t+"'<br>",x(t,n)}):(T.load=b,T.map=w,T.get=E,T.remove=S,T.reload=x),T.reloadAll=function(){for(var t in l)l.hasOwnProperty(t)&&t!==u&&x(t)},T.getAll=function(){return l},T.getNumPendingShaders=function(){return p},T.isShaderLoaded=function(t){return!c[t]},T.isShaderMissing=function(t){return!l[t]},T.setPathRemapping=function(t,n){d=t,v=n},T.setAutomaticParameterResize=function(t,n){m=!0,g[t]=n},T.destroy=function(){if(l){var r;for(r in l)if(l.hasOwnProperty(r)){var i=l[r];i&&i.destroy()}l=null}a=null,c=null,h=null,p=0,d=null,v=null,n=null,t=null},T},e.version=1,e}(),E=function(){function e(){}return e.create=function(){var t=new e;return t.indices=[],t.textures=[],t.numSets=0,t.vertexBufferData=new T.floatArray(1024),t.numVertices=0,t},e}(),S=function(){function e(){}return e.prototype.getTextureRectangle=function(e){e===undefined&&(e=new T.floatArray(4));var t=this.data,n=this._texture;return n?(e[0]=t[12]*n.width,e[1]=t[13]*n.height,e[2]=t[14]*n.width,e[3]=t[15]*n.height):(e[0]=t[12],e[1]=t[13],e[2]=t[14],e[3]=t[15]),e},e.prototype.setTextureRectangle=function(e){var t=this.data,n=this._texture;if(n){var r=1/n.width,i=1/n.height;t[12]=e[0]*r,t[13]=e[1]*i,t[14]=e[2]*r,t[15]=e[3]*i}else t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=e[3]},e.prototype.getColor=function(e){e===undefined&&(e=new T.floatArray(4));var t=this.data;return e[0]=t[8],e[1]=t[9],e[2]=t[10],e[3]=t[11],e},e.prototype.setColor=function(e){var t=this.data;t[8]=e[0],t[9]=e[1],t[10]=e[2],t[11]=e[3]},e.prototype.getTexture=function(){return this._texture},e.prototype.setTexture=function(e){if(this._texture!==e){var t=(this._texture?this._texture.width:1)/(e?e.width:1),n=(this._texture?this._texture.height:1)/(e?e.height:1);this._texture=e||null;var r=this.data;r[12]*=t,r[13]*=n,r[14]*=t,r[15]*=n}},e.prototype.getWidth=function(){return this.data[17]*2},e.prototype.setWidth=function(e){e*=.5;var t=this.data;t[17]!==e&&(t[23]=t[23]*e/t[17],t[17]=e,this._invalidate())},e.prototype.getHeight=function(){return this.data[18]*2},e.prototype.setHeight=function(e){e*=.5;var t=this.data;t[18]!==e&&(t[24]=t[24]*e/t[18],t[18]=e,this._invalidate())},e.prototype.getScale=function(e){e===undefined&&(e=new T.floatArray(2));var t=this.data;return e[0]=t[19],e[1]=t[20],e},e.prototype.setScale=function(e){var t=e[0],n=e[1],r=this.data;if(r[19]!==t||r[20]!==n)r[19]=t,r[20]=n,this._invalidate()},e.prototype.getShear=function(e){e===undefined&&(e=new T.floatArray(2));var t=this.data;return e[0]=t[21],e[1]=t[22],e},e.prototype.setShear=function(e){var t=e[0],n=e[1],r=this.data;if(r[21]!==t||r[22]!==n)r[21]=t,r[22]=n,this._invalidate()},e.prototype.getOrigin=function(e){e===undefined&&(e=new T.floatArray(2));var t=this.data;return e[0]=t[23],e[1]=t[24],e},e.prototype.setOrigin=function(e){var t=e[0],n=e[1],r=this.data;if(r[23]!==t||r[24]!==n)r[23]=t,r[24]=n,this._invalidate()},e.prototype._invalidate=function(){var e=this.data,t=e[19],n=e[19]*e[21],r=e[20]*e[22],i=e[20],s=e[17]-e[23],o=e[18]-e[24],u=e[25]=t*s+n*o,a=e[26]=r*s+i*o;s=-e[17],o=-e[18];var f=e[27]=t*s+n*o,l=e[28]=r*s+i*o;s=-s;var c=e[29]=t*s+n*o,h=e[30]=r*s+i*o,p=e[16]=this.rotation,d=Math.cos(p),v=Math.sin(p);e[31]=d*u-v*a,e[32]=v*u+d*a,e[33]=d*f-v*l,e[34]=v*f+d*l,e[35]=d*c-v*h,e[36]=v*c+d*h;var m=2*(u*f+a*l);m<0&&(m=-m);var g=f*f+l*l+m;m=2*(u*c+a*h),m<0&&(m=-m);var y=c*c+h*h+m;y>g&&(g=y),g+=u*u+a*a,e[37]=.25/g},e.prototype._update=function(e){var t=this.data,n,r,i,s;n=this.rotation,r=n-t[16],r*r>t[37]*e&&(t[16]=n,i=Math.cos(n),s=Math.sin(n),n=t[25],r=t[26],t[31]=i*n-s*r,t[32]=s*n+i*r,n=t[27],r=t[28],t[33]=i*n-s*r,t[34]=s*n+i*r,n=t[29],r=t[30],t[35]=i*n-s*r,t[36]=s*n+i*r),i=this.x+t[31],s=this.y+t[32],n=t[33],r=t[34],t[0]=i+n,t[1]=s+r,t[6]=i-n,t[7]=s-r,n=t[35],r=t[36],t[2]=i+n,t[3]=s+r,t[4]=i-n,t[5]=s-r},e.create=function(t){if(t.width!==undefined&&t.height!==undefined||!!t.texture){var n=new e,r=n.data=new T.floatArray(38),i=n._texture=t.texture||null;if(i)if(0!==(i.width&i.width-1)||0!==(i.height&i.height-1))return null;n.x=t.x||0,n.y=t.y||0,n.rotation=r[16]=t.rotation||0;var s=t.color;r[8]=s?s[0]:1,r[9]=s?s[1]:1,r[10]=s?s[2]:1,r[11]=s?s[3]:1;var o=t.textureRectangle,u=i?1/i.width:1,a=i?1/i.height:1;r[12]=o?o[0]*u:0,r[13]=o?o[1]*a:0,r[14]=o?o[2]*u:1,r[15]=o?o[3]*a:1,r[17]=(t.width!==undefined?t.width:i.width)*.5,r[18]=(t.height!==undefined?t.height:i.height)*.5;var f=t.scale;r[19]=f?f[0]:1,r[20]=f?f[1]:1;var l=t.shear;r[21]=l?l[0]:0,r[22]=l?l[1]:0;var c=t.origin;return r[23]=c?c[0]:r[17],r[24]=c?c[1]:r[18],n._invalidate(),n}return null},e.version=1,e}(),x={setFromRotatedRectangle:function(t,n,r,i,s,o,u){var a=r[0],f=r[1],l=r[2],c=r[3];if(!o)t[0]=a,t[1]=f,t[2]=l,t[3]=f,t[4]=a,t[5]=c,t[6]=l,t[7]=c;else{var h,p;u?(h=a+u[0],p=f+u[1]):(h=.5*(a+l),p=.5*(f+c));var d=a-h,v=f-p,m=Math.cos(o),g=Math.sin(o),y=l-a,b=c-f;t[0]=a=h+(m*d-g*v),t[1]=f=p+(g*d+m*v),t[2]=a+m*y,t[3]=f+g*y,t[4]=a-g*b,t[5]=f+m*b,t[6]=a+(m*y-g*b),t[7]=f+(g*y+m*b)}s?(t[8]=s[0],t[9]=s[1],t[10]=s[2],t[11]=s[3]):t[8]=t[9]=t[10]=t[11]=1;if(i&&n){var w=1/n.width,E=1/n.height;t[12]=i[0]*w,t[13]=i[1]*E,t[14]=i[2]*w,t[15]=i[3]*E}else t[12]=t[13]=0,t[14]=t[15]=1},create:function(){return new T.floatArray(16)}},T=function(){function e(){this.forceUpdate=!1,this.clearBackBuffer=!1,this.defaultClearColor=e.defaultClearColor,this.sort={deferred:"deferred",immediate:"immediate",texture:"texture"},this.scale={scale:"scale",none:"none"},this.blend={additive:"additive",alpha:"alpha",opaque:"opaque"},this.drawStates={uninit:0,ready:1,draw:2}}return e.prototype.clear=function(e){if(this.state!==this.drawStates.ready)return!1;var t=this.graphicsDevice;if(this.currentRenderTarget){if(!t.beginRenderTarget(this.currentRenderTarget.renderTarget))return!1;t.clear(e||this.defaultClearColor),t.endRenderTarget()}else t.clear(e||this.defaultClearColor);return!0},e.prototype.clearBatch=function(){var e=this.texLists;for(var t in e)e.hasOwnProperty(t)&&(e[t]=undefined);this.currentTextureGroup=undefined,this.numGroups=0},e.prototype.bufferSprite=function(e,t,n){t._update(0),n<<=4;var r=t.data;e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15]},e.prototype.update=function(){var e=this.graphicsDevice,t=this.width,n=this.height,r=e.width,i=e.height;if(t!==r||n!==i||this.forceUpdate){var s,o,u,a,f=this.viewportRectangle;f?(u=f[0],a=f[1],s=f[2]-u,o=f[3]-a):(u=0,a=0,s=r,o=i),s===r&&o===i?this.clearBackBuffer=!1:this.clearBackBuffer=!0;var l=this.currentRenderTarget;if(this.scaleMode==="scale"){var c=s/o,h=r/i,p,d,v,m,g,y;h>c?(p=Math.ceil(i/o*s),v=r-p,g=Math.floor(v*.5),this.scissorX=g,this.scissorY=0,this.scissorWidth=p,this.scissorHeight=i,this.viewScaleX=s/p,this.viewScaleY=o/i,l||(this.clipOffsetX=g/r*2-1,this.clipOffsetY=1,this.clipScaleX=p/r*2/s,this.clipScaleY=-2/o)):(d=Math.ceil(r/s*o),m=i-d,y=Math.floor(m*.5),this.scissorX=0,this.scissorY=y,this.scissorWidth=r,this.scissorHeight=d,this.viewScaleX=s/r,this.viewScaleY=o/d,l||(this.clipOffsetX=-1,this.clipOffsetY=1-y/i*2,this.clipScaleX=2/s,this.clipScaleY=d/i*-2/o))}else this.viewScaleX=1,this.viewScaleY=1,l||(this.clipOffsetX=-1,this.clipOffsetY=1,this.clipScaleX=2/r,this.clipScaleY=-2/i),this.scissorX=0,this.scissorY=i-o,this.scissorWidth=s,this.scissorHeight=o;this.spriteAngleFactor=Math.min(this.viewScaleX,this.viewScaleY),this.spriteAngleFactor*=this.spriteAngleFactor,this.width=r,this.height=i;var b=0,w=this.renderTargetStructs,E=w.length;for(b=0;b<E;b+=1)this.validateTarget(w[b],this.scissorWidth,this.scissorHeight);l&&(this.clipOffsetX=-1,this.clipOffsetY=-1,this.clipScaleX=2*l.actualWidth/l.texture.width/s,this.clipScaleY=2*l.actualHeight/l.texture.height/o),this.clipOffsetX-=u*this.clipScaleX,this.clipOffsetY-=a*this.clipScaleY;var S=this.techniqueParameters.clipSpace;S[0]=this.clipScaleX,S[1]=this.clipScaleY,S[2]=this.clipOffsetX,S[3]=this.clipOffsetY,this.updateRenderTargetVbo(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight),this.forceUpdate=!1}},e.prototype.getViewport=function(t){t||(t=new e.floatArray(4));var n=this.viewportRectangle;return n?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]):(t[0]=t[1]=0,t[2]=this.graphicsDevice.width,t[3]=this.graphicsDevice.height),t},e.prototype.getScreenSpaceViewport=function(t){return t||(t=new e.floatArray(4)),this.update(),t[0]=this.scissorX,t[1]=this.height-(this.scissorY+this.scissorHeight),t[2]=t[0]+this.scissorWidth,t[3]=t[1]+this.scissorHeight,t},e.prototype.viewportMap=function(t,n,r){r||(r=new e.floatArray(2)),this.update();var i=this.height-this.scissorHeight-this.scissorY;r[0]=(t-this.scissorX)*this.viewScaleX,r[1]=(n-i)*this.viewScaleY;var s=this.viewportRectangle;return s&&(r[0]+=s[0],r[1]+=s[1]),r},e.prototype.viewportUnmap=function(t,n,r){r||(r=new e.floatArray(2)),this.update();var i=this.viewportRectangle;i&&(t-=i[0],n-=i[1]);var s=this.height-this.scissorHeight-this.scissorY;return r[0]=t/this.viewScaleX+this.scissorX,r[1]=n/this.viewScaleY+s,r},e.prototype.viewportClamp=function(e){if(e){var t=e[0],n=e[1],r,i,s,o,u=this.viewportRectangle;u?(r=u[0],i=u[1],s=u[2],o=u[3]):(r=0,i=0,s=this.graphicsDevice.width,o=this.graphicsDevice.height),t<r?t=r:t>s&&(t=s),n<i?n=i:n>o&&(n=o),e[0]=t,e[1]=n}return e},e.prototype.configure=function(e){if(this.state!==this.drawStates.ready)return!1;var t="viewportRectangle"in e?e.viewportRectangle:this.viewportRectangle,n=e.scaleMode;if(n!==undefined){if(!(n in this.scale))return!1;if(n==="scale"&&!t)return!1;this.scaleMode=n}return this.viewportRectangle=t,this.forceUpdate=!0,this.update(),!0},e.prototype.destroy=function(){this.texLists=null,this.state=this.drawStates.uninit,this.graphicsDevice=null,this.vertexBuffer&&this.vertexBuffer.destroy(),this.indexBuffer&&this.indexBuffer.destroy(),this.copyVertexBuffer.destroy();var e=this.renderTargetStructs;while(e.length>0){var t=e.pop();t.texture.destroy(),t.renderTarget.destroy(),t.texture=null,t.renderTarget=null}},e.prototype.begin=function(e,t){if(!t||t in this.sort){if(!e||e in this.blend){var n=!this.sortMode;this.dispatch()&&this.clearBatch();if(n){if(this.state!==this.drawStates.ready)return!1;this.update(),this.currentRenderTarget||this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight)}return this.state=this.drawStates.draw,t=t?t:n?"deferred":this.sortMode,e=e?e:n?"opaque":this.blendMode,n||(this.sortModeStack.push(this.sortMode),this.blendModeStack.push(this.blendMode)),this.sortMode=t,this.blendMode=e,this.prepareSortMode(t),this.graphicsDevice.setTechnique(this.blendModeTechniques[e]),!0}return!1}return!1},e.prototype._bufferSprite=function(t,n){var r=t.vertexBufferData,i=this.vertexBuffer,s=t.numVertices*i.stride,o=s+4*i.stride;if(o>=r.length){var u=this.bufferSizeAlgorithm(o,this.cpuStride),a=new e.floatArray(u),f;for(f=0;f<s;f+=1)a[f]=r[f];t.vertexBufferData=r=a}var l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],g=n[15];r[s]=n[0],r[s+1]=n[1],r[s+2]=l,r[s+3]=c,r[s+4]=h,r[s+5]=p,r[s+6]=d,r[s+7]=v,r[s+8]=n[2],r[s+9]=n[3],r[s+10]=l,r[s+11]=c,r[s+12]=h,r[s+13]=p,r[s+14]=m,r[s+15]=v,r[s+16]=n[4],r[s+17]=n[5],r[s+18]=l,r[s+19]=c,r[s+20]=h,r[s+21]=p,r[s+22]=d,r[s+23]=g,r[s+24]=n[6],r[s+25]=n[7],r[s+26]=l,r[s+27]=c,r[s+28]=h,r[s+29]=p,r[s+30]=m,r[s+31]=g,t.numVertices+=4,t.indices[t.numSets-1]+=6},e.prototype.bufferMultiSprite=function(t,n,r,i){var s=t.vertexBufferData,o=this.vertexBuffer,u=r===undefined?Math.floor(n.length/16):r;r=u*16,i=(i!==undefined?i:0)*16;var a,f=t.numVertices*o.stride,l=f+u*4*o.stride;if(l>=s.length){var c=this.bufferSizeAlgorithm(l,this.cpuStride),h=new e.floatArray(c);for(a=0;a<f;a+=1)h[a]=s[a];t.vertexBufferData=s=h}var p=i+r;for(a=i;a<p;a+=16){var d=n[a+8],v=n[a+9],m=n[a+10],g=n[a+11],y=n[a+12],b=n[a+13],w=n[a+14],E=n[a+15];s[f]=n[a],s[f+1]=n[a+1],s[f+2]=d,s[f+3]=v,s[f+4]=m,s[f+5]=g,s[f+6]=y,s[f+7]=b,s[f+8]=n[a+2],s[f+9]=n[a+3],s[f+10]=d,s[f+11]=v,s[f+12]=m,s[f+13]=g,s[f+14]=w,s[f+15]=b,s[f+16]=n[a+4],s[f+17]=n[a+5],s[f+18]=d,s[f+19]=v,s[f+20]=m,s[f+21]=g,s[f+22]=y,s[f+23]=E,s[f+24]=n[a+6],s[f+25]=n[a+7],s[f+26]=d,s[f+27]=v,s[f+28]=m,s[f+29]=g,s[f+30]=w,s[f+31]=E,f+=32}t.numVertices+=u*4,t.indices[t.numSets-1]+=u*6},e.prototype.indexData=function(t){var n=new e.uint16Array(t),r,i=0;for(r=0;r<t;r+=6)n[r]=i,n[r+1]=i+1,n[r+2]=i+2,n[r+3]=i+1,n[r+4]=i+2,n[r+5]=i+3,i+=4;return n},e.prototype.uploadBuffer=function(e,t,n){var r=this.vertexBuffer,i=this.vertexBufferParameters,s=this.graphicsDevice,o=e.vertexBufferData,u=this.performanceData;if(t>i.numVertices){var a=this.bufferSizeAlgorithm(t,this.gpuStride);a>this.maxVertices&&(a=this.maxVertices),i.numVertices=a,this.vertexBuffer.destroy(),this.vertexBuffer=r=s.createVertexBuffer(i),u.gpuMemoryUsage=a*35,a*=1.5;var f=this.indexBufferParameters;f.data=this.indexData(a),f.numIndices=a,this.indexBuffer.destroy(),this.indexBuffer=s.createIndexBuffer(f),f.data=null,s.setIndexBuffer(this.indexBuffer)}u.dataTransfers+=1;if(n===0)r.setData(o,0,t);else{var l=r.stride;r.setData(o.subarray(n*l,(n+t)*l),0,t)}},e.prototype.drawRawImmediate=function(e,t,n,r){var i=this.drawGroups[0];i.textures[0]=e||this.defaultTexture,i.indices[0]=0,i.numSets=1,this.numGroups=1,this.bufferMultiSprite(i,t,n,r),this.dispatch()},e.prototype.drawSpriteImmediate=function(e){var t=this.drawGroups[0];t.textures[0]=e._texture||this.defaultTexture,t.indices[0]=0,t.numSets=1,this.numGroups=1,e._update(this.spriteAngleFactor),this._bufferSprite(t,e.data),this.dispatch()},e.prototype.drawImmediate=function(e){var t=e.texture||this.defaultTexture,n=e.destinationRectangle,r=e.sourceRectangle,i=e.color,s=e.rotation,o=this.drawGroups[0];o.textures[0]=t,o.indices[0]=0,o.numSets=1,this.numGroups=1;var u=this.drawSprite;x.setFromRotatedRectangle(u,t,n,r,i,s,e.origin),this._bufferSprite(o,u),this.dispatch()},e.prototype.drawRawDeferred=function(e,t,n,r){e=e||this.defaultTexture;var i=this.drawGroups[0];this.numGroups=1;var s=i.numSets;if(s===0||i.textures[s-1]!==e)i.textures[s]=e,i.indices[s]=0,i.numSets+=1;this.bufferMultiSprite(i,t,n,r)},e.prototype.drawSpriteDeferred=function(e){var t=e._texture||this.defaultTexture,n=this.drawGroups[0];this.numGroups=1;var r=n.numSets;if(r===0||n.textures[r-1]!==t)n.textures[r]=t,n.indices[r]=0,n.numSets+=1;e._update(this.spriteAngleFactor),this._bufferSprite(n,e.data)},e.prototype.drawDeferred=function(e){var t=e.texture||this.defaultTexture,n=this.drawGroups[0];this.numGroups=1;var r=n.numSets;if(r===0||n.textures[r-1]!==t)n.textures[r]=t,n.indices[r]=0,n.numSets+=1;var i=e.destinationRectangle,s=e.sourceRectangle,o=e.color,u=e.rotation,a=this.drawSprite;x.setFromRotatedRectangle(a,t,i,s,o,u,e.origin),this._bufferSprite(n,a)},e.prototype.drawRawTextured=function(e,t,n,r){e=e||this.defaultTexture;var i;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===e)i=this.currentTextureGroup;else{var s=e.name,o=this.texLists;i=o[s],i||(i=this.drawGroups[this.numGroups],i||(i=E.create()),this.drawGroups[this.numGroups]=o[s]=i,i.textures[0]=e,i.indices[0]=0,i.numSets=1,this.numGroups+=1),this.currentTextureGroup=i}this.bufferMultiSprite(i,t,n,r)},e.prototype.drawSpriteTextured=function(e){var t=e._texture||this.defaultTexture,n;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===t)n=this.currentTextureGroup;else{var r=t.name,i=this.texLists;n=i[r],n||(n=this.drawGroups[this.numGroups],n||(n=E.create()),this.drawGroups[this.numGroups]=i[r]=n,n.textures[0]=t,n.indices[0]=0,n.numSets=1,this.numGroups+=1),this.currentTextureGroup=n}e._update(this.spriteAngleFactor),this._bufferSprite(n,e.data)},e.prototype.drawTextured=function(e){var t=e.texture||this.defaultTexture,n;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===t)n=this.currentTextureGroup;else{var r=t.name,i=this.texLists;n=i[r],n||(n=this.drawGroups[this.numGroups],n||(n=E.create()),this.drawGroups[this.numGroups]=i[r]=n,n.textures[0]=t,n.indices[0]=0,n.numSets=1,this.numGroups+=1),this.currentTextureGroup=n}var s=e.destinationRectangle,o=e.sourceRectangle,u=e.color,a=e.rotation,f=this.drawSprite;x.setFromRotatedRectangle(f,t,s,o,u,a,e.origin),this._bufferSprite(n,f)},e.prototype.prepareSortMode=function(e){e==="deferred"?(this.draw=this.drawDeferred,this.drawSprite=this.drawSpriteDeferred,this.drawRaw=this.drawRawDeferred):e==="immediate"?(this.draw=this.drawImmediate,this.drawSprite=this.drawSpriteImmediate,this.drawRaw=this.drawRawImmediate):(this.draw=this.drawTextured,this.drawSprite=this.drawSpriteTextured,this.drawRaw=this.drawRawTextured)},e.prototype.end=function(){return this.state!==this.drawStates.draw?!1:(this.dispatch()&&this.clearBatch(),this.blendModeStack.length!==0?(this.blendMode=this.blendModeStack.pop(),this.sortMode=this.sortModeStack.pop(),this.prepareSortMode(this.sortMode),this.graphicsDevice.setTechnique(this.blendModeTechniques[this.blendMode])):(this.blendMode=undefined,this.sortMode=undefined,this.state=this.drawStates.ready),!0)},e.prototype.dispatch=function(){var e=this.numGroups;if(e===0)return!1;var t=this.graphicsDevice,n=this.techniqueParameters;t.setIndexBuffer(this.indexBuffer);var r=this.drawGroups,i=!1;this.currentRenderTarget&&(i=t.beginRenderTarget(this.currentRenderTarget.renderTarget));var s=this.performanceData,o;for(o=0;o<e;o+=1){var u=r[o],a=u.textures,f=u.indices,l=0,c=0,h=u.numVertices;while(c<h){var p=h-c;p>this.maxVertices&&(p=this.maxVertices),this.uploadBuffer(u,p,c),t.setStream(this.vertexBuffer,this.semantics);var d=p*1.5,v=0;while(v<d){n.texture=a[l];var m=d-v;m>=f[l]?(m=f[l],l+=1):f[l]-=m;var g=m/6;s.batchCount===0?(s.minBatchSize=g,s.maxBatchSize=g,s.avgBatchSize=g,s.batchCount=1):(g<s.minBatchSize&&(s.minBatchSize=g),g>s.maxBatchSize&&(s.maxBatchSize=g),s.avgBatchSize*=s.batchCount,s.avgBatchSize+=g,s.batchCount+=1,s.avgBatchSize/=s.batchCount),t.setTechniqueParameters(n),t.drawIndexed(t.PRIMITIVE_TRIANGLES,m,v),v+=m}c+=p}u.numSets=0,u.numVertices=0}return this.currentRenderTarget&&i&&t.endRenderTarget(),!0},e.prototype.bufferSizeAlgorithm=function(e,t){var n=1.25,r=Math.ceil(Math.log(e)/Math.log(n)),i=Math.floor(Math.pow(n,r));return t*Math.ceil(i/t)},e.prototype.updateRenderTargetVbo=function(e,t,n,r){var i=this.graphicsDevice,s=.5*i.width,o=.5*i.height,u=this.copyVertexBuffer,a=(e-s)/s,f=(e+n-s)/s,l=(t-o)/o,c=(t+r-o)/o,h=this.vertexBufferData;h[0]=a,h[1]=c,h[2]=0,h[3]=1,h[4]=a,h[5]=l,h[6]=0,h[7]=0,h[8]=f,h[9]=c,h[10]=1,h[11]=1,h[12]=f,h[13]=l,h[14]=1,h[15]=0,u.setData(h,0,4)},e.makePow2=function(e){var t=Math.log(e)/Math.log(2);return 1<<Math.ceil(t)},e.prototype.createRenderTarget=function(t){var n=this.graphicsDevice,r=this.renderTargetStructs,i=r.length,s=t&&t.name?t.name:"RenderTarget#"+i,o=t&&t.backBuffer!==undefined?t.backBuffer:!0,u=t.width===undefined||t.height===undefined,a=this.renderTargetTextureParameters;a.name=s;var f=u?n.width:t.width,l=u?n.height:t.height,c=e.makePow2;a.width=c(f),a.height=c(l);var h=n.createTexture(a),p=this.renderTargetParams;p.colorTexture0=h;var d=n.createRenderTarget(p);return r.
push({managed:u,renderTarget:d,texture:h,backBuffer:o,actualWidth:o?f:h.width,actualHeight:o?l:h.height}),i},e.prototype.validateTarget=function(t,n,r){if(t.managed){var i=t.texture;t.backBuffer&&(t.actualWidth=n,t.actualHeight=r);var s=e.makePow2;n=s(n),r=s(r),t.backBuffer||(t.actualWidth=n,t.actualHeight=r);if(i.width!==n||i.height!==r){var o=this.renderTargetTextureParameters,u=this.renderTargetParams;o.name=i.name,o.width=n,o.height=r,i.destroy(),t.renderTarget.destroy();var a=this.graphicsDevice;t.texture=a.createTexture(o),u.colorTexture0=t.texture,t.renderTarget=a.createRenderTarget(u)}}},e.prototype.setBackBuffer=function(){return this.state!==this.drawStates.ready?!1:(this.currentRenderTarget=null,this.forceUpdate=!0,!0)},e.prototype.getRenderTargetTexture=function(e){var t=this.renderTargetStructs;return e<0||e>=t.length?null:t[e].texture},e.prototype.getRenderTarget=function(e){var t=this.renderTargetStructs;return e<0||e>=t.length?null:t[e].renderTarget},e.prototype.setRenderTarget=function(e){var t=this.renderTargetStructs;return e<0||e>=t.length?!1:this.state!==this.drawStates.ready?!1:(this.currentRenderTarget=t[e],this.forceUpdate=!0,!0)},e.prototype.copyRenderTarget=function(e){if(this.state!==this.drawStates.ready)return!1;var t=this.renderTargetStructs;if(e<0||e>=t.length)return!1;this.update(),this.currentRenderTarget||this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight);var n=this.graphicsDevice,r=t[e],i=r.texture,s=this.copyTechnique,o=this.copyTechniqueParameters,u=o.copyUVScale;u[0]=r.actualWidth/i.width,u[1]=r.actualHeight/i.height,o.copyFlip=this.currentRenderTarget?1:-1,o.inputTexture0=i;var a=!1,f=this.currentRenderTarget,l=this.copyVertexBuffer;return f&&(a=n.beginRenderTarget(f.renderTarget)),n.setTechnique(s),n.setTechniqueParameters(o),n.setStream(l,this.quadSemantics),n.draw(this.quadPrimitive,4,0),f&&a&&n.endRenderTarget(),!0},e.prototype.resetPerformanceData=function(){var e=this.performanceData;e.minBatchSize=e.maxBatchSize=e.avgBatchSize=undefined,e.batchCount=0,e.dataTransfers=0},e.create=function(t){var n=new e,r=n.graphicsDevice=t.graphicsDevice;n.sortMode=undefined,n.blendMode=undefined,n.sortModeStack=[],n.blendModeStack=[],n.drawGroups=[E.create()],n.numGroups=0,n.texLists={},n.texGroup=undefined,n.drawSprite=x.create(),n.defaultTexture=r.createTexture({name:"DefaultDraw2DTexture",width:1,height:1,depth:1,format:"L8",cubemap:!1,mipmaps:!0,renderable:!1,dynamic:!1,data:[255]}),n.draw=undefined,n.drawSprite=undefined,n.drawRaw=undefined;var i=r.createShader({version:1,name:"draw2D.cgfx",samplers:{texture:{MinFilter:9985,MagFilter:9729,WrapS:33071,WrapT:33071},inputTexture0:{MinFilter:9728,MagFilter:9729,WrapS:33071,WrapT:33071}},parameters:{clipSpace:{type:"float",columns:4},copyUVScale:{type:"float",columns:2},copyFlip:{type:"float"},texture:{type:"sampler2D"},inputTexture0:{type:"sampler2D"}},techniques:{opaque:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_draw2D","fp_draw2D"]}],alpha:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[770,771]},programs:["vp_draw2D","fp_draw2D"]}],additive:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!0,BlendFunc:[770,1]},programs:["vp_draw2D","fp_draw2D"]}],copy:[{parameters:["copyUVScale","copyFlip","inputTexture0"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:!1,DepthMask:!1,CullFaceEnable:!1,BlendEnable:!1},programs:["vp_copy","fp_copy"]}]},programs:{fp_copy:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];\nvec4 _ret_0;uniform sampler2D inputTexture0;void main()\n{_ret_0=texture2D(inputTexture0,tz_TexCoord[0].xy);gl_FragColor=_ret_0;}"},vp_copy:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR8;\nvec4 _OutPosition1;vec2 _OutUV1;uniform vec2 copyUVScale;uniform float copyFlip;void main()\n{_OutPosition1.x=ATTR0.x;_OutPosition1.y=ATTR0.y*copyFlip;_OutPosition1.zw=ATTR0.zw;_OutUV1=ATTR8.xy*copyUVScale;tz_TexCoord[0].xy=_OutUV1;gl_Position=_OutPosition1;}"},fp_draw2D:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[1];\nvec4 _ret_0;vec4 _TMP0;uniform sampler2D texture;void main()\n{_TMP0=texture2D(texture,tz_TexCoord[0].xy);_ret_0=tz_Color*_TMP0;gl_FragColor=_ret_0;}"},vp_draw2D:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[1];attribute vec4 ATTR0;attribute vec4 ATTR3;attribute vec4 ATTR8;\nvec4 _OUTPosition1;vec4 _OUTColor1;vec2 _OUTTexCoord01;uniform vec4 clipSpace;void main()\n{vec2 _position;_position=ATTR0.xy*clipSpace.xy+clipSpace.zw;_OUTPosition1.x=_position.x;_OUTPosition1.y=_position.y;_OUTPosition1.z=0.0;_OUTPosition1.w=1.0;_OUTColor1=ATTR3;_OUTTexCoord01=ATTR8.xy;tz_TexCoord[0].xy=ATTR8.xy;tz_Color=ATTR3;gl_Position=_OUTPosition1;}"}}});n.blendModeTechniques={additive:i.getTechnique("additive"),alpha:i.getTechnique("alpha"),opaque:i.getTechnique("opaque")};if(t.blendModes)for(var s in t.blendModes)t.blendModes.hasOwnProperty(s)&&(n.blend[s]=s,n.blendModeTechniques[s]=t.blendModes[s]);n.techniqueParameters=r.createTechniqueParameters({clipSpace:new e.floatArray(4),texture:null}),n.currentRenderTarget=null,n.renderTargetStructs=[],n.state=n.drawStates.ready,n.scaleMode="none",n.blendMode="opaque",n.width=0,n.height=0,n.scissorX=0,n.scissorY=0,n.scissorWidth=n.graphicsDevice.width,n.scissorHeight=n.graphicsDevice.height,n.clipOffsetX=-1,n.clipOffsetY=1,n.clipScaleX=2/n.graphicsDevice.width,n.clipScaleY=-2/n.graphicsDevice.height,n.viewScaleX=1,n.viewScaleY=1;var o=t.initialGpuMemory?t.initialGpuMemory:0;o<140&&(o=140),o>2293760&&(o=2293760),n.performanceData={gpuMemoryUsage:o,minBatchSize:0,maxBatchSize:0,avgBatchSize:0,batchCount:0,dataTransfers:0},n.maxGpuMemory=t.maxGpuMemory?t.maxGpuMemory:2293760,n.maxGpuMemory<o&&(n.maxGpuMemory=o);var u=Math.floor(o/140)*4;return n.maxVertices=Math.floor(n.maxGpuMemory/140)*4,n.maxVertices>65536&&(n.maxVertices=65536),n.cpuStride=64,n.gpuStride=4,n.vertexBufferParameters={numVertices:u,attributes:[r.VERTEXFORMAT_FLOAT2,r.VERTEXFORMAT_FLOAT4,r.VERTEXFORMAT_FLOAT2],"transient":!0},n.vertexBuffer=r.createVertexBuffer(n.vertexBufferParameters),n.semantics=r.createSemantics([r.SEMANTIC_POSITION,r.SEMANTIC_COLOR,r.SEMANTIC_TEXCOORD0]),n.indexBufferParameters={numIndices:u*1.5,format:r.INDEXFORMAT_USHORT,dynamic:!1,data:n.indexData(u*1.5)},n.indexBuffer=r.createIndexBuffer(n.indexBufferParameters),n.indexBufferParameters.data=null,n.renderTargetIndex=0,n.renderTargetCount=0,n.renderTargetTextureParameters={name:"",width:0,height:0,depth:1,format:"R8G8B8A8",cubemap:!1,mipmaps:!0,renderable:!0,dynamic:!0},n.renderTargetParams={colorTexture0:null},n.copyTechnique=i.getTechnique("copy"),n.copyTechniqueParameters=r.createTechniqueParameters({inputTexture0:null,copyFlip:1,copyUVScale:new e.floatArray([1,1])}),n.quadSemantics=r.createSemantics([r.SEMANTIC_POSITION,r.SEMANTIC_TEXCOORD0]),n.quadPrimitive=r.PRIMITIVE_TRIANGLE_STRIP,n.copyVertexBufferParams={numVertices:4,attributes:[r.VERTEXFORMAT_FLOAT2,r.VERTEXFORMAT_FLOAT2],"transient":!0},n.copyVertexBuffer=r.createVertexBuffer(n.copyVertexBufferParams),n.vertexBufferData=new e.floatArray([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),n},e.version=7,e.defaultClearColor=[0,0,0,1],e}();(function(){T.uint16Array=function(e){if(arguments.length===0)return[];var t,n;if(typeof e=="number")n=new Array(e);else{n=[];for(t=0;t<e.length;t+=1)n[t]=e[t]}return n};var e,t;typeof Uint16Array!="undefined"&&(e=new Uint16Array(4),t=Object.prototype.toString.call(e),t==="[object Uint16Array]"&&(T.uint16Array=Uint16Array)),T.floatArray=function(e){if(arguments.length===0)return[];var t,n;if(typeof e=="number")n=new Array(e);else{n=[];for(t=0;t<e.length;t+=1)n[t]=e[t]}return n},typeof Float32Array!="undefined"&&(e=new Float32Array(4),t=Object.prototype.toString.call(e),t==="[object Float32Array]"&&(T.floatArray=Float32Array,T.defaultClearColor=new Float32Array(T.defaultClearColor)))})();var N=function(){function e(e,t){this.gd=e,this.fm=t,this.bold=!1,this.italic=!1,this.pageWidth=0,this.pageHeight=0,this.baseline=0,this.glyphs=null,this.numGlyphs=0,this.minGlyphIndex=0,this.unknownGlyphIndex="?".charCodeAt(0),this.lineHeight=0,this.pages=null,this.kernings=null,this.textures=[]}return e.prototype.calculateTextDimensions=function(e,t,n,r,i){var s=this.glyphs,o=(this.lineHeight+(r||0))*t,u=s[this.unknownGlyphIndex],a=this.pages?this.pages.length:1,f=0,l=this.lineHeight*t,c=0,h=0,p=[],d=[],v=e.length,m=0,g,y,b,w,E;for(E=0;E<a;E+=1)d[E]=0;for(E=0;E<v;E+=1)g=e.charCodeAt(E),g===10?(m&&(m-=n),p[h]=m,h+=1,f<m&&(f=m),m=0,l+=o):(y=s[g]||u,y&&(b=y.awidth,b?(m+=b*t+n,c+=1):m+=n,w=y.page,d[w]+=1));return p[h]=m,f<m&&(f=m),i?(i.width=f,i.height=l,i.numGlyphs=c,i.linesWidth=p,i.glyphCounts=d,i):{width:f,height:l,numGlyphs:c,linesWidth:p,glyphCounts:d}},e.prototype.generatePageTextVertices=function(e,t,n,r){var i=t.scale||1,s=t.spacing?t.spacing*i:0,o=t.dimensions;o||(o=this.calculateTextDimensions(e,i,s));var u=o.glyphCounts,a=r||{vertices:null,vertexIndex:0},f=u[n];if(0===f)return a;var l=t.rect,c=t.alignment,h=o.linesWidth,p=(this.lineHeight+(t.lineSpacing||0))*i,d=this.kernings,v=this.glyphs,m=this.fm,g=m.reusableArrays,y=0,b=g[f];b?g[f]=null:b=new m.float32ArrayConstructor(f*4*4);var w=h[0],E=l[0],S=l[2],x=l[1],T=E;1===c?T+=(S-w)*.5:2===c&&(T+=S-w);var N=e.length,C=0,k,L,A,O,M,_,D,P,H,B,j,F,I;for(k=0;k<N;k+=1){A=e.charCodeAt(k);if(A===10)x+=p,C+=1,w=h[C],T=E,1===c?T+=(S-w)*.5:2===c&&(T+=S-w);else{I=v[A]||v[this.unknownGlyphIndex];if(I){P=I.awidth*i;if(P){L=I.page||0;if(L===n){O=T+I.xoffset*i,M=x+I.yoffset*i,_=O+I.width*i,D=M+I.height*i,H=I.left,B=I.top,j=I.right,F=I.bottom,b[y+0]=O,b[y+1]=M,b[y+2]=H,b[y+3]=B,b[y+4]=_,b[y+5]=M,b[y+6]=j,b[y+7]=B,b[y+8]=O,b[y+9]=D,b[y+10]=H,b[y+11]=F,b[y+12]=_,b[y+13]=D,b[y+14]=j,b[y+15]=F,y+=16,f-=1;if(0===f)break}T+=P+s;if(d){var q=d[A];if(q&&k<N-1){var R=q[e.charCodeAt(k+1)];R&&(T+=R*i)}}}else T+=s}}}return a.vertices=b,a.vertexIndex=0,a},e.prototype.drawTextRect=function(e,t){var n=t.dimensions;if(!n){var r=t.scale||1,i=t.spacing?t.spacing*r:0;n=this.calculateTextDimensions(e,r,i);var s=t;t={dimensions:n},t.__proto__=s}var o=n.numGlyphs;if(0>=o)return;var u=n.glyphCounts,a=u.length,f,l,c=this.fm.scratchPageContext;for(f=0;f<a;f+=1){l=u[f];if(l){c=this.generatePageTextVertices(e,t,f,c),this.drawTextVertices(c,f,!0),o-=l;if(0===o)break}}},e.prototype.drawTextVertices=function(e,t,n){var r=e.vertices;if(!r)return;var i=this.gd,s=this.fm,o=s.sharedVertexBuffer,u=s.sharedIndexBuffer,a=s.techniqueParameters,f,l,c=r.length>>4;f=c*4;if(!o||f>o.numVertices)o&&o.destroy(),o=this.createVertexBuffer(c),s.sharedVertexBuffer=o;o.setData(r,0,f),i.setStream(o,s.semantics),a.texture=this.textures[t],i.setTechniqueParameters(a);if(4<f){l=c*6;if(!u||l>u.numIndices)u&&u.destroy(),u=this.createIndexBuffer(c),s.sharedIndexBuffer=u;i.setIndexBuffer(u),i.drawIndexed(s.primitive,l,0)}else i.draw(s.primitiveTristrip,4,0);n&&(s.reusableArrays[c]=r)},e.prototype.createIndexBuffer=function(e){var t=this.gd,n={numIndices:6*e,format:"USHORT"},r=t.createIndexBuffer(n),i=r.map();if(i){var s,o,u,a;for(var f=0;f<e;f+=1)s=4*f,o=s+1,u=s+2,a=s+3,i(s,o,u),i(u,o,a);r.unmap(i)}return r},e.prototype.createVertexBuffer=function(e){var t=this.gd;return t.createVertexBuffer({numVertices:4*e,attributes:[t.VERTEXFORMAT_FLOAT2,t.VERTEXFORMAT_FLOAT2],dynamic:!0,"transient":!0})},e.version=1,e}(),C=function(){function e(e){this.primitive=e.PRIMITIVE_TRIANGLES,this.primitiveTristrip=e.PRIMITIVE_TRIANGLE_STRIP,this.semantics=e.createSemantics(["POSITION","TEXCOORD0"]),this.techniqueParameters=e.createTechniqueParameters({texture:null}),this.sharedIndexBuffer=null,this.sharedVertexBuffer=null,this.reusableArrays={},this.scratchPageContext={vertices:null,vertexIndex:0},this.float32ArrayConstructor=Array;if(typeof Float32Array!="undefined"){var t=new Float32Array(4),n=Object.prototype.toString.call(t);n==="[object Float32Array]"&&(this.float32ArrayConstructor=Float32Array)}}return e.prototype.get=function(e){return undefined},e.create=function(t,n,r,s,o){s||(s=function(){});var u={},a={},f={},l={},c=0,h={},p=null,d="",v=r,m=function(t,n,r){var i=Math.floor,s=r/16,o=1/16,u=1/s,a=.5/n.width,f=.5/n.height,l=i(n.width*o),c=i(n.height*u),h=[];h.length=r;for(var p=0;p<r;p+=1){var d=i(p%16)*o-a,v=i(p/16)*u-f;h[p]={width:l,height:c,awidth:l,xoffset:0,yoffset:0,left:d,top:v,right:d+o,bottom:v+u,page:0}}t.lineHeight=c,t.baseline=c,t.glyphs=h,t.numGlyphs=r,t.minGlyphIndex=0},g=function(t){function r(e,t,n){e[t+0]=255,e[t+1]=n&128?255:0,e[t+2]=255,e[t+3]=n&64?255:0,e[t+4]=255,e[t+5]=n&32?255:0,e[t+6]=255,e[t+7]=n&16?255:0,e[t+8]=255,e[t+9]=n&8?255:0,e[t+10]=255,e[t+11]=n&4?255:0,e[t+12]=255,e[t+13]=n&2?255:0,e[t+14]=255,e[t+15]=n&1?255:0}var n=[0,0,0,0,0,0,0,0,126,129,165,129,189,153,129,126,126,255,219,255,195,231,255,126,108,254,254,254,124,56,16,0,16,56,124,254,124,56,16,0,56,124,56,254,254,124,56,124,16,16,56,124,254,124,56,124,0,0,24,60,60,24,0,0,255,255,231,195,195,231,255,255,0,60,102,66,66,102,60,0,255,195,153,189,189,153,195,255,15,7,15,125,204,204,204,120,60,102,102,102,60,24,126,24,63,51,63,48,48,112,240,224,127,99,127,99,99,103,230,192,153,90,60,231,231,60,90,153,128,224,248,254,248,224,128,0,2,14,62,254,62,14,2,0,24,60,126,24,24,126,60,24,102,102,102,102,102,0,102,0,127,219,219,123,27,27,27,0,62,99,56,108,108,56,204,120,0,0,0,0,126,126,126,0,24,60,126,24,126,60,24,255,24,60,126,24,24,24,24,0,24,24,24,24,126,60,24,0,0,24,12,254,12,24,0,0,0,48,96,254,96,48,0,0,0,0,192,192,192,254,0,0,0,36,102,255,102,36,0,0,0,24,60,126,255,255,0,0,0,255,255,126,60,24,0,0,0,0,0,0,0,0,0,0,48,120,120,120,48,0,48,0,108,108,108,0,0,0,0,0,108,108,254,108,254,108,108,0,48,124,192,120,12,248,48,0,0,198,204,24,48,102,198,0,56,108,56,118,220,204,118,0,96,96,192,0,0,0,0,0,24,48,96,96,96,48,24,0,96,48,24,24,24,48,96,0,0,102,60,255,60,102,0,0,0,48,48,252,48,48,0,0,0,0,0,0,0,48,48,96,0,0,0,252,0,0,0,0,0,0,0,0,0,48,48,0,6,12,24,48,96,192,128,0,124,198,206,222,246,230,124,0,48,112,48,48,48,48,252,0,120,204,12,56,96,204,252,0,120,204,12,56,12,204,120,0,28,60,108,204,254,12,30,0,252,192,248,12,12,204,120,0,56,96,192,248,204,204,120,0,252,204,12,24,48,48,48,0,120,204,204,120,204,204,120,0,120,204,204,124,12,24,112,0,0,48,48,0,0,48,48,0,0,48,48,0,0,48,48,96,24,48,96,192,96,48,24,0,0,0,252,0,0,252,0,0,96,48,24,12,24,48,96,0,120,204,12,24,48,0,48,0,124,198,222,222,222,192,120,0,48,120,204,204,252,204,204,0,252,102,102,124,102,102,252,0,60,102,192,192,192,102,60,0,248,108,102,102,102,108,248,0,126,96,96,120,96,96,126,0,126,96,96,120,96,96,96,0,60,102,192,192,206,102,62,0,204,204,204,252,204,204,204,0,120,48,48,48,48,48,120,0,30,12,12,12,204,204,120,0,230,102,108,120,108,102,230,0,96,96,96,96,96,96,126,0,198,238,254,254,214,198,198,0,198,230,246,222,206,198,198,0,56,108,198,198,198,108,56,0,252,102,102,124,96,96,240,0,120,204,204,204,220,120,28,0,252,102,102,124,108,102,230,0,120,204,224,112,28,204,120,0,252,48,48,48,48,48,48,0,204,204,204,204,204,204,252,0,204,204,204,204,204,120,48,0,198,198,198,214,254,238,198,0,198,198,108,56,56,108,198,0,204,204,204,120,48,48,120,0,254,6,12,24,48,96,254,0,120,96,96,96,96,96,120,0,192,96,48,24,12,6,2,0,120,24,24,24,24,24,120,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,120,12,124,204,118,0,224,96,96,124,102,102,220,0,0,0,120,204,192,204,120,0,28,12,12,124,204,204,118,0,0,0,120,204,252,192,120,0,56,108,96,240,96,96,240,0,0,0,118,204,204,124,12,248,224,96,108,118,102,102,230,0,48,0,112,48,48,48,120,0,12,0,12,12,12,204,204,120,224,96,102,108,120,108,230,0,112,48,48,48,48,48,120,0,0,0,204,254,254,214,198,0,0,0,248,204,204,204,204,0,0,0,120,204,204,204,120,0,0,0,220,102,102,124,96,240,0,0,118,204,204,124,12,30,0,0,220,118,102,96,240,0,0,0,124,192,120,12,248,0,16,48,124,48,48,52,24,0,0,0,204,204,204,204,118,0,0,0,204,204,204,120,48,0,0,0,198,214,254,254,108,0,0,0,198,108,56,108,198,0,0,0,204,204,204,124,12,248,0,0,252,152,48,100,252,0,28,48,48,224,48,48,28,0,24,24,24,0,24,24,24,0,224,48,48,28,48,48,224,0,118,220,0,0,0,0,0,0,0,16,56,108,198,198,254,0],i=new Array(32768),s,o,u,a,f,l,c;u=0,l=0,c=256;for(o=0;o<16;o+=1){a=u;for(s=0;s<16;s+=1){for(f=0;f<8;f+=1)r(i,a+f*c,n[l]),l+=1;a+=16}u+=2048}return t.createTexture({name:"defaultFont",width:128,height:64,depth:1,format:"L8A8",cubemap:!1,mipmaps:!0,dynamic:!1,data:i})},y=new e(t);if(!v){v=new N(t,y);var b=g(t);b&&(m(v,b,128),v.textures=[b],v.pageWidth=128,v.pageHeight=64)}u["default"]=v;var w=function(t,n){t.textures=[n],t.pageWidth=n.width,t.pageHeight=n.height;var r=t.glyphs;r||m(t,n,256)},E=function(r,o){function h(){return l[r]-=1,l[r]===0?(delete l[r],delete a[r],c-=1,!0):!1}function m(e,n){var i=u[r];if(!i){h();return}t.createTexture({src:e,mipmaps:!0,onload:n})||(s("Failed to create texture for font '"+r+"'."),delete u[r],h())}var g=u[r];if(!g){if(r in a)o&&f[r].subscribe(o);else{a[r]=!0,l[r]=0,c+=1;var b=i.create();f[r]=b,o&&b.subscribe(o);var E=function(i,o){if(o!==200||!i){s("Failed to load font file: '"+r+"'."),b.notify(null),delete l[r],delete a[r],c-=1,o===404&&(u[r]=v);return}g=new N(t,y);var E=JSON.parse(i),S=E.bitmapfontlayouts;for(var x in S)if(S.hasOwnProperty(x)){var T=S[x];g.bold=T.bold||!1,g.italic=T.italic||!1,g.pageWidth=T.pagewidth||0,g.pageHeight=T.pageheight||0,g.baseline=T.baseline||0,g.glyphs=T.glyphs||null,g.numGlyphs=T.numglyphs||0,g.minGlyphIndex=T.minglyphindex||0,g.lineHeight=T.lineheight||0,g.pages=T.pages||null,g.kernings=T.kernings||null;break}u[r]=g;var C,k=g.pages;if(k){var L=k.length;l[r]+=L;var A=function(t,n,i){var o=u[r],a=i.pageIdx;if(o){if(t){o.textures[a]=t,h()&&(b.notify(o),delete f[r]);return}s("Failed to load font page: '"+k[a]+"'."),delete u[r]}h()};for(var O=0;O<L;O+=1)C=k[O],n.request({src:p&&p[C]||d+C,onload:A,requestFn:m,pageIdx:O})}else C=r+".dds",n.request({src:p&&p[C]||d+C,onload:function(e){e?(w(g,e),b.notify(g),delete f[r]):(s("Failed to load font page: '"+C+"'."),delete u[r]),delete l[r],delete a[r],c-=1},requestFn:function(e,n){t.createTexture({src:e,mipmaps:!0,onload:n})||(i?s("Failed to create texture for font '"+r+"'."):s("Failed to load font '"+r+"'."),delete u[r],delete l[r],delete a[r],c-=1)}})},S=r,x,T=S.lastIndexOf(".");T!==-1&&(x=S.substr(T));if(!x||x!==".fnt"&&x!==".fontdat")S+=".fontdat";n.request({src:p&&p[S]||d+S,onload:E})}g=v}else o&&TurbulenzEngine.setTimeout(function(){o(g)},0);return g},S=function(t,n){u[t]=u[n],h[t]=!0},x=function(t){t in u&&delete u[t]};return o?(y.load=function(t,n){return o.innerHTML+="FontManager.load:&nbsp;'"+t+"'",E(t,n)},y.map=function(t,n){o.innerHTML+="FontManager.map:&nbsp;'"+n+"' -> '"+t+"'",S(t,n)},y.remove=function(t){o.innerHTML+="FontManager.remove:&nbsp;'"+t+"'",x(t)}):(y.load=E,y.map=S,y.remove=x),y.get=function(t){var n=u[t];return n?n:v},y.getAll=function(){return u},y.getNumPendingFonts=function(){return c},y.isFontLoaded=function(t){return!a[t]},y.isFontMissing=function(t){return!u[t]},y.setPathRemapping=function(t,n){p=t,d=n},y.calculateTextDimensions=function(t,n,r,i){var s=u[t];return s?s.calculateTextDimensions(n,r,i):{width:0,height:0,numGlyphs:0,linesWidth:[],glyphCounts:[]}},y.reuseVertices=function(t){this.reusableArrays[t.length>>4]=t},y.destroy=function(){if(u){var r;for(r in u)if(u.hasOwnProperty(r)){var i=u[r];if(i){var s=i.texture;s&&(s.destroy(),i.texture=null)}}u=null}this.sharedVertexBuffer&&(this.sharedVertexBuffer.destroy(),this.sharedVertexBuffer=null),this.sharedIndexBuffer&&(this.sharedIndexBuffer.destroy(),this.sharedIndexBuffer=null),this.techniqueParameters=null,this.semantics=null,a=null,l=null,f=null,l=null,c=0,h=null,p=null,d=null,n=null,t=null},y},e.version=1,e}(),k=function(){function e(){this.version=1}return e.prototype.setSelectedRadio=function(e,t){var n=this.radioControls[e],r;n&&(r=n.controls[t],r&&(n.selected=t,this.updateRadio(r.id,!0)))},e.prototype.addRadioControl=function(e){var t=this.radioControls,n=e.groupName,r=e.radioIndex,i=e.id,s=e.fn,o=e.isDefault;if(n===undefined||n===null||r<0||i===undefined||i===null||s===undefined||s===null)return;var u=t[n];u||(t[n]={},u=t[n],u.controls=[],u.selected=0),u.controls[r]=e,o&&(u.selected=r),this.updateRadio(i,o)},e.prototype.addCheckboxControl=function(e){var t=this.checkboxControls,n=e.id,r=e.value;t[r]=e,this.updateCheckbox(n,e.isSelected)},e.prototype.addButtonControl=function(e){var t=this.buttonControls,n=e.id;t[n]=e},e.prototype.addSliderControl=function(e){var t=this.sliderControls;t[e.id]=e},e.prototype.getSliderValue=function(e){var t=window.$("#"+e).value;return t?parseInt(t,10):undefined},e.prototype.getHandler=function(){var e=this.radioControls,t=this.checkboxControls,n=this.buttonControls;return function(r){var i;r||(r=window.event),r.target?i=r.target:r.srcElement&&(i=r.srcElement),i.nodeType===3&&(i=i.parentNode);var s=i.id,o;switch(i.type){case"radio":for(var u in e)if(e.hasOwnProperty(u)){var a=0,f=e[u].controls,l=f.length;while(a<l){o=f[a];if(o.id===s){o.fn();return}a+=1}}break;case"checkbox":for(var c in t)if(t.hasOwnProperty(c)){o=t[c];if(o.id===s){var h=o.fn();h!==undefined&&(document.getElementById(o.id).checked=!!h);return}}break;case"button":for(var p in n)if(n.hasOwnProperty(p)){o=n[p];if(p===s){o.fn();return}}break;default:}}},e.prototype.register=function(){function d(e){return function(t,n){var r=window.$("#"+e+"input");r.val(n.value),r.change()}}function v(e,t){return function(){var n=parseFloat(this.value);if(!window.$)return;var r=window.$("#"+t),i=window.$("#"+t+"input");if(!r||!i)return;var s=r.slider("value");if(n===undefined||isNaN(n)||s===undefined||isNaN(s)||s===n)return;var o=r.slider("option","min"),u=r.slider("option","max");n<o?n=o:n>u&&(n=u),i.val(n),e.value=n,e.fn()}}var e=this.radioControls,t=this.checkboxControls,n=this.buttonControls,r=this.sliderControls,i,s,o;for(var u in e)if(e.hasOwnProperty(u)){var a=e[u].selected,f=e[u].controls,l=f.length;for(var c=0;c<l;c+=1)i=f[c],o=i.id,s=document.getElementById(o),s&&(s.value=i.value,s.name=i.groupName,s.onclick=this.getHandler(),s.checked=a===i.radioIndex?"checked":"")}for(var h in t)t.hasOwnProperty(h)&&(i=t[h],o=i.id,s=document.getElementById(o),s&&(s.value=i.value,s.onclick=this.getHandler(),s.checked=i.isSelected?"checked":""));for(var p in n)n.hasOwnProperty(p)&&(i=n[p],o=p,s=document.getElementById(o),s&&(s.value=i.value,s.onclick=this.getHandler()));for(var m in r)if(r.hasOwnProperty(m)){i=r[m],o=i.id;if(!window.$)return;var g=window.$("#"+o),y=window.$("#"+o+"input");if(!g||!y)return;g.slider({value:i.value,min:i.min,max:i.max,step:i.step,slide:d(o)}),y.val(g.slider("value")),y.change(v(i,o))}this.registered=!0},e.prototype.updateRadio=function(e,t){if(!this.registered)return;var n=document.getElementById(e);n&&(n.checked=!!t)},e.prototype.updateCheckbox=function(e,t){if(!this.registered)return;var n=document.getElementById(e);n&&(n.checked=!!t)},e.prototype.updateSlider=function(e,t){if(!this.registered)return;if(window.$){var n=window.$("#"+e);n&&n.slider("option","value",t)}},e.create=function(){var t=new e;return t.radioControls={},t.checkboxControls={},t.buttonControls={},t.sliderControls={},t.registered=!1,t},e}(),L=function(){function e(){}return e.loopButtons=function(t){var n=e.buttons,r;for(r in n)if(n.hasOwnProperty(r)){var i=n[r];t(i)}},e.checkOverlap=function(e,t,n){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom},e.init=function(t){var n=this,r=function(t,r,i){e.loopButtons(function(e){n.checkOverlap(r,i,e)&&e.callback()})};t.addEventListener("mouseup",r);var i=function(t,r){var i=t,s=r;e.loopButtons(function(e){e.hovering=n.checkOverlap(t,r,e)})};t.addEventListener("mouseover",i)},e.addButton=function(t){var n={id:t.id,left:t.left,top:t.top,right:t.right,bottom:t.bottom,callback:t.callback,hovering:null};n.hovering=this.checkOverlap(this.mouseX,this.mouseY,n),e.buttons[n.id]=n},e.clearButtons=function(){e.buttons={}},e.buttons={},e}();TurbulenzEngine.onload=function(){function p(e){var t=e.urlMapping,n=e.assetPrefix;u.setPathRemapping(t,n),u.load("fonts/hero.fnt",function(e){f=e}),a.setPathRemapping(t,n),a.load("shaders/font.cgfx",function(e){l=e})}function v(){d.createMappingTable(i,h,p),c=d.createStoreManager(i,h)}function y(e){g.push(e)}function b(){TurbulenzEngine.setTimeout(function(){g.shift()},500)}function q(){function o(){r+=10,s=i}function u(e,t,n,i){if(e){var o=m.viewportUnmap(r,s);if(j&&n){var u=f.calculateTextDimensions(e,t*1.2,0);L.addButton({id:i,left:o[0],top:o[1],right:o[0]+u.width,bottom:o[1]+u.height,callback:function(){n()}})}var a=t;if(i){var l=L.buttons[i];l&&l.hovering&&(a*=1.2)}f.drawTextRect(e,{rect:[o[0],o[1],0,0],scale:a,spacing:0,alignment:0})}s+=t}if(!t.beginFrame())return;j=M||F!==t.width||I!==t.height,M=!1,F=t.width,I=t.height,t.clear(E),t.setTechnique(S),x.clipSpace=n.v4Build(2/t.width,-2/t.height,-1,1,x.clipSpace),t.setTechniqueParameters(x);var e=1,r=e,i=0,s=i;j&&L.clearButtons(),g.length>0?u("Status: "+g[0],A):u("Status:",A),i=1,s=i;var a=function(t){return function(){c.removeFromBasket(t,1)&&(y("Updating basket"),c.updateBasket(function(){b()}))}},l=function(t){return function(){c.addToBasket(t,1)&&(y("Updating basket"),c.updateBasket(function(){b(),M=!0}))}},h=function(t){return function(){y("Consuming"),c.consume(t,1,function(){b(),M=!0})}},p,d=c.getOfferings(),v;u("Offerings",N);for(v in d)d.hasOwnProperty(v)&&d[v].available&&(p=d[v],u(p.title,A,l(v),"add "+v));o();var w=c.basket.items;u("Basket amount",N);for(v in d)d.hasOwnProperty(v)&&d[v].available&&(w.hasOwnProperty(v)?u(w[v].amount.toString(10),A,a(v),"remove "+v):u("0",A));u("Purchase",A,_,"purchase"),u("Reset",A,P,"reset"),H&&H.anonymous&&u("Upgrade User",A,B,"upgrade"),i=7,s=i,r=e;var T=c.getUserItems(),C=c.getResources();u("User items",N);for(v in T)T.hasOwnProperty(v)&&u(C[v].title,A,h(v),"consume "+v);o(),u("Amount",N);for(v in T)T.hasOwnProperty(v)&&u(T[v].amount.toString(10),A,h(v),"consume "+v);t.endFrame()}function U(){if(f&&l&&c&&c.ready){S=l.getTechnique("font"),x=t.createTechniqueParameters({clipSpace:n.v4BuildZero(),alphaRef:.01,color:n.v4BuildOne()});var e=function(){if(O){b();var t=document.getElementById("button-purchase");t&&(t.disabled=!1),O=!1,M=!0}};c.onSitePurchaseConfirmed=e,c.onSitePurchaseRejected=e,TurbulenzEngine.clearInterval(R),R=TurbulenzEngine.setInterval(q,1e3/60)}}function W(e){z.addButtonControl({id:"button-decrease-"+e,value:"-",fn:function(){c.removeFromBasket(e,1)&&(y("Updating basket"),c.updateBasket(b))}}),z.addButtonControl({id:"button-increase-"+e,value:"+",fn:function(){c.addToBasket(e,1)&&(y("Updating basket"),c.updateBasket(b))}})}var t=TurbulenzEngine.createGraphicsDevice({}),n=TurbulenzEngine.createMathDevice({}),r=TurbulenzEngine.createInputDevice({}),i=s.create({}),u=C.create(t,i),a=w.create(t,i),f,l,c,h;h=d.createGameSession(i,v);var m=T.create({graphicsDevice:t});m.configure({viewportRectangle:[0,0,20,10],scaleMode:"scale"});var g=[],E=[.3,.3,.3,1],S,x,N=1.2,A=.75,O=!1,M=!1,_=function(){if(c.showConfirmPurchase()){O=!0,y("Waiting for purchase confirmation");var t=document.getElementById("button-purchase");t&&(t.disabled=!0)}},D=function(){y("Consuming"),M=!0,c.consume("grenade",1,b)},P=function(){y("Resetting user items"),o.ajax({url:"/api/v1/store/user/items/remove-all/"+h.gameSlug,method:"POST",async:!0,callback:function(){c.requestUserItems(b)},requestHandler:i}),c.emptyBasket()},H=d.createUserProfile(i),B=function(){var t=function(){H=d.createUserProfile(i)};d.upgradeAnonymousUser(t)},j=!1,F=0,I=0;L.init(r);var R=0;R=TurbulenzEngine.setInterval(U,100);var z=k.create();z.addButtonControl({id:"button-consume-grenade",value:"Use grenade",fn:D}),W("rocket-launcher"),W("grenade"),W("grenade-pack"),W("explosives-pack"),z.addButtonControl({id:"button-purchase",value:"Purchase",fn:_}),z.addButtonControl({id:"button-reset",value:"Reset",fn:P}),z.register(),TurbulenzEngine.onunload=function(){R&&TurbulenzEngine.clearInterval(R),h&&(h.destroy(),h=null)}};if(!TurbulenzEngine.onload){window.alert("Entry point 'TurbulenzEngine.onload' must be defined.");return}TurbulenzEngine.onload.call(this)})();